define("lib/unlinkHtml",["require"],function(e){return function(e){return"string"!=typeof e?e:e.replace(/<a\b(?:.*?\shref=['"]?([^'" >]+)?['"]?)?.*?>(.*?)<\/\s*?a\s*?>/gi,function(e,t,i){return'<span class="fake-link"'+(t?' title="'+t+'"':"")+">"+i+"</span>"}).replace(/<\/\s*?a\s*?>/gi,"")}}),define("component!MarkdownComponent",["require","react","component!Raw","lib/view_helpers/markdown","lib/unlinkHtml"],function(e){"use strict";var t=e("react"),i=e("component!Raw"),o=e("lib/view_helpers/markdown"),n=e("lib/unlinkHtml");return t.createClass({displayName:"MarkdownComponent",propTypes:{unLink:t.PropTypes.bool},render:function(){if("string"==typeof this.props.children){var e=o.formatMarkdown(this.props.children);return this.props.unLink&&(e=n(e)),t.createElement(i,{ref:"markdown"},e)}return null}})}),define("component!Promotions/TilePromotionComponent",["require","underscore","translate","react","react-dom","lib/Podio.Tracking.GA","component!Pricing/PricingOrganizationPickerComponent","component!MarkdownComponent"],function(e){"use strict";var t,i=e("underscore"),o=e("translate"),n=e("react"),s=e("react-dom"),a=e("lib/Podio.Tracking.GA"),r=n.createFactory(e("component!Pricing/PricingOrganizationPickerComponent")),d=e("component!MarkdownComponent"),l=n.createClass({displayName:"TilePromotionComponent",getDefaultProps:function(){return{promotionData:{name:"",id:"",display_data:{}}}},componentWillMount:function(){var e=this.props.promotionData.name;a.trackEvent("promotion","view",e,{promotion:e})},render:function(){var e=this.props.promotionData.name,t=this.props.promotionData.promotion_id;return n.createElement("div",{className:"tile-promotion-component",style:this.getInlineStyles()},n.createElement("section",{className:"tile-promotion-component__content"},n.createElement("header",null,n.createElement("h2",{className:"header-title tile-promotion-component__header"},n.createElement(d,null,this.props.promotionData.display_data.lead_text||o("Save time and grow your business by unlocking Podio's most powerful features. #promotion.upgrade")))),n.createElement("main",null,n.createElement("a",{className:"tile-promotion-component__button button-new green pricing-mvp","data-tracking":"promotion,upgrade,{0}".format(e),href:"#",onClick:this.handleUpgradeClick},this.props.promotionData.display_data.button_text||o("Upgrade now #promotion.upgrade")))),n.createElement("a",{className:"tile-promotion-component__close","data-tracking":"promotion,close,{0}".format(e),"data-closes":".tile-promotion-component","data-promotion-id":t},"Ã—"))},handleUpgradeClick:function(e){if(e.preventDefault(),this.props.promotionData.display_data.button_link_url)location.href=this.props.promotionData.display_data.button_link_url;else{var o=document.getElementById("modal-org-picker-placeholder");o||(o=document.createElement("div"),o.id="modal-org-picker-placeholder",document.body.appendChild(o)),i.isUndefined(t)&&(t=s.render(r(),o)),t.open()}},getInlineStyles:function(){return this.props.promotionData.display_data&&this.props.promotionData.display_data.background_image_url?{backgroundImage:"url({0})".format(this.props.promotionData.display_data.background_image_url)}:{}}});return l}),define("controllers/promotion/Podio.Controllers.PromotionController",["require","lib/Podio.Logger","lib/backbone/Backbone.PodioController","lib/backbone/Backbone.Mixins.Transport.API"],function(e){var t=(e("lib/Podio.Logger"),e("lib/backbone/Backbone.PodioController")),i=e("lib/backbone/Backbone.Mixins.Transport.API");return t.extend({initialize:function(e){this.useXHRLookup=e.useXHRLookup,this._super()},checkForPromotions:function(){var e=this;if(this.useXHRLookup){if(!this.options.promotion)throw new Error("PromotionController: promotion context is required when using useXHRLookup");i.request("get","/promotion/{0}".format(this.options.promotion.context)).done(function(t){t&&t.promotion_id&&e.initPromotion(t)})}else{var t=this.getBootstrapData("promotion",!0);t&&this.initPromotion(t)}},initPromotion:function(e){var t=this.options.promotions||[this.options.promotion];t.forEach(function(t){if(e.display_type===t.display_type)if(t.controller){var i=t.controller;this.controller=new i({promotionData:e,options:t.options})}else{if(!t.callback)throw"You must supply either controller or callback as options to the promotions controller";t.callback.call(this,e,t.options)}})}})}),define("lib/widgets",["require","translate","jquery","lib/Podio.Transport","lib/Podio.Routes","lib/Podio.UI.Modal","lib/Podio.UI.FlashMessage","lib/Podio.FormValidation","lib/fileuploader/single","lib/Podio.Event","lib/Podio.Event.UI"],function(e){function t(e,t){var i=b("#widget-"+e),o=b("#widget-edit-"+e),n=o.hasClass("odd"),s=o.hasClass("grid-tile");o.replaceWith(t),i=b("#widget-"+e),o=b("#widget-edit-"+e),n&&i.addClass("odd"),s&&i.addClass("grid-tile")}function i(e){b(".widgets-box div.widget-list").append(e)}function o(e,t,i){var o="";return o+='<div class="widget-form '+i+'" id="'+t+'">',o+=e,o+="</div>"}function n(){var e='<div class="widget-link-form">';return e+='<div class="link-delete"></div>',e+='<input type="text" maxlength="120" name="widget[raw_data][][title]" class="required link-title new-placeholder" placeholder="'+v("Enter a link name #widgets")+'">',e+='<input type="text" name="widget[raw_data][][url]" class="required url link-url new-placeholder" placeholder="'+v("Enter a link URL #widgets")+'">',e+="</div>"}function s(){var e=b(".widgets-box div.widget-list"),t={requestData:{widgets:e.sortable("toArray").map(function(e){return e.split("-")[1]}).join(","),ref_type:e.attr("data-ref-type"),red_id:e.attr("data-ref-id")}};w.postJSON(y.sort_widgets_path(),t)}function a(e,t){k.hide(),b("#widget-dialog").remove()}function r(e,t){k.showLoading(),w.requestFromElement(e,function(e){b("#widget-dialog").remove(),k.show('<div id="widget-dialog">'+e.data.html+"</div>",{width:820,height:430,className:"widget-dialog",title:v("Add a Widget #widgets")})})}function d(e,t){w.requestFromElement(e,function(e){var t=o(e.data.html,"widget-add-new","odd grid-tile");b("#widget-add-new").remove(),b(".widgets-box a.widget-admin").before(t);var i=b("#widget-add-new");h(i),k.hide(),b("#widget-dialog").remove(),b(".widgets .empty").hide();var n=b("#widget-add-new").offset().top-200;b("html,body").animate({scrollTop:n},100)})}function l(e,t){e.data("type")?w.requestFromElement(e,function(t){var i=e.parents("div.widget-item"),n=i.height(),s=i.attr("data-id"),a="";D[s]=i,i.hasClass("odd")&&(a=" odd"),i.replaceWith('<div class="widget-edit-placeholder '+a+'" id="widget-edit-placeholder-'+s+'" style="height:'+n+'px;"></div>'),a="edit grid-tile",b("#widget-edit-placeholder-"+s).hasClass("odd")&&(a+="odd");var r=o(t.data.html,"widget-edit-"+s,a);b("#widget-edit-placeholder-"+s).replaceWith(r),r=b("#widget-edit-"+s),r.find("input.name").select().focus(),h(r)}):window.location=e.attr("href")}function c(e){var o=b(e),n=o.data("id");return w.requestFromElement(o,function(e){"ok"==e.status?(b("#widget-edit-"+n).length>0?t(n,e.data.html):i(e.data.html),b(".widgets-box div.widget-list").sortable("refresh"),o.parent().remove()):P.show(e.message,"error")}),!1}function h(e){C.init(e.find("form"),{submitHandler:c});var t=e.find(".upload-attachment");x.render(t,{onlyAllowImages:!0,previewImageSize:"small"});e.find("button.cancel").click(function(){b(".widgets-box div.widget-item").length||b(".widgets .empty").show();var t=e.attr("id").split("-");t=t[2],"widget-add-new"!=e.attr("id")&&D[t]?b(this).parents(".widget-form").replaceWith(D[t]):b(this).parents(".widget-form").fadeOut("fast",function(){b(this).remove()})})}function u(e){k.showConfirm(v("Remove widget #widgets"),v("Are you sure you want to remove this widget? #widgets"),null,{},function(){e.parents("div.widget-item").fadeOut("fast"),w.requestFromElement(e,function(t){"ok"==t.status&&(e.parents("div.widget-item").remove(),b(".widgets-box div.widget-list").sortable("refresh"))})})}function p(e){e.parents(".widget-link-form").remove()}function g(e,t){t.preventDefault();var i=b(n());e.before(i)}function f(){b(".widgets-box .widget-list").sortable({handle:".widget-sort",update:s})}function m(e,t){window.open(e.data("url"),"","height=600,width=480")}function _(e,t){var i,o,n=e.data("id"),s=e.data("target-type"),a=e.data("target-id"),r=e.data("target-name");"user"===s?(i=v("Send widget to dashboard #dashboard"),o=v("Adding this widget to your dashboard means that a copy is made and it will show up on your home page for easy access. Do you want to continue? #dashboard")):(i=v("Send widget to {0} #dashboard").format(r),o=v("Adding this widget to {0} means that a copy is made and it will show up on {0} for easy access. Do you want to continue? #dashboard").format(r.htmlEncode())),k.showConfirm(i,o,null,{},function(){w.postJSON(y.clone_dashboard_widget_path(n),{requestData:{target:{type:s,id:a}}})})}var v=e("translate"),b=e("jquery"),w=e("lib/Podio.Transport"),y=e("lib/Podio.Routes"),k=e("lib/Podio.UI.Modal"),P=e("lib/Podio.UI.FlashMessage"),C=e("lib/Podio.FormValidation"),x=e("lib/fileuploader/single"),W=e("lib/Podio.Event"),M=e("lib/Podio.Event.UI"),D={};W.bind(W.Types.delayedContentReady,f),W.bind(W.Types.init,f),M.bind("click",".widgets-box a.widget-admin",r),M.bind("click","#widget-dialog .cancel",a),M.bind("click","#widget-dialog .item-link",d),M.bind("click",".widgets-box .widget-edit",l),M.bind("click",".widget-remove",u),M.bind("click",".widget-link-add",g),M.bind("click",".link-delete",p),M.bind("click",".widget-print",m),M.bind("click",".clone-widget-to-target",_)}),define("lib/jquery/jquery.podioSpaceSwitcher",["require","translate","jquery","underscore"],function(e){var t=e("translate"),i=e("jquery"),o=e("underscore");i.spaceSwitcher=function(e,n){var s={data:{},dataFunc:null,escapeData:!0,trigger:".spaceswitcher-button",resultWrapper:".spaceswitcher-results-container",resultContainer:".spaceswitcher-results",lockHeight:!1,percent:80,beforeShow:function(){},beforeHide:function(){},onSelect:function(){},skipFirstLevel:!1},a=this;a.settings={};var r,d,l,c=i(e),h="",u=[],p=o.template('<% _.each(root, function(org) { %> <li> <div class="space_entrylogo"> <img src="<%-org.logo.replace("tiny","small")%>" width="25" height="25" alt=""> </div> <div class="space_listitemcontent"> <span class="org_item" data-orgid="<%=org.org_id%>"><%-org.name%></span> <ul> <% _.each(org.spaces, function(space) { %> <li><a href="<%=space.url%>" <%=(space.employee_network ? \'class="employee_network"\' : \'\')%> data-spaceid="<%=space.space_id%>"><%-space.name%></a></li> <% }); %> <% if (org.can_create_space) { %><li class="space_newspace"><a href="#" class="new_space">+ '+t("New Space #spaceswitcher")+"</a></li><% } %> </ul> </div> </li> <% }); %>");a.init=function(){a.settings=i.extend({},s,n),d='<span class="highlighted">$&</span>',i(a.settings.resultContainer).append("<ul></ul>"),o.isEmpty(a.settings.data)||(a.settings.escapeData&&g(a.settings.data),y(a.settings.data)),c.bind("keydown",m),c.bind("keyup",_),i(a.settings.resultContainer).delegate("li a","click",v),i(a.settings.trigger).click(b),i(window).bind("resize",f)},a.destroy=function(){i(a.settings.resultWrapper).is(":visible")&&a.hide_container(),i(a.settings.resultContainer).find("> ul").remove(),c.unbind("keydown",m),c.unbind("keyup",_),i(a.settings.resultContainer).undelegate("li a","click",v),i(a.settings.trigger).unbind("click",b),i(window).unbind("resize",f),c.removeData("spaceSwitcher")},a.show_container=function(){return a.settings.beforeShow()===!1?!1:(i(a.settings.resultWrapper).show(),f(),void c.focus())},a.hide_container=function(){return a.settings.beforeHide()===!1?!1:void i(a.settings.resultWrapper).hide()},a.move_focus_down=function(){if("undefined"!=typeof l){var e=l.find("ul li:first");(0!==e.length||(e=l.next(),0!==e.length||(e=l.parents("li:first").next(),a.settings.skipFirstLevel&&(e=e.find("ul li:first")),0!==e.length)))&&(l.removeClass("focused"),u.push(l),l=e,l.addClass("focused"))}},a.move_focus_up=function(){"undefined"!=typeof l&&u.length>0&&(l.removeClass("focused"),l=u.pop(),l.addClass("focused"))};var g=function(e){o.each(e,function(e){e.name=o.escape(e.name),e.spaces&&o.each(e.spaces,function(e){e.name=o.escape(e.name)})})},f=function(){if(a.settings.lockHeight)return!1;var e=i(a.settings.resultContainer).offset().top,t=.01*a.settings.percent;i(a.settings.resultContainer).css("max-height",(i(window).height()-e)*t)},m=function(e){if(13===e.keyCode||13===e.which){if("undefined"==typeof l||!l.length)return e.preventDefault(),e.stopPropagation(),!1;a.settings.onSelect.call(l.find("a"),e),a.hide_container()}},_=function(e){switch(e.keyCode||e.which){case 38:a.move_focus_up(),e.preventDefault();break;case 40:a.move_focus_down(),e.preventDefault();break;default:w.call(this,e)}},v=function(e){return a.settings.onSelect.call(this,e),a.hide_container(),!1},b=function(){var e=i.Deferred(),t=this;i(this).is("[disabled]")||(o.isEmpty(a.settings.data)&&o.isFunction(a.settings.dataFunc)?(i(this).addClass("loader"),a.settings.dataFunc(function(o){a.settings.data=o,a.settings.escapeData&&g(o),y(o),i(t).removeClass("loader"),e.resolve()})):e.resolve(),e.done(function(){i(a.settings.resultWrapper).is(":hidden")?a.show_container():a.hide_container()}))},w=function(){h=i(this).val(),r=new RegExp(h,"gi");var e;if(0===h.length)e=a.settings.data;else{var t=i.extend(!0,[],a.settings.data);e=k(t)}u=[],y(e),i(a.settings.resultContainer).animate({scrollTop:0},0)},y=function(e){i(a.settings.resultContainer).find("ul").html(p({root:e}));var t=i(a.settings.resultContainer).find("ul li:first");a.settings.skipFirstLevel&&(t=t.find("ul li:first")),t.addClass("focused"),l=t},k=function(e){return i.map(e,function(e){var t,i;if("undefined"==typeof e.spaces){var o=e.name.replace(r,d);return o===e.name?null:(e.name=o,e)}if(i=e.name.replace(r,d),i===e.name){if(t=k(e.spaces),0===t.length)return null}else t=e.spaces;return e.spaces=t,e.name=i,e})};a.init()},i.fn.spaceSwitcher=function(e){return this.each(function(){if(void 0===i(this).data("spaceSwitcher")){var t=new i.spaceSwitcher(this,e);i(this).data("spaceSwitcher",t)}})}}),function(e,t,i){var o={autoPlay:!1,cycle:!0,cycleSpeed:5e3,animationType:"slide",classes:{slides:".slides",nav:".slider-nav"},templates:{dot:'<li class="dot icon-16 icon-16-grey-dot"></li>'},callbacks:{onSlide:function(e){}}};e.podioSlider=function(i){function o(){var i="";t(_).times(function(){i+=m.templates.dot}),w.html("<ul>"+i+"</ul>"),w.delegate("li","click",function(t){return l(e(this).index()),P&&g(),t.stopPropagation(),t.preventDefault(),!1})}function n(t){m=t,s(),_=b.length,b.not(":first").hide(),o(),w.find("li:first").toggleClass("icon-16-grey-dot icon-16-grey-dot-selected").addClass("current"),m.autoPlay&&p(),e(window).bind("focus",r),e(window).bind("blur",a)}function s(){b=y.find(m.classes.slides),w=y.find(m.classes.nav)}function a(){g()}function r(){p()}function d(){g(),y.removeData("podioSlider"),w.undelegate("li","click"),e(window).unbind("focus",r),e(window).unbind("blur",a)}function l(e,t){var i=e,o=w.find("ul li"),n=k>i?-1:1,s=b.eq(k),a=b.eq(i),r=t?0:800;s.removeClass("current"),a.addClass("current"),k!=i&&c(s,a,n,r),o.eq(k).toggleClass("icon-16-grey-dot icon-16-grey-dot-selected").removeClass("current"),o.eq(i).toggleClass("icon-16-grey-dot icon-16-grey-dot-selected").addClass("current"),k=i,m.callbacks.onSlide(k)}function c(e,t,i,o){"slide"===m.animationType?-1===i?(e.hide("slide",{direction:"right"},o),t.show("slide",{direction:"left"},o)):(e.hide("slide",{direction:"left"},o),t.show("slide",{direction:"right"},o)):"fade"===m.animationType&&(e.fadeOut("slow"),t.fadeIn("slow"))}function h(){var e;if(k+1===_){if(!m.cycle)return!1;e=0}else e=k+1;l(e,!1)}function u(){var e;if(0===k){if(!m.cycle)return!1;e=_}else e=k-1;l(e,!1)}function p(){P||(v=window.setInterval(h,m.cycleSpeed),P=!0)}function g(){P&&(window.clearInterval(v),P=!1)}var f,m,_,v,b,w,y=e(i),k=0,P=!1;return f={init:n,destroy:d,play:p,stop:g,next:h,prev:u,"goto":l}},e.fn.podioSlider=function(i){var n=arguments;return this.each(function(){var s=e.data(this,"podioSlider");if(s&&t.isFunction(s[i]))return s[i].apply(this,Array.prototype.slice.call(n,1));if(!(s||"object"!=typeof i&&i)){var a=i||{},r=e.extend(!0,{},o,a);return s=e.data(this,"podioSlider",new e.podioSlider(this)),s.init.call(this,r)}})}}(jQuery,_),define("lib/jquery/jquery.podioSlider",["jquery"],function(){}),define("root/stream/Podio.UI.Status",["require","translate","underscore","jquery","controllers/Podio.Controllers.FeatureTour","lib/Podio.Utils.Text","lib/Podio.UI.FormEmbedActions","lib/Podio.FormValidation","lib/mentionsinput/PodioMentionsInput","lib/Podio.Emojis","lib/Giphys","jquery.scrollTo","lib/jquery/jquery.podioSlider","lib/Podio.UI","lib/Podio.Config","lib/Podio.Bootstrap","lib/Podio.UI.Questions","lib/Podio.UI.Embeds","root/Podio.Comments","lib/Podio.Event","lib/Podio.Event.UI","lib/Podio.UI","lib/Podio.Utils","lib/Podio.Transport","lib/Podio.Transport.Mentions","lib/Podio.UI.Modal","jquery.lazyload"],function(e){function t(e,t,i){var o=T.on_employee_network?T.space_id:"",n=R.getMentionsData(t,o);n.done(function(e){e.data.items&&i.apply(this,[e.data.items])})}function i(e){e=e||{alert_invite:!1};var t,i=b("#stream_composer > form");if(y.elmTextArea.focus(),i.valid()){var o=(y.elmForm.find("#space_id").val(),y.elmTextArea.val(),S.getCurrentEmbedInfo(y.elmActionBox));i.find("#status_embed_id").val(o&&o.embed_id),i.find("#status_embed_file_id").val(o&&o.selected_file_id),D.disableButtonWithLoader(y.elmSubmitButton);var s=i.serializeArray();s=v.map(s,function(e){return"status[value]"===e.name&&(e.value=z.val()),e}),e.alert_invite&&s.push({name:"alert_invite",value:!0}),t=q.context()?q.context().context_type:"global",s.push({name:"stream_ref_type",value:t}),F.postJSON(i.data("url"),{requestData:s},n.curry(i))}}function o(e,t){var o=b(".spaceswitcher-button"),n=b(".spaceswitcher-searchinput");n.is(":visible")?n.focus():o.length?o.click():i()}function n(e,t){if("ok"===t.status){var o=b("#stream ul.content");o.prepend(t.data.html),b(".stream-noactivity").remove(),C.destroy(y.elmForm),C.init(y.elmForm),z.resetInput(),y.elmTextArea.trigger("input"),l(),D.restoreButtonWithLoader(y.elmSubmitButton),y.elmForm.find("input.files-hidden-input").val(""),y.elmForm.find("div.upload-attachments").empty(),P.hideEmbedBox(y.elmActionBox),A.hideAttach(y.elmActionBox),y.elmForm.find("#status_embed_id").val(""),y.elmForm.find("#status_embed_file_id").val(""),k.initStreamShowOverflow(),b("#stream img.lazy").lazyload(),b("#stream img.lazy-deferred").lazyload({event:"lazyDeferred"})}else if("alert.no_access.invite"===t.error_code){var n=_("{0} is not a member of {1}, for them to see your mention you must add them. #item_activity").format(v.map(t.data.names,v.escape),v.escape(t.data.space_name));E.showConfirm(_("Invite users? #item_activity"),n,null,{yes:_("Invite users #item_activity"),no:_("Cancel #item_activity")},function(){i({alert_invite:!0})},function(){D.restoreButtonWithLoader(y.elmSubmitButton)})}else D.restoreButtonWithLoader(y.elmSubmitButton)}function s(){y.elmStreamComposer=b("#stream_composer"),y.elmForm=y.elmStreamComposer.find("form"),y.elmTextArea=y.elmForm.find("textarea"),y.elmSubmitButton=y.elmForm.find("input[type=submit]"),y.elmActionBox=y.elmStreamComposer.find(".action-box")}function a(){b("#stream_composer .spaceswitcher-wrapper .flatbutton").prop("disabled",!1),z=new x(y.elmTextArea,{triggers:{"@":t,":":W.load,"::":M.load}}),C.init(y.elmForm)}function r(e,t){var i=b("#stream_composer .action-box");P.handleAutoLinking(i,e)}function d(){y.elmTextArea&&y.elmTextArea.addClass("highlight")}function l(){y.elmTextArea&&y.elmTextArea.removeClass("highlight")}function c(){var e=b("#stream_composer form textarea"),t=b("#stream_composer .first-ux-status-tooltip");t.length&&(t.podioSlider({autoPlay:!0,callbacks:{onSlide:function(){var e=1;return function(){t.find(".top-arrow").removeClass("pos"+e),e=e%3+1,t.find(".top-arrow").addClass("pos"+e)}}()}}),e.click(function(){var e=b("#stream_composer .form-embed-actions .action-box:visible");t.hasClass("closed")||e.length||(t.fadeIn(200),t.podioSlider("play"),h(t))}),t.bind("outsideclick",function(){e.is(":focus")||(t.podioSlider("stop"),t.fadeOut(200))}))}function h(e){var t=e.offset().top,i=t+e.height();i-b(window).scrollTop()>b(window).height()&&b(window).scrollTo(i-b(window).height()+15,500,{axis:"y"})}function u(){D.disableInputField(y.elmSubmitButton)}function p(){D.restoreInputField(y.elmSubmitButton)}function g(){s(),a(),c(),f(),P.signals.onFileUploadStarted.add(u),P.signals.onFileUploadFinished.add(p)}function f(){var e=I.getBootstrapData("FeatureTourSettings");if("emp_network"===e.name&&e.pop&&e.delayedStart){var t=new w;t.initTour()}}function m(e){g(),B.bind("submit","#stream_composer form",o),B.bind("keyup","#stream_composer form textarea",v.debounce(r,500),!0),B.bind("blur","#stream_composer form textarea",l)}var _=e("translate"),v=e("underscore"),b=e("jquery"),w=e("controllers/Podio.Controllers.FeatureTour"),y={},k=e("lib/Podio.Utils.Text"),P=e("lib/Podio.UI.FormEmbedActions"),C=e("lib/Podio.FormValidation"),x=e("lib/mentionsinput/PodioMentionsInput"),W=e("lib/Podio.Emojis"),M=e("lib/Giphys");e("jquery.scrollTo"),e("lib/jquery/jquery.podioSlider");var D=e("lib/Podio.UI"),T=e("lib/Podio.Config"),I=e("lib/Podio.Bootstrap"),A=e("lib/Podio.UI.Questions"),S=e("lib/Podio.UI.Embeds"),V=(e("root/Podio.Comments"),e("lib/Podio.Event")),B=e("lib/Podio.Event.UI"),q=e("lib/Podio.UI"),F=(e("lib/Podio.Utils"),e("lib/Podio.Transport")),R=e("lib/Podio.Transport.Mentions"),E=e("lib/Podio.UI.Modal");e("jquery.lazyload");var z;return V.bind(V.Types.init,m),{submitStatus:i,highlight:d,removeHighlight:l,init:g}}),define("root/stream/Podio.UI.SpaceSwitcher",["require","translate","underscore","jquery","lib/jquery/jquery.podioSpaceSwitcher","lib/Podio.Utils","lib/Podio.Event","root/stream/Podio.UI.Status","lib/Podio.UI.FlashMessage","lib/Podio.UI","lib/Podio.UI.Modal","lib/Podio.Transport.Picker","lib/Podio.Routes","lib/Podio.UI.CreateSpaceModal","lib/Podio.Config"],function(e){function t(e){var t={skipFirstLevel:!0,beforeShow:function(){return 0===a("#status_value").val().length?(o(),!1):(a(".spaceswitcher-button").addClass("active"),!0)},beforeHide:function(){return a(".spaceswitcher-button").removeClass("active"),!0},onSelect:function(e){if(a(this).hasClass("new_space")){var t=a(this).parents(".space_listitemcontent:first").find("[data-orgid]").attr("data-orgid");return p.show({newUrl:u.new_space_path({org_id:t}),title:n("Create a new space. #top_bar"),callback:i}),e.stopPropagation(),e.preventDefault(),!1}a("#space_id").val(a(this).attr("data-spaceid")),e.stopPropagation(),e.preventDefault(),o(),a(".spaceswitcher-searchinput").data("spaceSwitcher").hide_container()}};s.isFunction(e)?t.dataFunc=e:t.data=e,a(".spaceswitcher-searchinput").spaceSwitcher(t)}function i(e){var i=n("The space %{space_name} has been successfully created. #space").replace("%{space_name}",e.name);c.hide(),d.show(i),a(".spaceswitcher-searchinput").data("spaceSwitcher").destroy(),h.getSpacePickerData(function(e){t.initStreamSpaceSwitcher(e)},a("#stream_composer").attr("data-orgid"),void 0,!0),a("#space_id").val(e.space_id),g||o()}function o(){r.submitStatus()}var n=e("translate"),s=e("underscore"),a=e("jquery");e("lib/jquery/jquery.podioSpaceSwitcher");var r=(e("lib/Podio.Utils"),e("lib/Podio.Event"),e("root/stream/Podio.UI.Status")),d=e("lib/Podio.UI.FlashMessage"),l=e("lib/Podio.UI"),c=e("lib/Podio.UI.Modal"),h=e("lib/Podio.Transport.Picker"),u=e("lib/Podio.Routes"),p=e("lib/Podio.UI.CreateSpaceModal"),g=(e("lib/Podio.Config"),!1);return{initStreamSpaceSwitcher:t,disable:function(){g=!0,l.disableInputField(a(".spaceswitcher-button"))},enable:function(){g=!1,l.restoreInputField(a(".spaceswitcher-button"))}}}),define("root/stream/Podio.UI.Stream",["require","translate","underscore","jquery","jquery.lazyload","lib/Podio.Utils.Text","lib/Podio.Push","lib/Podio.UI.Tasks.Create","controllers/address_book_export/Podio.Controllers.AddbookExport.Main","lib/Podio.Config","lib/Podio.Transport","lib/Podio.Event","lib/Podio.Event.UI","lib/Podio.UI","root/Podio.Comments","lib/Podio.Routes","lib/Podio.UI.Modal","lib/Podio.UI.ActionDropdown"],function(e){function t(e){B=V(window);var t=V("#stream");q=e||t,F=V(".stream-unread-badge"),oe=V("#home_stream").length,q.length&&(H.bind(H.Types.scroll,S.throttle(S.debounce(v,500))),R=q.data("ref")),o(t),j.on("space","stream_create",M,!0),i(V("#stream"))}function i(e){V(e).find("img.lazy").lazyload(),V(e).find("img.lazy-deferred").lazyload({event:"lazyDeferred"})}function o(e){var t=10;U.initShowOverflow(e.find("span.status-full.collapsed, .non-image-files-container.collapsed, .image-files-container.collapsed, .comment_content.collapsed"),t)}function n(){var e=q.data("reload-path");$.getJSON(e,{},function(e){q.html(e.data.html),q.append(e.data.show_more),r()})}function s(e){var t=q.find("ul.content");t.find(".show-more").remove(),e.show_more&&t.append(e.show_more)}function a(e){function t(){var e=V(E.html);i.replaceWith(e),s(E),E=null,ee=!1,r(e)}var i=q.find("li.show-more");if(E)e&&t();else if(Z)ee||(ee=e);else{Z=!0;var o=i.find("a.show-more-link");o.length&&$.requestFromElement(o,function(i){E=i.data,Z=!1,(e||ee)&&t()})}}function r(e){e=e?e:V("#stream"),o(e),i(e)}function d(e){var t=e.find(".status-full");return t.hasClass("collapsed")}function l(e,t){var i,o=e.closest(".object"),n=e.hasClass("is-liked"),s=n?$.deleteJSON:$.postJSON,a=e.data("ref_type"),l=e.data("ref_id");i=G.context()?G.context().context_type:"global",s(X.rating_path(a,l,"like",{variant:"stream",stream_ref_type:i,collapsed:d(o).toString(),format:""}),{},function(e){var t=V(e.data.html);o.replaceWith(t),r(t)})}function c(e,t){var i=e.data("ref_type"),o=e.data("ref_id"),n=e.closest(".object");O.newModal({attributes:{ref_type:i,ref_id:o},variant:"stream",collapsed:d(n),callback:function(e){if(e.data.html){var t=V(e.data.html);n.replaceWith(t),r(t)}}})}function h(e,t){var i=e.parents(".object:first").find(".comment-box-new");i.length&&i.find(".composer-input textarea").get(0).focus();var o=e.closest(".object"),n=e.parents(".object:first").find(".comment-box"),s=(n.find("#comment_value"),n.find(".add-comment")),a=n.find(".new-comment-form"),r=a.find("input[name=collapsed]");s.remove(),n.removeClass("hidden"),a.removeClass("hidden"),r.val(d(o)),J.setupCommentBox(n),S.defer(function(){n.find("textarea").get(0).focus()})}function u(e,t){var i=e.closest(".stale-activities-info"),o=i.siblings(".activities").find(".hidden");i.remove(),o.removeClass("hidden")}function p(e,t){var i=e.parents("li.show-more:first");i.addClass("loading"),a(!0)}function g(e,t){var i=e.data("type-name");K.showDeleteConfirm(A("Delete {0} #stream.actions").format(S.escape(i)),A("Are you sure you want to delete this {0}? #stream.actions").format(S.escape(i)),{},function(){$.requestFromElement(e,function(t){var i=e.parents("li.object:first");i.fadeOut("fast")})})}function f(e,t){C(),$.requestFromElement(e,function(t){var i=e.parents("li.object:first");i.html(t.data.html),setTimeout(function(){i.fadeOut("slow")},1e4)})}function m(e,t){C(),Q.hideAll(),$.requestFromElement(e,function(e){n()})}function _(e,t){$.requestFromElement(e,function(t){e.parents("span:first").replaceWith(t.data.html)})}function v(e){var t=q.find("li.show-more");t.length>0&&B.scrollTop()+B.height()>t.offset().top&&a(!1)}function b(){if(F.addClass("hidden"),z){var e=V("<ul/>",{"class":"content new"}),t=V(z.html);e.html(t),e.prependTo(q),e.css("display","none"),e.fadeIn(),e.promise().done(function(){q.find(".content:not(.new)").remove(),e.removeClass("new"),s(z),r(t),E=null,z=null})}}function w(e,t){if(q){e.parent().addClass("loading"),x();var i=q.data("reload-path");if(i){var o=q.find("li.object:first"),n=$.getJSON(i,{abortable:!0,requestData:{new_since:o.data("updated-on")}});ne=!0,n.done(function(e){ne=!1,z=e.data.unread_count?e.data:null,b()})}}}function y(){var e=new V.Deferred;if(S.isEmpty(te)){var t=$.getJSON(X.stream_mutes_all_path(),{});t.done(function(t){te={spaces:S.pluck(S.filter(t.data.stream_mutes,function(e){return"space"===e.type}),"id"),apps:S.pluck(S.filter(t.data.stream_mutes,function(e){return"app"===e.type}),"id")},e.resolve(te)})}else e.resolve(te);return e}function k(e){var t=new V.Deferred,i=!1;return y().then(function(o){e.space_id&&S.include(o.spaces,e.space_id)&&(i=!0),e.app_id&&S.include(o.apps,e.app_id)&&(i=!0),t.resolve(i)}),t}function P(){var e=S.size(ie),t=1===e?A("{0} new stream object #stream_push").format(e):A("{0} new stream objects #stream_push").format(e);F.removeClass("loading"),F.find("a").html(t),F.removeClass("hidden")}function C(){te={}}function x(){ie={}}function W(e,t){var i="{0}-{1}".format(e,t);ie[i]?ie[i]=ie[i]+1:ie[i]=1}function M(e){ne||(oe?k(e).then(function(t){t||(W(e.context_ref.type,e.context_ref.id),P())}):(W(e.context_ref.type,e.context_ref.id),P()))}function D(e,t){t.stopPropagation();var i=new N({privateName:"status",ref:{type:"space",id:L.space_id}});i.open()}function T(){t()}function I(e,t){U.onShowOverflowClicked.apply(this,S.toArray(arguments)),e.siblings(".collapsed").find(".lazy-deferred").trigger("lazyDeferred")}var A=e("translate"),S=e("underscore"),V=e("jquery");e("jquery.lazyload");var B,q,F,R,E,z,U=e("lib/Podio.Utils.Text"),j=e("lib/Podio.Push"),O=e("lib/Podio.UI.Tasks.Create"),N=e("controllers/address_book_export/Podio.Controllers.AddbookExport.Main"),L=e("lib/Podio.Config"),$=e("lib/Podio.Transport"),H=e("lib/Podio.Event"),Y=e("lib/Podio.Event.UI"),G=e("lib/Podio.UI"),J=e("root/Podio.Comments"),X=e("lib/Podio.Routes"),K=e("lib/Podio.UI.Modal"),Q=e("lib/Podio.UI.ActionDropdown"),Z=!1,ee=!1,te={},ie={},oe=!1,ne=!1;return H.bind(H.Types.init,T),Y.bind("click",".stream-unread-badge a",w),Y.bind("click","#stream .overflow-control",I),Y.bind("click","#stream a.like",l),Y.bind("click","#stream .task-stream-create",c),Y.bind("click","#stream .show-stale-activites",u),Y.bind("click","#stream .comment-stream-create",h),Y.bind("click","#stream .show-more a.show-more-link",p),Y.bind("click","#stream .stream-actions a.delete",g),Y.bind("click","#stream .stream-actions a.mute",f),Y.bind("click","#stream .muted a.unmute, #home_stream .stream-mutes a.unmute",m),Y.bind("click","#stream .subscription a",_),Y.bind("click","#stream .email-to-trigger",D),{init:t,initShowOverflow:o}}),define("bundles/stream",["require","bundles/common-ui","lib/widgets","root/stream/Podio.UI.SpaceSwitcher","root/stream/Podio.UI.Stream","root/stream/Podio.UI.Status"],function(e){e("bundles/common-ui"),e("lib/widgets"),e("root/stream/Podio.UI.SpaceSwitcher"),e("root/stream/Podio.UI.Stream"),e("root/stream/Podio.UI.Status")}),define("lib/view_helpers/dashboard",["require","lib/view_helpers/base"],function(e){var t=e("lib/view_helpers/base"),i={widget_blankslate_message:function(e,t){var i="<div class='blankslate sizey' data-sizey='{0}'><div class='message'>{1}</div></div>";return i.format(e,t)}};t.registerHelpers(i)}),define("sections/referrals/Podio.UI.Referrals.Teaser",["require","translate","jquery","lib/Podio.UI.Tasks.Create","lib/Podio.Transport","lib/Podio.UI.Modal","lib/Podio.Routes","lib/Podio.Event.UI","lib/Podio.Statsd","lib/Podio.Utils","lib/Podio.Config"],function(e){function t(){h.getJSON(p.new_referral_path(),{},function(e){u.show(e.data.html,{title:d("Share Podio #referrals"),className:"referral-teaser",hideHandler:s}),f.increment("sharepodio.modal-old.view")})}function i(e,t){var i=l('<input type="text" />'),o=e.find(".text").length,n=e.find("input").length;i.val(e.text()),o&&!n?(i.css({width:e.width()-42}),e.find(".text").html(i)):e.find("input").length||e.html(i),i.select(),m.switchToThanksMode()}function o(e,t){m.switchToThanksMode()}function n(e,t){u.hide()}function s(){return m.persistModalDismissal("sidebar"),f.increment("sharepodio.modal-old.close"),!0}function a(e,t){m.persistModalDismissal("sidebar"),
c.newModal({attributes:{space_id:null,text:d("Help others to work like me, share Podio #referrals"),due_date:e.data("due-date"),description:d("Refer others to Podio so they can work smarter, using the referral page: #referrals")+" "+e.attr("href")}})}function r(e,t){m.persistModalDismissal("disabled");var i=e.parents("#referrals_widget:first");i.fadeOut()}var d=e("translate"),l=e("jquery"),c=e("lib/Podio.UI.Tasks.Create"),h=e("lib/Podio.Transport"),u=e("lib/Podio.UI.Modal"),p=e("lib/Podio.Routes"),g=e("lib/Podio.Event.UI"),f=e("lib/Podio.Statsd"),m=(e("lib/Podio.Utils"),e("lib/Podio.Config"),{switchToThanksMode:function(){var e=l("#referral_teaser_content .thanks-section");e.removeClass("hidden");var t=l(".modal .content.referral-teaser .footer .close-button");t.length&&(t.text(d("Done #referrals")),t.removeClass("silver"),t.addClass("green"))},persistModalDismissal:function(e){h.putJSON(p.update_teaser_status_referrals_path(),{requestData:{status:e}})}});return g.bind("click","#referral_teaser_content .share-url .link, #referrals_widget .share-url .link, .button-copy-link",i),g.bind("click","#referral_teaser_content a.button-new",o,!0),g.bind("click",".modal .content.referral-teaser .footer .close-button",n),g.bind("click",".modal .content.referral-teaser .footer .assign-task",a),g.bind("click","#referrals_widget a.close",r),{show:t}}),define("root/home/Podio.UI.Home",["require","translate","underscore","jquery","lib/Podio.UI.FormEmbedActions","sections/referrals/Podio.UI.Referrals.Teaser","root/stream/Podio.UI.SpaceSwitcher","lib/Podio.Transport","lib/Podio.Transport.Picker","lib/Podio.Routes","lib/Podio.Router","lib/Podio.Event","lib/Podio.Statsd","lib/Podio.UI.CreateSpaceModal"],function(e){function t(e){var t=l(e.currentTarget);u.requestFromElement(t,function(e){var i=t.siblings(".action-dropdown-wrapper"),o=i.find("img.spinner");o.replaceWith(e.data.html)})}function i(e){l(e.currentTarget).siblings(".action-dropdown-wrapper").remove()}function o(e){e.preventDefault();var t=l(e.currentTarget),i=t.parents(".global-banner"),o=t.data("mail"),n=t.data("url");u.postJSON(n,{requestData:{mail:o}},function(e){"ok"===e.status&&i.find(".text").text(r("Verification has been resent. #account"))})}function n(e){c.signals.onFileUploadStarted.add(s),c.signals.onFileUploadFinished.add(a);var n=l("#home_stream .show-mutes");n.bind("action-dropdown.opened",t),n.bind("action-dropdown.closed",i),l(".global-banner a.js-resend-verification").one("click",o);var u=f.getHashes();if(u.status){var m=decodeURIComponent(u.status);d.defer(function(){l("#stream_composer textarea").val(m).trigger("input")}),f.goToHashRoute("")}else if(u.create_space_in||u.hasOwnProperty("create_space")){var v;u.create_space_in&&(v=parseInt(u.create_space_in,10)),_.show({newUrl:g.new_space_path({org_id:v}),title:r("Create a new space. #top_bar"),hideHandler:function(){return f.goToHashRoute(""),!0}})}h.initStreamSpaceSwitcher(p.getSpacePickerData)}function s(){h.disable()}function a(){h.enable()}var r=e("translate"),d=e("underscore"),l=e("jquery"),c=e("lib/Podio.UI.FormEmbedActions"),h=(e("sections/referrals/Podio.UI.Referrals.Teaser"),e("root/stream/Podio.UI.SpaceSwitcher")),u=e("lib/Podio.Transport"),p=e("lib/Podio.Transport.Picker"),g=e("lib/Podio.Routes"),f=e("lib/Podio.Router"),m=e("lib/Podio.Event"),_=(e("lib/Podio.Statsd"),e("lib/Podio.UI.CreateSpaceModal"));m.bind(m.Types.init,n)}),define("models/Podio.Models.AddDashboardWidget",["require","lib/backbone/Backbone.PodioModel"],function(e){var t=e("lib/backbone/Backbone.PodioModel");return t.extend({defaults:{type:"addWidget",rows:3,cols:1},getX:function(){return this.collection.getColsNumber()},getY:function(){return this.collection.getMaxYinColumn(this.getX())},getCols:function(){return this.get("cols")}})}),define("lib/backbone/FiltersFormattingMixin",["require","translate","underscore"],function(e){var t=e("translate"),i=e("underscore"),o=function(e){return-1!==["state","city","zip","country"].indexOf(e)},n=function(e){return 0===String(e).indexOf("voting_")};return{mapFiltersFromPresentation:function(e){return(e||[]).map(this.mapSingleFilterFromPresentation).reduce(function(e,t){return i.extend(e,t)},{})},mapSingleFilterFromPresentation:function(e){var t={},s=i.pluck(e.humanized_values,"value"),a=e.field_type;switch(a&&(n(a)?a="fivestar":o(a.split(":")[1])&&(a="location")),a){case"category":case"app":case"contact":case"tags":case"tag":case"created_via":case"fivestar":case"answer":s=i.pluck(s,"id"),s=s.map(function(e){return"_notset_"===e?null:e});break;case"location":s=i.pluck(s,"id","type","subfield"),s=s.map(function(e){return"_notset_"===e?null:e});break;case"created_by":case"last_edit_by":break;default:s=s[0]}return t[e.key]=s,t},mapFiltersForPresentation:function(e,t){return e.map(function(e){return this.filtersFormatter(e,t)}.bind(this))},getAppFieldTypeById:function(e,t){var o=t.get("fields").find_by_id(e);return i.isDefined(o)?o.get("type"):void 0},filtersFormatter:function(e,t){var o=this.getAppFieldTypeById(e.key,t)||e.key;return i.extend(e,{humanized_values:this.humanizedValuesFormatter(e.humanized_values,o),field_type:o})},humanizedValuesFormatter:function(e,o){return i.isArray(e)?e=e.map(function(e){return i.isUndefined(e.label)&&(e.label=e.value),i.isUndefined(e.value)&&i.extend(e,{value:"_notset_",label:t("Not set #app-filters")}),i.isObject(e.value)||(e.value={id:e.value}),e}):i.include(["number","progress","duration","calculation","money","date","created_on","last_edit_on"],o)&&(e=[e]),e}}}),define("models/Podio.Models.Widget",["require","translate","underscore","lib/backbone/Backbone.PodioModel","lib/Podio.Routes","lib/backbone/FiltersFormattingMixin","lib/backbone/Backbone.Mixins.Transport.API","lib/Podio.Time","moment"],function(e){var t=e("translate"),i=e("underscore"),o=e("lib/backbone/Backbone.PodioModel"),n=e("lib/Podio.Routes"),s=e("lib/backbone/FiltersFormattingMixin"),a=e("lib/backbone/Backbone.Mixins.Transport.API"),r=e("lib/Podio.Time"),d=e("moment"),l={eventHelper:{isToday:function(e){return r.current().isSame(d.tz(e.start_date,r.getUserTimeZone()),"day")},isAllDay:function(e){return!e.start_time&&!e.end_date||d.utc(e.start_utc).diff(d.utc(e.end_utc),"hours")>24}}},c=o.extend({MAX_COLS_COUNT:2,validation:{"data.url":{pattern:"url",required:!1}},labels:{"data.url":t("This #dashboard")},defaults:{x:1,y:1,rows:7,config:{limit:10}},initialize:function(){var e=this.get("config");this.set("config",i.extend(e,this.defaults.config)),this._super()},urlRootRails:function(){return n.dashboard_widgets_path({format:""})},urlRails:function(){return this.isNew()?this.urlRootRails():"{0}/{1}".format(this.urlRootRails(),this.get("id"))},paramRoot:"widget",urlRootAPI:function(){return"/widget"},urlAPI:function(){var e;if(this.isNew()){if(!this.get("ref_type")||!this.get("ref_id"))throw new Error("ref_type and ref_id must be set on the Widget model save a new widget to the API.");e="/{0}/{1}".format(this.get("ref_type"),this.get("ref_id"))}else e="/{0}".format(this.get("id"));return this.urlRootAPI()+e},destroy:function(){return this.request("delete",n.dashboard_widget_path(this.get("id")))},getOptions:function(){return this.request("get",n.options_dashboard_widget_path(this.get("id")))},getCols:function(){return i.min([this.MAX_COLS_COUNT,this.get("cols")])},getTitle:function(){return"profiles"===this.get("type")||i.isEmpty(this.get("title"))?this.defaultTitles[this.get("type")]:this.get("title")},toJSON:function(e){var t=this._super(),o=i.pick(t[this.paramRoot],"type","title","config","x","y","rows","cols","ref_type","ref_id");return this.useDirectAPIAccess?o:(t[this.paramRoot]=o,t)},bottomRow:function(){return this.get("y")+this.get("rows")},rightCol:function(){return this.get("x")+this.get("cols")-1},setDashboardData:function(e){return i.isObject(e)&&e.cols>this.MAX_COLS_COUNT&&(e.cols=this.MAX_COLS_COUNT),this.set(e)}},{fetchWidgetFilters:function(e,t){var o="/widget/{0}".format(e);return a.request("get",o).then(function(e){return i.isNull(e.config.calculation.filters)||(e.config.calculation.filters=s.mapFiltersForPresentation(e.config.calculation.filters,t)),e})}});return i.extend(c.prototype,s,l),c}),define("models/Podio.Models.TaskWidget",["require","models/Podio.Models.Widget"],function(e){var t=e("models/Podio.Models.Widget");return t.extend({defaults:{config:{kind:"mine"}}})}),define("models/Podio.Models.TextWidget",["require","models/Podio.Models.Widget","lib/view_helpers/markdown"],function(e){var t=e("models/Podio.Models.Widget"),i=e("lib/view_helpers/markdown");return t.extend({getFormattedText:function(){return i.formatMarkdown(this.get("config").text)}})}),define("models/Podio.Models.LinkWidget",["require","models/Podio.Models.Widget"],function(e){var t=e("models/Podio.Models.Widget");return t.extend({removeLinkByIndex:function(e){this.get("config").links.splice(e,1)}})}),define("root/dashboard/Podio.Dashboard.WidgetFactory",["require","translate","underscore","models/Podio.Models.Widget","models/Podio.Models.TaskWidget","models/Podio.Models.TextWidget","models/Podio.Models.LinkWidget","lib/backbone/Backbone.PodioCollection","lib/Podio.Utils"],function(e){var t=e("translate"),i=e("underscore"),o=e("models/Podio.Models.Widget"),n=e("models/Podio.Models.TaskWidget"),s=e("models/Podio.Models.TextWidget"),a=e("models/Podio.Models.LinkWidget"),r=(e("lib/backbone/Backbone.PodioCollection"),e("lib/Podio.Utils"));return{_prepareWidgetData:function(e,t,o,n){n=n||{},n.data=n.data||{};var s=i.extend(n.data,{type:t,title:"",ref:e});switch(n.supportsBlankSlate?s.id="blankCalculation":o&&(s.id=o),t){case"calculation":s.config={app_link:n.appUrl,icon_id:n.iconId},s.data={rights:n.rights};break;case"app_view":s.config={app_id:n.appId};break;case"text":s.config={text:"",limit:null};break;case"link":s.config={limit:10,links:[]},s.data=[];break;case"recent_items":s.rows=7}return s},_prepareWidgetModel:function(e,t){var i;switch(e){case"task":i=n;break;case"text":i=s;break;case"link":i=a;break;default:i=o}return i.prototype.defaultTitles=i.prototype.defaultTitles||{},i.prototype.defaultTitles[e]=this.getDefaultTitle(e,t.context),i},getDefaultTitle:function(e,i){var o={common:{calculation:t("New reporting widget #dashboard"),app_view:"Sample title",text:t("Text #dashboard"),image:t("Image #dashboard"),link:t("Links #dashboard")},home:{tasks:t("My tasks #dashboard"),events:t("My calendar #dashboard"),profiles:t(r.showFeature("contact_app_type")?"My Connections #contact_app_type":"People #dashboard"),apps:t("Favorite apps #dashboard"),recent_items:t("My recent items #dashboard")},space:{tasks:t("Workspace tasks #dashboard"),events:t("Workspace calendar #dashboard"),contacts:t("Workspace contacts #dashboard"),files:t("Workspace files #dashboard")},emp_network:{tasks:t("Employee network tasks #dashboard"),files:t("Employee network files #dashboard")},app:{tasks:t("App tasks #new_app_reporting"),reports:t("Reports & Charts #report_charts")}};return o.common[e]||o[i][e]},getWidgetModel:function(e,t,i,o){var n=this._prepareWidgetModel(t,o);return new n(this._prepareWidgetData(e,t,i,o))}}}),define("collections/Podio.Collections.Widget",["require","underscore","jquery","backbone","lib/backbone/Backbone.PodioCollection","root/dashboard/Podio.Dashboard.WidgetFactory","lib/Podio.Routes","lib/Podio.Utils","models/Podio.Models.User","models/Podio.Models.Widget"],function(e){var t=e("underscore"),i=e("jquery"),o=e("backbone"),n=e("lib/backbone/Backbone.PodioCollection"),s=e("root/dashboard/Podio.Dashboard.WidgetFactory"),a=e("lib/Podio.Routes"),r=(e("lib/Podio.Utils"),e("models/Podio.Models.User")),d=new r;return n.extend({initialize:function(e,t){this.ref=t?t.ref:null,this.context=t?t.context:null,this.useDirectAPIAccess=!0},parse:function(e){return e.forEach(function(e){e.id=e.widget_id}),this._super(e)},add:function(e,i){var n,a=this;n=i&&i.parse?this.parse(e):e,t.isArray(n)||(n=[n]),t.each(n,function(e){var t;e instanceof o.Model?a._super(e):(t=s.getWidgetModel(null,e.type,null,{context:a.context}),t.set(e),a._super(t))})},urlAPI:function(){return"/widget/{0}/{1}/display/".format(this.ref.type,this.ref.id)},urlRails:function(){return a.dashboard_widgets_path({ref_type:this.ref.type,ref_id:this.ref.id})},configure:function(){this.model=e("models/Podio.Models.Widget")},getColsNumber:function(){return 0===this.length?1:t.max(this.invoke("rightCol"))},getMaxYinColumn:function(e){var i=this.filter(function(t){return t.get("x")<=e&&e<=t.rightCol()});return 0===i.length?1:t.max(t.invoke(i,"bottomRow"))},setupDefaultDashboard:function(){if(d.getProperty("has_changed_dashboard"))return i.Deferred().resolve();if(d.setProperty("has_changed_dashboard",!0),0===this.length)return this.request("post",a.create_default_dashboard_dashboard_widgets_path(),{});var e={ref_type:this.ref.type,ref_id:this.ref.id};return i.when.apply(i,this.invoke("save",e))}})}),function(e,t,i,o){function n(t){return t[0]&&e.isPlainObject(t[0])?this.data=t[0]:this.el=t,this.isCoords=!0,this.coords={},this.init(),this}var s=n.prototype;s.init=function(){this.set(),this.original_coords=this.get()},s.set=function(e,t){var i=this.el;if(i&&!e&&(this.data=i.offset(),this.data.width=i.width(),this.data.height=i.height()),i&&e&&!t){var o=i.offset();this.data.top=o.top,this.data.left=o.left}var n=this.data;return this.coords.x1=n.left,this.coords.y1=n.top,this.coords.x2=n.left+n.width,this.coords.y2=n.top+n.height,this.coords.cx=n.left+n.width/2,this.coords.cy=n.top+n.height/2,this.coords.width=n.width,this.coords.height=n.height,this.coords.el=i||!1,this},s.update=function(t){if(!t&&!this.el)return this;if(t){var i=e.extend({},this.data,t);return this.data=i,this.set(!0,!0)}return this.set(!0),this},s.get=function(){return this.coords},e.fn.coords=function(){if(this.data("coords"))return this.data("coords");var e=new n(this,arguments[0]);return this.data("coords",e),e}}(jQuery,window,document),function(e,t,i,o){function n(t,i,o){this.options=e.extend(s,o),this.$element=t,this.last_colliders=[],this.last_colliders_coords=[],"string"==typeof i||i instanceof jQuery?this.$colliders=e(i,this.options.colliders_context).not(this.$element):this.colliders=e(i),this.init()}var s={colliders_context:i.body},a=n.prototype;a.init=function(){this.find_collisions()},a.overlaps=function(e,t){var i=!1,o=!1;return(t.x1>=e.x1&&t.x1<=e.x2||t.x2>=e.x1&&t.x2<=e.x2||e.x1>=t.x1&&e.x2<=t.x2)&&(i=!0),(t.y1>=e.y1&&t.y1<=e.y2||t.y2>=e.y1&&t.y2<=e.y2||e.y1>=t.y1&&e.y2<=t.y2)&&(o=!0),i&&o},a.detect_overlapping_region=function(e,t){var i="",o="";return e.y1>t.cy&&e.y1<t.y2&&(i="N"),e.y2>t.y1&&e.y2<t.cy&&(i="S"),e.x1>t.cx&&e.x1<t.x2&&(o="W"),e.x2>t.x1&&e.x2<t.cx&&(o="E"),i+o||"C"},a.calculate_overlapped_area_coords=function(t,i){var o=Math.max(t.x1,i.x1),n=Math.max(t.y1,i.y1),s=Math.min(t.x2,i.x2),a=Math.min(t.y2,i.y2);return e({left:o,top:n,width:s-o,height:a-n}).coords().get()},a.calculate_overlapped_area=function(e){return e.width*e.height},a.manage_colliders_start_stop=function(t,i,o){for(var n=this.last_colliders_coords,s=0,a=n.length;a>s;s++)-1===e.inArray(n[s],t)&&i.call(this,n[s]);for(var r=0,d=t.length;d>r;r++)-1===e.inArray(t[r],n)&&o.call(this,t[r])},a.find_collisions=function(t){for(var i=this,o=[],n=[],s=this.colliders||this.$colliders,a=s.length,r=i.$element.coords().update(t||!1).get();a--;){var d=i.$colliders?e(s[a]):s[a],l=d.isCoords?d:d.coords(),c=l.get(),h=i.overlaps(r,c);if(h){var u=i.detect_overlapping_region(r,c);if("C"===u){var p=i.calculate_overlapped_area_coords(r,c),g=i.calculate_overlapped_area(p),f={area:g,area_coords:p,region:u,coords:c,player_coords:r,el:d};i.options.on_overlap&&i.options.on_overlap.call(this,f),o.push(l),n.push(f)}}}return(i.options.on_overlap_stop||i.options.on_overlap_start)&&this.manage_colliders_start_stop(o,i.options.on_overlap_stop,i.options.on_overlap_start),this.last_colliders_coords=o,n},a.get_closest_colliders=function(e){var t=this.find_collisions(e);return t.sort(function(e,t){return"C"===e.region&&"C"===t.region?e.coords.y1<t.coords.y1||e.coords.x1<t.coords.x1?-1:1:(e.area<t.area,1)}),t},e.fn.collision=function(e,t){return new n(this,e,t)}}(jQuery,window,document),function(e,t){e.debounce=function(e,t,i){var o;return function(){var n=this,s=arguments,a=function(){o=null,i||e.apply(n,s)};i&&!o&&e.apply(n,s),clearTimeout(o),o=setTimeout(a,t)}},e.throttle=function(e,t){var i,o,n,s,a,r,d=debounce(function(){a=s=!1},t);return function(){i=this,o=arguments;var l=function(){n=null,a&&e.apply(i,o),d()};return n||(n=setTimeout(l,t)),s?a=!0:r=e.apply(i,o),d(),s=!0,r}}}(window),function(e,t,i,o){function n(t,o){this.options=e.extend({},s,o),this.$body=e(i.body),this.$container=e(t),this.$dragitems=e(this.options.items,this.$container),this.is_dragging=!1,this.player_min_left=0+this.options.offset_left,this.init()}var s={items:".gs_w",distance:1,limit:!0,offset_left:0,autoscroll:!0,ignore_dragging:["INPUT","TEXTAREA","SELECT","BUTTON"],handle:null},a=e(t),r=!!("ontouchstart"in t),d={start:"touchstart.gridster-draggable mousedown.gridster-draggable",move:"touchmove.gridster-draggable mousemove.gridster-draggable",end:"touchend.gridster-draggable mouseup.gridster-draggable"},l=n.prototype;l.init=function(){this.calculate_positions(),this.$container.css("position","relative"),this.disabled=!1,this.events(),this.on_window_resize=throttle(e.proxy(this.calculate_positions,this),200),e(t).bind("resize",this.on_window_resize)},l.events=function(){this.proxied_on_select_start=e.proxy(this.on_select_start,this),this.$container.on("selectstart",this.proxied_on_select_start),this.proxied_drag_handler=e.proxy(this.drag_handler,this),this.$container.on(d.start,this.options.items,this.proxied_drag_handler),this.proxied_pointer_events_end=e.proxy(function(e){this.is_dragging=!1,this.disabled||(this.$body.off(d.move),this.drag_start&&this.on_dragstop(e))},this),this.$body.on(d.end,this.proxied_pointer_events_end)},l.get_actual_pos=function(e){var t=e.position();return t},l.get_mouse_pos=function(e){if(e.originalEvent&&e.originalEvent.touches){var t=e.originalEvent;e=t.touches.length?t.touches[0]:t.changedTouches[0]}return{left:e.clientX,top:e.clientY}},l.get_offset=function(e){e.preventDefault();var t=this.get_mouse_pos(e),i=Math.round(t.left-this.mouse_init_pos.left),o=Math.round(t.top-this.mouse_init_pos.top),n=Math.round(this.el_init_offset.left+i-this.baseX),s=Math.round(this.el_init_offset.top+o-this.baseY+this.scrollOffset);return this.options.limit&&(n>this.player_max_left?n=this.player_max_left:n<this.player_min_left&&(n=this.player_min_left)),{left:n,top:s,mouse_left:t.left,mouse_top:t.top}},l.manage_scroll=function(e){var t,i=a.scrollTop(),o=i,n=o+this.window_height,s=n-50,r=o+50,d=(e.mouse_left,o+e.mouse_top),l=this.doc_height-this.window_height+this.player_height;d>=s&&(t=i+30,l>t&&(a.scrollTop(t),this.scrollOffset=this.scrollOffset+30)),r>=d&&(t=i-30,t>0&&(a.scrollTop(t),this.scrollOffset=this.scrollOffset-30))},l.calculate_positions=function(e){this.window_height=a.height()},l.drag_handler=function(t){t.target.nodeName;if(!this.disabled&&(1===t.which||r)&&!this.ignore_drag(t)){var i=this,o=!0;return this.$player=e(t.currentTarget),this.el_init_pos=this.get_actual_pos(this.$player),this.mouse_init_pos=this.get_mouse_pos(t),this.offsetY=this.mouse_init_pos.top-this.el_init_pos.top,this.on_pointer_events_move=function(e){var t=i.get_mouse_pos(e),n=Math.abs(t.left-i.mouse_init_pos.left),s=Math.abs(t.top-i.mouse_init_pos.top);return n>i.options.distance||s>i.options.distance?o?(o=!1,i.on_dragstart.call(i,e),!1):(i.is_dragging===!0&&i.on_dragmove.call(i,e),!1):!1},this.$body.on(d.move,this.on_pointer_events_move),!1}},l.on_dragstart=function(t){t.preventDefault(),this.drag_start=!0,this.is_dragging=!0;var o=this.$container.offset();return this.baseX=Math.round(o.left),this.baseY=Math.round(o.top),this.doc_height=e(i).height(),"clone"===this.options.helper?(this.$helper=this.$player.clone().appendTo(this.$container).addClass("helper"),this.helper=!0):this.helper=!1,this.scrollOffset=0,this.el_init_offset=this.$player.offset(),this.player_width=this.$player.width(),this.player_height=this.$player.height(),this.player_max_left=this.$container.width()-this.player_width+this.options.offset_left,this.options.start&&this.options.start.call(this.$player,t,{helper:this.helper?this.$helper:this.$player}),!1},l.on_dragmove=function(e){var t=this.get_offset(e);this.options.autoscroll&&this.manage_scroll(t),(this.helper?this.$helper:this.$player).css({position:"absolute",left:t.left,top:t.top});var i={position:{left:t.left,top:t.top}};return this.options.drag&&this.options.drag.call(this.$player,e,i),!1},l.on_dragstop=function(e){var t=this.get_offset(e);this.drag_start=!1;var i={position:{left:t.left,top:t.top}};return this.options.stop&&this.options.stop.call(this.$player,e,i),this.helper&&this.$helper.remove(),!1},l.on_select_start=function(e){return this.disabled||this.ignore_drag(e)?void 0:!1},l.enable=function(){this.disabled=!1},l.disable=function(){this.disabled=!0},l.destroy=function(){this.disable(),this.$container.off("selectstart",this.proxied_on_select_start),this.$container.off(d.start,this.proxied_drag_handler),this.$body.off(d.end,this.proxied_pointer_events_end),this.$body.off(d.move,this.on_pointer_events_move),e(t).unbind("resize",this.on_window_resize),e.removeData(this.$container,"drag")},l.ignore_drag=function(t){return this.options.handle?!e(t.target).is(this.options.handle):e.inArray(t.target.nodeName,this.options.ignore_dragging)>=0},e.fn.drag=function(t){return this.each(function(){e.data(this,"drag")||e.data(this,"drag",new n(this,t))})}}(jQuery,window,document),function(e,t,i,o){function n(t,i){this.options=e.extend(!0,s,i),this.$el=e(t),this.$wrapper=this.$el.parent(),this.$widgets=this.$el.children(this.options.widget_selector).addClass("gs_w"),this.widgets=[],this.$changed=e([]),this.wrapper_width=this.$wrapper.width(),this.min_widget_width=2*this.options.widget_margins[0]+this.options.widget_base_dimensions[0],this.min_widget_height=2*this.options.widget_margins[1]+this.options.widget_base_dimensions[1],this.init()}var s={namespace:"",widget_selector:"li",widget_margins:[10,10],widget_base_dimensions:[400,225],extra_rows:0,extra_cols:0,min_cols:1,min_rows:15,max_size_x:6,max_rows:Number.MAX_VALUE,max_cols:Number.MAX_VALUE,autogenerate_stylesheet:!0,avoid_overlapped_widgets:!0,serialize_params:function(e,t){return{col:t.col,row:t.row,size_x:t.size_x,size_y:t.size_y}},collision:{},draggable:{distance:4}};n.generated_stylesheets=[];var a=n.prototype;a.init=function(){this.generate_grid_and_stylesheet(),this.get_widgets_from_DOM(),this.set_dom_grid_height(),this.$wrapper.addClass("ready"),this.draggable(),this.on_window_resize=throttle(e.proxy(this.recalculate_faux_grid,this),200),e(t).bind("resize",this.on_window_resize)},a.disable=function(){return this.$wrapper.find(".player-revert").removeClass("player-revert"),this.drag_api.disable(),this},a.enable=function(){return this.drag_api.enable(),this},a.add_widget=function(t,i,o,n,s){var a;i||(i=1),o||(o=1),a=!n&!s?this.next_position(i,o):{col:n,row:s};var r=e(t).attr({"data-col":a.col,"data-row":a.row,"data-sizex":i,"data-sizey":o}).addClass("gs_w").appendTo(this.$el);return this.register_widget(r)?(this.move_widget_up(r,a.row),this.$widgets=this.$widgets.add(r),r):void r.remove()},a.resize_widget=function(t,i,o,n){var s=t.coords().grid;i||(i=Math.max(s.size_x,this.cols)),o||(o=s.size_y),n||(n=!1);var a=this.get_cells_occupied(s),r=s.size_x,d=s.size_y,l=s.col,c=l,h=i>r;if(l+i-1>this.cols){var u=l+(i-1)-this.cols,p=l-u;c=Math.max(1,p)}n&&!h&&(c+=r-i);var g={col:c,row:s.row,size_x:i,size_y:o},f=this.get_cells_occupied(g),m=[];e.each(a.cols,function(t,i){-1===e.inArray(i,f.cols)&&m.push(i)});var _=[];e.each(f.cols,function(t,i){-1===e.inArray(i,a.cols)&&_.push(i)});var v=[];e.each(a.rows,function(t,i){-1===e.inArray(i,f.rows)&&v.push(i)});var b=[];if(e.each(f.rows,function(t,i){-1===e.inArray(i,a.rows)&&b.push(i)}),this.remove_from_gridmap(s),_.length){var w=[c,s.row,i,Math.min(d,o),t];this.empty_cells.apply(this,w)}if(b.length){var y=[c,s.row,i,o,t];this.empty_cells.apply(this,y)}if(s.col=c,s.size_x=i,s.size_y=o,t.data("coords").update({width:i*this.options.widget_base_dimensions[0]+(i-1)*this.options.widget_margins[0]*2,height:o*this.options.widget_base_dimensions[1]+(o-1)*this.options.widget_margins[1]*2}),t.attr({"data-col":c,"data-sizex":i,"data-sizey":o}),this.add_to_gridmap(g,t),m.length){var k=[m[0],s.row,m.length,Math.min(d,o),t];this.remove_empty_cells.apply(this,k)}if(v.length){var P=[c,s.row,i,o,t];this.remove_empty_cells.apply(this,P)}return this.move_widget_up(t,s.row),this.$changed=this.$changed.add(t),t},a.empty_cells=function(t,i,o,n,s){var a=this.widgets_below({col:t,row:i-n,size_x:o,size_y:n});return a.not(s).each(e.proxy(function(t,o){var s=e(o).coords().grid;if(s.row<=i+n-1){var a=i+n-s.row;this.move_widget_down(e(o),a)}},this)),this.set_dom_grid_height(),this},a.remove_empty_cells=function(t,i,o,n,s){var a=this.widgets_below({col:t,row:i,size_x:o,size_y:n});return a.not(s).each(e.proxy(function(t,i){this.move_widget_up(e(i),n)},this)),this.set_dom_grid_height(),this},a.next_position=function(e,t){e||(e=1),t||(t=1);for(var i,o=this.gridmap,n=o.length,s=[],a=1;n>a;a++){i=o[a].length;for(var r=1;i>r;r++){var d=this.can_move_to({size_x:e,size_y:t},a,r);d&&s.push({col:a,row:r,size_y:t,size_x:e})}}return s.length?this.sort_by_row_and_col_asc(s)[0]:!1},a.remove_widget=function(t,i,o){var n=t instanceof jQuery?t:e(t),s=n.coords().grid;e.isFunction(i)&&(o=i,i=!1),this.cells_occupied_by_placeholder={},this.$widgets=this.$widgets.not(n);var a=this.widgets_below(n);this.remove_from_gridmap(s);var r=e.Deferred();return n.fadeOut(50,e.proxy(function(){n.remove(),i||a.each(e.proxy(function(t,i){this.move_widget_up(e(i),s.size_y)},this)),this.set_dom_grid_height(),r.resolve(this),o&&o.call(this,t)},this)),r},a.remove_all_widgets=function(t){return this.$widgets.each(e.proxy(function(e,i){this.remove_widget(i,!0,t)},this)),this},a.serialize=function(t){t||(t=this.$widgets);var i=[];return t.each(e.proxy(function(t,o){i.push(this.options.serialize_params(e(o),e(o).coords().grid))},this)),i},a.serialize_changed=function(){return this.serialize(this.$changed)},a.register_widget=function(e){var t={col:parseInt(e.attr("data-col"),10),row:parseInt(e.attr("data-row"),10),size_x:parseInt(e.attr("data-sizex"),10),size_y:parseInt(e.attr("data-sizey"),10),el:e};if(this.options.avoid_overlapped_widgets&&!this.can_move_to({size_x:t.size_x,size_y:t.size_y},t.col,t.row)){if(t=this.next_position(t.size_x,t.size_y),!t)return!1;t.el=e,e.attr({"data-col":t.col,"data-row":t.row,"data-sizex":t.size_x,"data-sizey":t.size_y}),this.$changed=this.$changed.add(e)}return e.data("coords",e.coords()),e.data("coords").grid=t,this.add_to_gridmap(t,e),this.set_dom_grid_height(),this},a.update_widget_position=function(e,t){return this.for_each_cell_occupied(e,function(e,i){return this.gridmap[e]?void(this.gridmap[e][i]=t):this}),this},a.remove_from_gridmap=function(e){this.update_widget_position(e,!1)},a.add_to_gridmap=function(t,i){var o=Math.min(t.col+t.size_x-1+this.options.extra_cols-this.cols,this.options.max_cols-this.cols);o>0&&this.add_faux_cols(o);var n=Math.min(t.row+t.size_y-1+this.options.extra_rows-this.rows,this.options.max_rows-this.rows);if(n>0&&this.add_faux_rows(n),this.update_widget_position(t,i||t.el),t.el){var s=this.widgets_below(t.el);s.each(e.proxy(function(t,i){this.move_widget_up(e(i))},this))}},a.draggable=function(){var t=this,i=e.extend(!0,{},this.options.draggable,{offset_left:this.options.widget_margins[0],start:function(i,o){t.$widgets.filter(".player-revert").removeClass("player-revert"),t.$player=e(this),t.$helper="clone"===t.options.draggable.helper?e(o.helper):t.$player,t.helper=!t.$helper.is(t.$player),t.on_start_drag.call(t,i,o),t.$el.trigger("gridster:dragstart")},stop:function(e,i){t.on_stop_drag.call(t,e,i),t.$el.trigger("gridster:dragstop")},drag:throttle(function(e,i){t.on_drag.call(t,e,i),t.$el.trigger("gridster:drag")},60)});return this.drag_api=this.$el.drag(i).data("drag"),this},a.on_start_drag=function(t,i){this.$helper.add(this.$player).add(this.$wrapper).addClass("dragging"),this.$player.addClass("player"),this.player_grid_data=this.$player.coords().grid,this.placeholder_grid_data=e.extend({},this.player_grid_data),this.$el.css("height",this.$el.height()+this.player_grid_data.size_y*this.min_widget_height);var o=this.faux_grid,n=this.$player.data("coords").coords;this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data),this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data),this.last_cols=[],this.last_rows=[],this.collision_api=this.$helper.collision(o,this.options.collision),this.$preview_holder=e("<li />",{"class":"preview-holder","data-row":this.$player.attr("data-row"),"data-col":this.$player.attr("data-col"),css:{width:n.width,height:n.height}}).appendTo(this.$el),this.options.draggable.start&&this.options.draggable.start.call(this,t,i)},a.on_drag=function(e,t){if(null===this.$player)return!1;var i={left:t.position.left+this.baseX,top:t.position.top+this.baseY};this.colliders_data=this.collision_api.get_closest_colliders(i),this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column),this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row),this.helper&&this.$player&&this.$player.css({left:t.position.left,top:t.position.top}),this.options.draggable.drag&&this.options.draggable.drag.call(this,e,t)},a.on_stop_drag=function(e,t){this.$helper.add(this.$player).add(this.$wrapper).removeClass("dragging"),t.position.left=t.position.left+this.baseX,t.position.top=t.position.top+this.baseY,this.colliders_data=this.collision_api.get_closest_colliders(t.position),this.on_overlapped_column_change(this.on_start_overlapping_column,this.on_stop_overlapping_column),this.on_overlapped_row_change(this.on_start_overlapping_row,this.on_stop_overlapping_row),this.$player.addClass("player-revert").removeClass("player").attr({"data-col":this.placeholder_grid_data.col,"data-row":this.placeholder_grid_data.row}).css({left:"",top:""}),this.$changed=this.$changed.add(this.$player),this.cells_occupied_by_player=this.get_cells_occupied(this.placeholder_grid_data),this.set_cells_player_occupies(this.placeholder_grid_data.col,this.placeholder_grid_data.row),this.$player.coords().grid.row=this.placeholder_grid_data.row,this.$player.coords().grid.col=this.placeholder_grid_data.col,this.options.draggable.stop&&this.options.draggable.stop.call(this,e,t),this.$preview_holder.remove(),this.$player=null,this.$helper=null,this.placeholder_grid_data={},this.player_grid_data={},this.cells_occupied_by_placeholder={},this.cells_occupied_by_player={},this.set_dom_grid_height()},a.on_overlapped_column_change=function(t,i){if(!this.colliders_data.length)return this;var o,n=this.get_targeted_columns(this.colliders_data[0].el.data.col),s=this.last_cols.length,a=n.length;for(o=0;a>o;o++)-1===e.inArray(n[o],this.last_cols)&&(t||e.noop).call(this,n[o]);for(o=0;s>o;o++)-1===e.inArray(this.last_cols[o],n)&&(i||e.noop).call(this,this.last_cols[o]);return this.last_cols=n,this},a.on_overlapped_row_change=function(t,i){if(!this.colliders_data.length)return this;var o,n=this.get_targeted_rows(this.colliders_data[0].el.data.row),s=this.last_rows.length,a=n.length;for(o=0;a>o;o++)-1===e.inArray(n[o],this.last_rows)&&(t||e.noop).call(this,n[o]);for(o=0;s>o;o++)-1===e.inArray(this.last_rows[o],n)&&(i||e.noop).call(this,this.last_rows[o]);this.last_rows=n},a.set_player=function(e,t,i){var o=this;i||this.empty_cells_player_occupies();var n=i?{col:e}:o.colliders_data[0].el.data,s=n.col,a=t||n.row;this.player_grid_data={col:s,row:a,size_y:this.player_grid_data.size_y,size_x:this.player_grid_data.size_x},this.cells_occupied_by_player=this.get_cells_occupied(this.player_grid_data);
var r=this.get_widgets_overlapped(this.player_grid_data),d=this.widgets_constraints(r);if(this.manage_movements(d.can_go_up,s,a),this.manage_movements(d.can_not_go_up,s,a),!r.length){var l=this.can_go_player_up(this.player_grid_data);l!==!1&&(a=l),this.set_placeholder(s,a)}return{col:s,row:a}},a.widgets_constraints=function(t){var i,o=e([]),n=[],s=[];return t.each(e.proxy(function(t,i){var a=e(i),r=a.coords().grid;this.can_go_widget_up(r)?(o=o.add(a),n.push(r)):s.push(r)},this)),i=t.not(o),{can_go_up:this.sort_by_row_asc(n),can_not_go_up:this.sort_by_row_desc(s)}},a.sort_by_row_asc=function(t){return t=t.sort(function(t,i){return t.row||(t=e(t).coords().grid,i=e(i).coords().grid),t.row>i.row?1:-1})},a.sort_by_row_and_col_asc=function(e){return e=e.sort(function(e,t){return e.row>t.row||e.row===t.row&&e.col>t.col?1:-1})},a.sort_by_col_asc=function(e){return e=e.sort(function(e,t){return e.col>t.col?1:-1})},a.sort_by_row_desc=function(e){return e=e.sort(function(e,t){return e.row+e.size_y<t.row+t.size_y?1:-1})},a.manage_movements=function(t,i,o){return e.each(t,e.proxy(function(e,t){var n=t,s=n.el,a=this.can_go_widget_up(n);if(a)this.move_widget_to(s,a),this.set_placeholder(i,a+n.size_y);else{var r=this.can_go_player_up(this.player_grid_data);if(!r){var d=o+this.player_grid_data.size_y-n.row;this.move_widget_down(s,d),this.set_placeholder(i,o)}}},this)),this},a.is_player=function(e,t){if(t&&!this.gridmap[e])return!1;var i=t?this.gridmap[e][t]:e;return i&&(i.is(this.$player)||i.is(this.$helper))},a.is_player_in=function(t,i){var o=this.cells_occupied_by_player||{};return e.inArray(t,o.cols)>=0&&e.inArray(i,o.rows)>=0},a.is_placeholder_in=function(t,i){var o=this.cells_occupied_by_placeholder||{};return this.is_placeholder_in_col(t)&&e.inArray(i,o.rows)>=0},a.is_placeholder_in_col=function(t){var i=this.cells_occupied_by_placeholder||[];return e.inArray(t,i.cols)>=0},a.is_empty=function(e,t){return"undefined"!=typeof this.gridmap[e]&&"undefined"!=typeof this.gridmap[e][t]&&this.gridmap[e][t]===!1?!0:!1},a.is_occupied=function(e,t){return this.gridmap[e]&&this.gridmap[e][t]?!0:!1},a.is_widget=function(e,t){var i=this.gridmap[e];return i?(i=i[t],i?i:!1):!1},a.is_widget_under_player=function(e,t){return this.is_widget(e,t)?this.is_player_in(e,t):!1},a.get_widgets_under_player=function(t){t||(t=this.cells_occupied_by_player||{cols:[],rows:[]});var i=e([]);return e.each(t.cols,e.proxy(function(o,n){e.each(t.rows,e.proxy(function(e,t){this.is_widget(n,t)&&(i=i.add(this.gridmap[n][t]))},this))},this)),i},a.set_placeholder=function(t,i){var o=e.extend({},this.placeholder_grid_data),n=this.widgets_below({col:o.col,row:o.row,size_y:o.size_y,size_x:o.size_x}),s=t+o.size_x-1;s>this.cols&&(t-=s-t);var a=this.placeholder_grid_data.row<i,r=this.placeholder_grid_data.col!==t;this.placeholder_grid_data.col=t,this.placeholder_grid_data.row=i,this.cells_occupied_by_placeholder=this.get_cells_occupied(this.placeholder_grid_data),this.$preview_holder.attr({"data-row":i,"data-col":t}),(a||r)&&n.each(e.proxy(function(i,n){this.move_widget_up(e(n),this.placeholder_grid_data.col-t+o.size_y)},this));var d=this.get_widgets_under_player(this.cells_occupied_by_placeholder);d.length&&d.each(e.proxy(function(t,n){var s=e(n);this.move_widget_down(s,i+o.size_y-s.data("coords").grid.row)},this))},a.can_go_player_up=function(e){var t=e.row+e.size_y-1,i=!0,o=[],n=1e4,s=this.get_widgets_under_player();return this.for_each_column_occupied(e,function(e){var a=this.gridmap[e],r=t+1;for(o[e]=[];--r>0&&(this.is_empty(e,r)||this.is_player(e,r)||this.is_widget(e,r)&&a[r].is(s));)o[e].push(r),n=n>r?r:n;return 0===o[e].length?(i=!1,!0):void o[e].sort()}),i?this.get_valid_rows(e,o,n):!1},a.can_go_widget_up=function(e){var t=e.row+e.size_y-1,i=!0,o=[],n=1e4;return this.for_each_column_occupied(e,function(s){var a=this.gridmap[s];o[s]=[];for(var r=t+1;--r>0&&(!this.is_widget(s,r)||this.is_player_in(s,r)||a[r].is(e.el));)this.is_player(s,r)||this.is_placeholder_in(s,r)||this.is_player_in(s,r)||o[s].push(r),n>r&&(n=r);return 0===o[s].length?(i=!1,!0):void o[s].sort()}),i?this.get_valid_rows(e,o,n):!1},a.get_valid_rows=function(t,i,o){for(var n=t.row,s=t.row+t.size_y-1,a=t.size_y,r=o-1,d=[];++r<=s;){var l=!0;if(e.each(i,function(t,i){e.isArray(i)&&-1===e.inArray(r,i)&&(l=!1)}),l===!0&&(d.push(r),d.length===a))break}var c=!1;return 1===a?d[0]!==n&&(c=d[0]||!1):d[0]!==n&&(c=this.get_consecutive_numbers_index(d,a)),c},a.get_consecutive_numbers_index=function(e,t){for(var i=e.length,o=[],n=!0,s=-1,a=0;i>a;a++){if(n||e[a]===s+1){if(o.push(a),o.length===t)break;n=!1}else o=[],n=!0;s=e[a]}return o.length>=t?e[o[0]]:!1},a.get_widgets_overlapped=function(){var t=e([]),i=[],o=this.cells_occupied_by_player.rows.slice(0);return o.reverse(),e.each(this.cells_occupied_by_player.cols,e.proxy(function(n,s){e.each(o,e.proxy(function(o,n){if(!this.gridmap[s])return!0;var a=this.gridmap[s][n];this.is_occupied(s,n)&&!this.is_player(a)&&-1===e.inArray(a,i)&&(t=t.add(a),i.push(a))},this))},this)),t},a.on_start_overlapping_column=function(e){this.set_player(e,!1)},a.on_start_overlapping_row=function(e){this.set_player(!1,e)},a.on_stop_overlapping_column=function(e){this.set_player(e,!1);var t=this;this.for_each_widget_below(e,this.cells_occupied_by_player.rows[0],function(e,i){t.move_widget_up(this,t.player_grid_data.size_y)})},a.on_stop_overlapping_row=function(e){this.set_player(!1,e);for(var t=this,i=this.cells_occupied_by_player.cols,o=0,n=i.length;n>o;o++)this.for_each_widget_below(i[o],e,function(e,i){t.move_widget_up(this,t.player_grid_data.size_y)})},a.move_widget_to=function(t,i){var o=this,n=t.coords().grid,s=(i-n.row,this.widgets_below(t)),a=this.can_move_to(n,n.col,i,t);return a===!1?!1:(this.remove_from_gridmap(n),n.row=i,this.add_to_gridmap(n),t.css("top",""),t.attr("data-row",i),this.$changed=this.$changed.add(t),s.each(function(t,i){var n=e(i),s=n.coords().grid,a=o.can_go_widget_up(s);a&&a!==s.row&&o.move_widget_to(n,a)}),this)},a.move_widget_up=function(t,i){var o=t.coords().grid,n=o.row,s=[];return i||(i=1),this.can_go_up(t)?void this.for_each_column_occupied(o,function(o){if(-1===e.inArray(t,s)){var a=t.coords().grid,r=n-i;if(r=this.can_go_up_to_row(a,o,r),!r)return!0;var d=this.widgets_below(t);this.remove_from_gridmap(a),a.row=r,this.add_to_gridmap(a),t.css("top",""),t.attr("data-row",a.row),this.$changed=this.$changed.add(t),s.push(t),d.each(e.proxy(function(t,o){this.move_widget_up(e(o),i)},this))}}):!1},a.move_widget_down=function(t,i){var o=t.coords().grid,n=o.row,s=[],a=i;if(!t)return!1;if(-1===e.inArray(t,s)){var r=t.coords().grid,d=n+i,l=this.widgets_below(t);this.remove_from_gridmap(r),l.each(e.proxy(function(t,i){var o=e(i),n=o.coords().grid,s=this.displacement_diff(n,r,a);s>0&&this.move_widget_down(o,s)},this)),r.row=d,this.add_to_gridmap(r,t),t.css("top",""),t.attr("data-row",r.row),this.$changed=this.$changed.add(t),s.push(t)}},a.can_go_up_to_row=function(t,i,o){var n,s=this.gridmap,a=!0,r=[],d=t.row;if(this.for_each_column_occupied(t,function(e){s[e];for(r[e]=[],n=d;n--&&this.is_empty(e,n)&&!this.is_placeholder_in(e,n);)r[e].push(n);return r[e].length?void 0:(a=!1,!0)}),!a)return!1;for(n=o,n=1;d>n;n++){for(var l=!0,c=0,h=r.length;h>c;c++)r[c]&&-1===e.inArray(n,r[c])&&(l=!1);if(l===!0){a=n;break}}return a},a.displacement_diff=function(e,t,i){var o=e.row,n=[],s=t.row+t.size_y;this.for_each_column_occupied(e,function(e){for(var t=0,i=s;o>i;i++)this.is_empty(e,i)&&(t+=1);n.push(t)});var a=Math.max.apply(Math,n);return i-=a,i>0?i:0},a.widgets_below=function(t){var i=e.isPlainObject(t)?t:t.coords().grid,o=this,n=(this.gridmap,i.row+i.size_y-1),s=e([]);return this.for_each_column_occupied(i,function(t){o.for_each_widget_below(t,n,function(t,i){return o.is_player(this)||-1!==e.inArray(this,s)?void 0:(s=s.add(this),!0)})}),this.sort_by_row_asc(s)},a.set_cells_player_occupies=function(e,t){return this.remove_from_gridmap(this.placeholder_grid_data),this.placeholder_grid_data.col=e,this.placeholder_grid_data.row=t,this.add_to_gridmap(this.placeholder_grid_data,this.$player),this},a.empty_cells_player_occupies=function(){return this.remove_from_gridmap(this.placeholder_grid_data),this},a.can_go_up=function(e){var t=e.coords().grid,i=t.row,o=i-1,n=(this.gridmap,!0);return 1===i?!1:(this.for_each_column_occupied(t,function(e){this.is_widget(e,o);return this.is_occupied(e,o)||this.is_player(e,o)||this.is_placeholder_in(e,o)||this.is_player_in(e,o)?(n=!1,!0):void 0}),n)},a.can_move_to=function(e,t,i){var o=(this.gridmap,e.el),n={size_y:e.size_y,size_x:e.size_x,col:t,row:i},s=!0,a=t+e.size_x-1;return a>this.options.max_cols?!1:this.options.max_rows&&this.options.max_rows<i+e.size_y-1?!1:(this.for_each_cell_occupied(n,function(t,i){var n=this.is_widget(t,i);!n||e.el&&!n.is(o)||(s=!1)}),s)},a.get_targeted_columns=function(e){for(var t=(e||this.player_grid_data.col)+(this.player_grid_data.size_x-1),i=[],o=e;t>=o;o++)i.push(o);return i},a.get_targeted_rows=function(e){for(var t=(e||this.player_grid_data.row)+(this.player_grid_data.size_y-1),i=[],o=e;t>=o;o++)i.push(o);return i},a.get_cells_occupied=function(e){var t,i={cols:[],rows:[]};for(arguments[1]instanceof jQuery&&(e=arguments[1].coords().grid),t=0;t<e.size_x;t++){var o=e.col+t;i.cols.push(o)}for(t=0;t<e.size_y;t++){var n=e.row+t;i.rows.push(n)}return i},a.for_each_cell_occupied=function(e,t){return this.for_each_column_occupied(e,function(i){this.for_each_row_occupied(e,function(e){t.call(this,i,e)})}),this},a.for_each_column_occupied=function(e,t){for(var i=0;i<e.size_x;i++){var o=e.col+i;t.call(this,o,e)}},a.for_each_row_occupied=function(e,t){for(var i=0;i<e.size_y;i++){var o=e.row+i;t.call(this,o,e)}},a._traversing_widgets=function(t,i,o,n,s){var a=this.gridmap;if(a[o]){var r,d,l=t+"/"+i;if(arguments[2]instanceof jQuery){var c=arguments[2].coords().grid;o=c.col,n=c.row,s=arguments[3]}var h=[],u=n,p={"for_each/above":function(){for(;u--&&!(u>0&&this.is_widget(o,u)&&-1===e.inArray(a[o][u],h)&&(r=s.call(a[o][u],o,u),h.push(a[o][u]),r)););},"for_each/below":function(){for(u=n+1,d=a[o].length;d>u&&(!this.is_widget(o,u)||-1!==e.inArray(a[o][u],h)||(r=s.call(a[o][u],o,u),h.push(a[o][u]),!r));u++);}};p[l]&&p[l].call(this)}},a.for_each_widget_above=function(e,t,i){return this._traversing_widgets("for_each","above",e,t,i),this},a.for_each_widget_below=function(e,t,i){return this._traversing_widgets("for_each","below",e,t,i),this},a.get_highest_occupied_cell=function(){for(var e,t=this.gridmap,i=[],o=[],n=t.length-1;n>=1;n--)for(e=t[n].length-1;e>=1;e--)if(this.is_widget(n,e)){i.push(e),o[e]=n;break}var s=Math.max.apply(Math,i);return this.highest_occupied_cell={col:o[s],row:s},this.highest_occupied_cell},a.get_widgets_from=function(t,i){var o=(this.gridmap,e());return t&&(o=o.add(this.$widgets.filter(function(){var i=e(this).attr("data-col");return i===t||i>t}))),i&&(o=o.add(this.$widgets.filter(function(){var t=e(this).attr("data-row");return t===i||t>i}))),o},a.set_dom_grid_height=function(){return this.$el.css("height",this.rows*this.min_widget_height),this},a.generate_stylesheet=function(t){var i,o="",s=this.options.max_size_x;t||(t={}),t.cols||(t.cols=this.cols),t.rows||(t.rows=this.rows),t.namespace||(t.namespace=this.options.namespace),t.widget_base_dimensions||(t.widget_base_dimensions=this.options.widget_base_dimensions),t.widget_margins||(t.widget_margins=this.options.widget_margins),t.min_widget_width=2*t.widget_margins[0]+t.widget_base_dimensions[0],t.min_widget_height=2*t.widget_margins[1]+t.widget_base_dimensions[1];var a=e.param(t);for(e.inArray(a,n.generated_stylesheets)>=0,n.generated_stylesheets.push(a),i=t.cols;i>=0;i--)o+=t.namespace+' [data-col="'+(i+1)+'"] { left:'+(i*t.widget_base_dimensions[0]+2*i*t.widget_margins[0])+"px;} ";for(i=t.rows;i>=0;i--)o+=t.namespace+' [data-row="'+(i+1)+'"] { top:'+(i*t.widget_base_dimensions[1]+2*i*t.widget_margins[1])+"px;} ";for(var r=1;r<=t.rows;r++)o+=t.namespace+' [data-sizey="'+r+'"] { height:'+(r*t.widget_base_dimensions[1]+(r-1)*(2*t.widget_margins[1]))+"px;}";for(var d=1;s>=d;d++)o+=t.namespace+' [data-sizex="'+d+'"] { width:'+(d*t.widget_base_dimensions[0]+(d-1)*(2*t.widget_margins[0]))+"px;}";return this.add_style_tag(o)},a.add_style_tag=function(e){var t=i,o=t.createElement("style");return t.getElementsByTagName("head")[0].appendChild(o),o.setAttribute("type","text/css"),o.setAttribute("generated-from","gridster"),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(i.createTextNode(e)),this},a.generate_faux_grid=function(e,t){this.faux_grid=[],this.gridmap=[];var i,o;for(i=1;t>=i;i++)for(this.gridmap[i]=[],o=1;e>=o;o++)this.add_faux_cell(o,i);return this},a.add_faux_cell=function(t,i){var o=e({left:this.baseX+(i-1)*this.min_widget_width,top:this.baseY+(t-1)*this.min_widget_height,width:this.min_widget_width,height:this.min_widget_height,col:i,row:t,original_col:i,original_row:t}).coords();return e.isArray(this.gridmap[i])||(this.gridmap[i]=[]),this.gridmap[i][t]=!1,this.faux_grid.push(o),this},a.add_faux_rows=function(e){for(var t=Math.min(this.rows+(e||1),this.options.max_rows),i=1;i<=this.cols;i++)for(var o=this.rows+1;t>=o;o++)this.add_faux_cell(o,i);return this.rows=t,this.options.autogenerate_stylesheet&&this.generate_stylesheet(),this},a.add_faux_cols=function(e){for(var t=Math.min(this.cols+(e||1),this.options.max_cols),i=this.cols+1;t>=i;i++)for(var o=1;o<=this.rows;o++)this.add_faux_cell(o,i);return this.cols=t,this.options.autogenerate_stylesheet&&this.generate_stylesheet(),this},a.recalculate_faux_grid=function(){var i=this.$wrapper.width();return this.baseX=(e(t).width()-i)/2,this.baseY=this.$wrapper.offset().top,e.each(this.faux_grid,e.proxy(function(e,t){this.faux_grid[e]=t.update({left:this.baseX+(t.data.col-1)*this.min_widget_width,top:this.baseY+(t.data.row-1)*this.min_widget_height})},this)),this},a.get_widgets_from_DOM=function(){return this.$widgets.each(e.proxy(function(t,i){this.register_widget(e(i))},this)),this},a.generate_grid_and_stylesheet=function(){var i=this.$wrapper.width(),o=(this.$wrapper.height(),Math.floor(i/this.min_widget_width)+this.options.extra_cols),n=this.$widgets.map(function(){return e(this).attr("data-col")});n=Array.prototype.slice.call(n,0),n.length||(n=[0]);var s=Math.max.apply(Math,n),a=this.options.extra_rows;return this.$widgets.each(function(t,i){a+=+e(i).attr("data-sizey")}),this.cols=Math.min(Math.max(s,o,this.options.min_cols),this.options.max_cols),this.rows=Math.min(Math.max(a,this.options.min_rows),this.options.max_rows),this.baseX=(e(t).width()-i)/2,this.baseY=this.$wrapper.offset().top,this.options.autogenerate_stylesheet&&this.generate_stylesheet(),this.generate_faux_grid(this.rows,this.cols)},a.destroy=function(){e(t).unbind("resize",this.on_window_resize),this.drag_api&&this.drag_api.destroy(),this.$el.remove()},a.resize_widget_dimensions=function(t){return t.widget_margins&&(this.options.widget_margins=t.widget_margins),t.widget_base_dimensions&&(this.options.widget_base_dimensions=t.widget_base_dimensions),this.min_widget_width=2*this.options.widget_margins[0]+this.options.widget_base_dimensions[0],this.min_widget_height=2*this.options.widget_margins[1]+this.options.widget_base_dimensions[1],this.$widgets.each(e.proxy(function(t,i){var o=e(i).coords(),n=o.grid;o.update({width:n.size_x*this.options.widget_base_dimensions[0]+(n.size_x-1)*this.options.widget_margins[0]*2,height:n.size_y*this.options.widget_base_dimensions[1]+(n.size_y-1)*this.options.widget_margins[1]*2})},this)),e('head [generated-from="gridster"]:not(:last)').remove(),this.generate_stylesheet(),this.set_dom_grid_height(),!1},e.fn.gridster=function(t){return this.each(function(){e(this).data("gridster")||e(this).data("gridster",new n(this,t))})},e.Gridster=a}(jQuery,window,document),define("lib/jquery/jquery.gridster",["jquery"],function(){}),define("views/dashboard/Podio.Views.Dashboard",["require","underscore","jquery","jquery-ui","lib/jquery/jquery.gridster","lib/backbone/Backbone.PodioView","lib/Podio.Event"],function(e){var t=e("underscore"),i=e("jquery");e("jquery-ui"),e("lib/jquery/jquery.gridster");var o=e("lib/backbone/Backbone.PodioView"),n=e("lib/Podio.Event");return o.extend({tagName:"ul",className:"gridster",initialize:function(e){this._super(),t.bindAll(this,"adaptColumnWidthToContainer","resizeWidget","addWidgetView","render","_notifyWidgets","onWidgetDragStart","onWidgetDragEnd"),this.widgetViews=[],this.gridMargin=e.gridMargin||8,this.gridWidth=e.gridWidth||348,this.rowHeight=e.rowHeight||48,this.gridHeight=e.gridHeight||this.rowHeight-2*this.gridMargin,this.minRows=e.minRows||5,this.minCols=e.minCols||2,this.maxRows=e.maxRows||200,this.maxCols=e.maxCols||2,this.extraRows=e.extraRows||5,this.currentGridWidth=this.gridWidth,e.elmContainer.append(this.elm),this._initGridster(),this.adaptColumnWidthToContainer(),this.resizeHandler=this.adaptColumnWidthToContainer.bind(this),n.bind("resize",this.resizeHandler,this)},removeWidgetView:function(e,t){var i=this;if(this.widgetViews.remove(e),!t||!t.keepGridsterWidget){var o=t&&t.gridsterBlock||e.elm.closest("li.gridster-block");return this.gridster.remove_widget(o).done(function(){e.dispose(),i._notifyWidgets()})}e.dispose()},getWidgetClass:function(e){var t="gridster-block "+e.model.get("type")+"-wrapper sizey";return e.draggable()&&(t+=" draggable-widget"),t},replaceWidgetClass:function(e,t){var i=t.attr("class"),o=i.replace(/\w+\-wrapper/,e.model.get("type")+"-wrapper");t.attr("class",o)},addWidgetView:function(e,t,i){t?(e.gridsterWidget=this.lastWidget,t.append(e.elm),this.replaceWidgetClass(e,t),this.resizeGridsterWidget(t,e.cols(),e.rows(),!1),e.draggable()&&t.addClass("draggable-widget"),e.resizable()&&this.enableResizingOf(t,e.minRows()),i&&i.rememberView&&this.widgetViews.push(e)):this.addWidgetViewByCoordinates(e,{cols:e.cols(),rows:e.rows(),x:e.x(),y:e.y()})},addWidgetViewByCoordinates:function(e,t){this.widgetViews.push(e);var o=i("<li/>",{"class":this.getWidgetClass(e)});e.resizable()&&this.enableResizingOf(o,e.minRows()),e.gridsterWidget=this.gridster.add_widget(o,t.cols,t.rows,t.x,t.y),this.lastWidget=e.gridsterWidget,this._notifyWidgets()},resizeWidget:function(e,i,o){t.isUndefined(i)&&(i=!1);var n=50,s=Math.round;o&&(s=Math.abs(o)>n==o>0?Math.ceil:Math.floor);var a=e.width()/(this.currentGridWidth+this.gridMargin);a=Math.min(Math.max(s(a),1),this.maxCols);var r=e.height()/(this.gridHeight+2*this.gridMargin);r=Math.round(r),this.resizeGridsterWidget(e,a,r,i)},resizeGridsterWidget:function(e,t,i,o){this.gridster&&(e.find(".gridster-widget").trigger("widget:resized"),this.gridster.resize_widget(e,t,i,o),this._notifyWidgets())},adaptColumnWidthToContainer:function(){var e=this.gridster.cols*this.gridWidth,t=this.elm.width()-2*(this.gridster.cols-1)*this.gridMargin,i=t/e,o=Math.round(this.gridWidth*Math.min(i,1));this.currentGridWidth=o,this.gridster.resize_widget_dimensions({widget_base_dimensions:[o,this.gridHeight]});var n=this.elm.find(".gridster-block.ui-resizable");n.length&&(n.resizable("option","grid",[2*this.gridMargin,this.gridHeight+2*this.gridMargin]),n.resizable("option","minWidth",o))},_initGridster:function(){var e=i(this.elm);this.gridster=e.gridster({widget_margins:[this.gridMargin,this.gridMargin],widget_base_dimensions:[this.gridWidth,this.gridHeight],min_rows:this.minRows,min_cols:this.minCols,max_rows:this.maxRows,max_cols:this.maxCols,extra_rows:this.extraRows,draggable:{start:this.onWidgetDragStart,stop:this.onWidgetDragEnd,items:".draggable-widget"},autogenerate_stylesheet:!1,namespace:".gridster"}).data("gridster"),this.targetResizeHandler=function(e){e.stopPropagation()},e.on("resize",this.targetResizeHandler)},_notifyWidgets:function(){t.each(this.gridster.$changed,function(e){e=i(e),e.find("> .gridster-widget").trigger("widget:resizeMove",{x:parseInt(e.attr("data-col"),10),y:parseInt(e.attr("data-row"),10),rows:parseInt(e.attr("data-sizey"),10),cols:parseInt(e.attr("data-sizex"),10)})}),this.gridster.$changed=i([])},enableResizingOf:function(e,t){var o=this;e.resizable({grid:[2*this.gridMargin,this.gridHeight+2*this.gridMargin],animate:!1,minWidth:this.currentGridWidth,minHeight:t*this.rowHeight,containment:this.elm,autoHide:!0,handles:"all",start:function(e,t){o.trigger("dashboardView:widgetStartedResize")},stop:function(t,n){setTimeout(function(){var t=n.position.left!==n.originalPosition.left,s=n.size.width-n.originalSize.width;o.resizeWidget(e,t,s),i(e).removeAttr("style"),o.trigger("dashboardView:widgetFinishedResize")},300)}}),e.find(".ui-resizable-handle").hover(function(){o.gridster.disable()},function(){o.gridster.enable()})},onWidgetDragStart:function(){this.trigger("dashboardView:widgetStartedDrag")},onWidgetDragEnd:function(e,t){i(e.target).closest(".gridster-widget").trigger("widget:dropped"),this._notifyWidgets(),this.trigger("dashboardView:widgetFinishedDrag")},bringAllWidgetsToBottom:function(){this.elm.find("li.on-top").removeClass("on-top")},destroy:function(){n.unbind(void 0,void 0,this),i(this.elm).off("resize",this.targetResizeHandler),t.invoke(this.widgetViews,"dispose"),this.gridster.destroy(),delete this.gridster,this._super()}})}),define("jst!dashboard/_app_view_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="header">\n  <h5 class="header-title">\n    <span class="app-icon-16 icon-<%= widget.get(\'data\').app.config.icon_id %>"></span>\n    <%- link_to(widget.get(\'data\').app.link+"#0/views/"+widget.get(\'config\').view_id, widget.getTitle()) %>\n    <span class="total"><%= widget.get(\'data\').app_view.filtered %></span>\n  </h5>\n  <div class="actions">\n    <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n    <div class="action tooltip options icon-16 icon-16-eye" title="<%= translations.options %>"></div>\n  </div>\n</div>\n<% if(items.length == 0) { %>\n  <%- widget_blankslate_message(contentRows, translations.blankslate_message) %>\n<% } else { %>\n  <ul class="content">\n    <% _.each(items, function(item) { %>\n      <li>\n        <div class="inner">\n          <%- link_to(item.get("link"), item.get("title"), { \'class\': "permalink", \'title\': item.get("title"), \'data-id\': item.get(\'app_item_id\') }) %>\n          <% if (item.getFirstCategorizableFieldValue()) { %>\n            <div class="variable-right">\n              <div class="two-column-inline field-type-category-item color-<%= item.getFirstCategorizableFieldValue().color || "DCEBD8" %>">\n                <%= item.getFirstCategorizableFieldValue().text %>\n              </div>\n            </div>\n          <% } %>\n        </div>\n      </li>\n    <% }); %>\n  </ul>\n<% } %>\n<% if(canCreateItem) { %>\n  <div class="footer">\n    <div class="overflow"></div>\n    <a href="<%= app.link_add %>" class="add" data-link-type="no-reload" data-render-as="overlay">\n      + <%= translations.create_item.format(app.config.item_name) %>\n    </a>\n  </div>\n<% } else { %>\n  <div class="no-footer">\n    <div class="overflow"></div>\n  </div>\n<% } %>\n')}),define("jst!dashboard/_apps_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="header">\n  <h5 class="header-title"><%= widget.getTitle() %></h5>\n  <div class="actions">\n    <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n  </div>\n</div>\n<% if(widget.get(\'data\').apps.length == 0) { %>\n  <%- widget_blankslate_message(contentRows, translations.blankslate_message) %>\n<% } else { %>\n  <ul class="content">\n    <% _.each(widget.get(\'data\').apps, function(app) { %>\n      <li>\n        <div class="inner image-block">\n          <div class="img app-icon">\n            <span class="app-icon-16 sprite-icon icon-<%= app.config.icon_id %>"></span>\n          </div>\n          <div class="img-ext">\n            <% if (_.contains(app.rights, \'add_item\')) { %>\n              <a href="<%= app.link_add %>" class="add tooltip" title="<%= translations.createItemTooltip.format(app.config.item_name) %>" data-link-type="no-reload" data-render-as="overlay"><span class="icon-16 icon-16-grey-slim-plus"></span></a>\n            <% } %>\n          </div>\n          <div class="bd">\n            <%- link_to(app.link, app.config.name, { "class": "permalink" }) %>\n          </div>\n        </div>\n      </li>\n    <% }); %>\n  </ul>\n<% } %>\n<div class="no-footer"><div class="overflow"></div></div>\n')}),define("jst!dashboard/_calculation_breakdown_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="header">\n  <h5 class="header-title"><span class="app-icon-16 icon-<%= widget.get(\'data\').app.config.icon_id %>"></span><%- link_to(headerUrl, widget.getTitle()) %></h5>\n  <div class="actions">\n    <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n    <div class="action action-dropdown align-left widget-dropdown icon-16-darkgray-wrench-medium icon-16"></div>\n    <div class="action-dropdown-options hidden">\n      <ul>\n        <% if (canSaveTo) { %>\n          <% if (canSaveTo.app) { %>\n            <li>\n              <a class="copy" data-target="app" href="#">\n                <span class="icon-16 icon-16-send-to-dashboard"></span>\n                <%= t(\'Copy to app home #dashboard\') %>\n              </a>\n            </li>\n          <% } %>\n\n          <li>\n            <a class="copy" data-target="user" href="#">\n              <span class="icon-16 icon-16-send-to-dashboard"></span>\n              <%= t(\'Copy to home page #dashboard\') %>\n            </a>\n          </li>\n\n          <% if (canSaveTo.space) { %>\n          <li>\n            <a class="copy" data-target="space" href="#">\n              <span class="icon-16 icon-16-send-to-dashboard"></span>\n              <%= t(\'Copy to workspace home #dashboard\') %>\n            </a>\n          </li>\n          <% } %>\n\n          <% if (canSaveTo.emp_network) { %>\n          <li>\n            <a class="copy" data-target="emp_network" href="#">\n              <span class="icon-16 icon-16-send-to-dashboard"></span>\n              <%= t(\'Copy to employee network #dashboard\') %>\n            </a>\n          </li>\n          <% } %>\n        <% } %>\n\n        <li>\n          <a class="modify" href="<%= widget.get(\'config\').app_link + "#/widgets/{0}/edit".format(widget.get(\'id\') ? widget.get(\'id\') : widget.get(\'widget_id\')) %>">\n            <span class="icon-16 icon-16-edit"></span>\n            <%=translations.modify%>\n          </a>\n        </li>\n        <li>\n          <a class="print" href="#">\n            <span class="icon-16 icon-print-black"></span>\n            <%=t(\'Print #dashboard\')%>\n          </a>\n        </li>\n      </ul>\n    </div>\n  </div>\n</div>\n\n<ul class="content">\n  <li>\n    <div class="inner table-header table-result">\n      <% label = t(\'Overall #reporting-widget\') + " " + translations[widget.get(\'config\').calculation.aggregation] %>\n      <a href="<%= headerUrl %>" title="<%= label %>"><%= label %></a>\n      <div class="result variable-right">\n        <a href="<%= headerUrl %>" title="<%= label %>">\n          <%=format_calculation(widget.get(\'data\').total, calculationWidgetModel.getUnits())%>\n          <%=calculationWidgetModel.getUnits()%>\n        </a>\n      </div>\n    </div>\n  </li>\n\n  <% if (!isChart) { %>\n  <% var groups = isFasterDashboardFeatureEnabled ? widget.get(\'data\').groups : widget.get(\'formatted_groups\'); %>\n  <% _(groups).each(function(group) { %>\n\n    <%\n      var value = isFasterDashboardFeatureEnabled\n        ? calcHelpers.formatCalculationValue(widget.get(\'config\').calculation.grouping.sub_value, group.value)\n        : group.value;\n\n      // Removing the "Not Set" values from the reports\n      if (!value) { return; }\n    %>\n    <li>\n      <div class="inner table-result">\n        <%\n          var field  = widget.get(\'config\').calculation.grouping.value;\n\n          if (widget.get(\'config\').calculation.grouping.type === \'voting\') {\n            value = Number(group.label[0]);\n            field = \'voting_\' + field;\n          }\n\n          groupUrl = widget.get(\'config\').app_link + "#/widgets/{0}/filter/{1}/{2}".format(widget.get(\'id\'), field, encodeURIComponent(value));\n        %>\n        <% label = isDateGrouping ? calcHelpers.formatTimeLabel(group.label, widget.get(\'config\').calculation.grouping.sub_value) : group.label %>\n        <a href="<%= groupUrl %>" title="<%= label %>"><%= label %></a>\n        <div class="result variable-right">\n          <a href="<%= groupUrl %>" title="<%= label %>">\n            <%=format_calculation(group.count, calculationWidgetModel.getUnits())%>\n            <%=calculationWidgetModel.getUnits()%>\n          </a>\n        </div>\n      </div>\n    </li>\n  <% }) %>\n  <% } %>\n</ul>\n\n<% if (isChart) { %>\n  <div class="widget-chart-target"></div>\n<% } %>\n\n<div class="no-footer"><div class="overflow"></div></div>\n')}),define("jst!dashboard/_calculation_single_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<span class="header">\n  <h5 class="header-title"><span class="app-icon-16 icon-<%= widget.get(\'data\').app.config.icon_id %>"></span><%- link_to(headerUrl, widget.getTitle()) %></h5>\n  <div class="actions">\n    <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n    <div class="action action-dropdown align-left widget-dropdown icon-16-darkgray-wrench-medium icon-16"></div>\n    <div class="action-dropdown-options hidden">\n      <ul>\n        <% if (canSaveTo) { %>\n          <% if (canSaveTo.app) { %>\n            <li>\n              <a class="copy" data-target="app" href="#">\n                <span class="icon-16 icon-16-send-to-dashboard"></span>\n                <%= t(\'Copy to app home #dashboard\') %>\n              </a>\n            </li>\n          <% } %>\n\n          <li>\n            <a class="copy" data-target="user" href="#">\n              <span class="icon-16 icon-16-send-to-dashboard"></span>\n              <%= t(\'Copy to home page #dashboard\') %>\n            </a>\n          </li>\n\n          <% if (canSaveTo.space) { %>\n          <li>\n            <a class="copy" data-target="space" href="#">\n              <span class="icon-16 icon-16-send-to-dashboard"></span>\n              <%= t(\'Copy to workspace home #dashboard\') %>\n            </a>\n          </li>\n          <% } %>\n\n          <% if (canSaveTo.emp_network) { %>\n          <li>\n            <a class="copy" data-target="emp_network" href="#">\n              <span class="icon-16 icon-16-send-to-dashboard"></span>\n              <%= t(\'Copy to employee network #dashboard\') %>\n            </a>\n          </li>\n          <% } %>\n        <% } %>\n\n        <li>\n          <a class="modify" href="<%= widget.get(\'config\').app_link + "#/widgets/{0}/edit".format(widget.get(\'id\') ? widget.get(\'id\') : widget.get(\'widget_id\')) %>">\n            <span class="icon-16 icon-16-edit"></span>\n            <%=translations.modify%>\n          </a>\n        </li>\n      </ul>\n    </div>\n  </div>\n</span>\n\n<div class="table-single-result content">\n  <div class="inner">\n    <a href="<%= headerUrl %>"><span class="result"><%=format_calculation(widget.get(\'data\').total, calculationWidgetModel.getUnits())%></span> <span class="unit"><%=calculationWidgetModel.getUnits()%></span></a>\n  </div>\n</div>\n\n<div class="no-footer"><div class="overflow"></div></div>\n')}),define("jst!dashboard/_events_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template("<div class=\"header\">\n  <h5 class=\"header-title\"><%- link_to(routes.isOnSpaceLevel ? routes.spaces_calendar_with_current_space_path({format:'html'}) : routes.calendar_events_path({format:'html'}), widget.getTitle()) %></h5>\n  <div class=\"actions\">\n    <div class=\"action tooltip remove icon-16 icon-16-grey-slim-x\" title=\"<%= translations.remove %>\"></div>\n  </div>\n</div>\n<% if(isFasterDashboardFeatureEnabled ? !widget.get('data').events || widget.get('data').events.length === 0 : widget.get('events').length === 0) { %>\n  <%- widget_blankslate_message(contentRows, translations.blankslate_message) %>\n<% } else { %>\n  <ul class=\"content\">\n    <% _.each(isFasterDashboardFeatureEnabled ? widget.get('data').events : widget.get('events'), function(event) { %>\n\n      <%\n        var today = isFasterDashboardFeatureEnabled ? widget.eventHelper.isToday(event) : event['today?'];\n        var isAllDay = isFasterDashboardFeatureEnabled ? widget.eventHelper.isAllDay(event) : event['all_day?'];\n      %>\n\n      <li class=\"<%= today ? 'highlight-green' : '' %>\">\n        <div class=\"image-block inner\">\n          <div class=\"img\">\n            <div class=\"date fixed one-column-inline-block<%= today ? ' today' : '' %>\">\n              <% if (today && isAllDay) { %>\n                <div class=\"datestamp\"><%= t('Today #dashboard') %></div>\n              <% } else { %>\n                <div class=\"datestamp\"><%- cascadingTimestamp(event.start_utc, { same_day: null, same_week: 'ddd', same_year: 'MMM D', later: 'MMM D' }) %></div>\n              <% } %>\n            </div>\n\n            <div class=\"date fixed two-column-inline-block<%= today ? ' today' : '' %>\">\n              <% if (today) { %>\n                <div class=\"datestamp\"><%= t('Today #dashboard') %></div>\n              <% } else { %>\n                <div class=\"datestamp\"><%- cascadingTimestamp(event.start_utc, { same_day: null, same_week: 'ddd', same_year: 'MMM D', later: 'MMM D' }) %></div>\n              <% } %>\n\n              <% if (isAllDay) { %>\n                <span class=\"time empty\">--:--</span>\n              <% } else { %>\n                <span class=\"time\"><%=formatTime(event.start_utc)%></span>\n              <% } %>\n            </div>\n          </div>\n          <div class=\"bd\">\n            <% if (event.ref_type == 'item') { %>\n              <%- dynamic_link_to(event.link, event.title) %>\n            <% } else { %>\n              <%- link_to(event.link, event.title) %>\n            <% } %>\n          </div>\n        </div>\n      </li>\n    <% }); %>\n  </ul>\n<% } %>\n<div class=\"no-footer\"><div class=\"overflow\"></div></div>\n");
}),define("jst!dashboard/_profiles_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="header">\n  <h5 class="header-title"><%- link_to(routes.contacts_path({format:\'html\'}), widget.getTitle()) %> <span class="total"><%= widget.get(\'data\').total %></span></h5>\n  <div class="actions">\n    <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n  </div>\n</div>\n<div class="images content">\n  <div class="inner">\n    <% _.each(isFasterDashboardFeatureEnabled ? widget.get(\'data\').profiles : widget.get(\'profiles\'), function(profile) { %>\n\n      <% var presenceStateInfo = getPresenceState(profile.last_seen_on); %>\n\n      <div class="avatar">\n        <a\n          href="<%= profile.link %>"\n          class="tooltip tooltip-html"\n          data-tooltip-template="presence"\n          data-tooltip-template-data=\'{"contactName": "<%= profile.name %>", "stateStatus": "<%= presenceStateInfo.status %>", "stateStatusText": "<%= presenceStateInfo.status_text %>"}\'\n          data-id="<%= profile.user_id %>">\n          <%- thumb_for_profile(profile, "medium") %>\n          <div class="indicator <%= presenceStateInfo.status %>"></div>\n        </a>\n        <div class="actions">\n          <ul>\n            <li class="icon-profile"><a href="<%= profile.link %>"><%= t(\'View profile #dashboard\') %></a></li>\n            <% if (profile.user_id !== podioConfig.user.user_id) { %>\n              <li class="icon-16-conversation"><a href="#" class="show-send-message-modal" data-send-message-user-id="<%= profile.user_id %>"><%= t(\'Send message #dashboard\') %></a></li>\n            <% } %>\n            <li class="icon-checkmark-done"><a href="#" class="task-context-create" data-responsible="<%= profile.user_id %>"><%= t(\'Create task #dashboard\') %></a></li>\n            <li class="icon-vcard"><a href="<%= routes.contact_path(profile.profile_id, {format: \'vcf\'}) %>"><%= t(\'Download vCard #dashboard\') %></a></li>\n          </ul>\n        </div>\n      </div>\n    <% }); %>\n  </div>\n</div>\n<div class="footer">\n  <div class="overflow"></div>\n  <a href="#invite" class="invite-contact">+ <%= t(\'Invite contact #dashboard\') %></a>\n</div>\n')}),define("jst!dashboard/_tasks_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="header">\n  <h5 class="header-title"><%- link_to(routes.isOnSpaceLevel ? routes.spaces_tasks_with_current_space_path(linkParameters) : routes.tasks_path(linkParameters), widget.getTitle()) %> <span class="total"><%= widget.get(\'data\').total %></span></h5>\n  <div class="actions">\n    <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n    <% if(showOptions) { %>\n      <div class="action tooltip options icon-16 icon-16-eye" title="<%= translations.options %>"></div>\n    <% } %>\n  </div>\n</div>\n<% if(tasks.length == 0) { %>\n  <%- widget_blankslate_message(contentRows, translations.blankslate_message) %>\n<% } else { %>\n  <ul class="content">\n    <% _.each(tasks, function(task) { %>\n      <li data-id="<%= task.get(\'task_id\') %>" class="<%= task.isOverdue() ? \'highlight-red\' : (task.isDueToday() ? \'highlight-green\' : \'\') %> <%= task.isCompleted() ? \'completed\' : \'\' %>">\n        <div class="inner image-block">\n          <div class="img space-right">\n            <div class="tickbox <%= task.isCompleted() ? \'tickbox-checked\' : \'\' %>"><div class="image"></div></div>\n            <div class="date two-column-inline-block">\n              <% if (task.hasDueDate()) { %>\n                <%-absoluteTimestamp(task.get(\'due_on\'), {includeTooltip: false}) %>\n                <% if (!task.hasDueTime()) { %>\n                  <span class="time empty">--:--</span>\n                <% } else { %>\n                  <span class="time"><%=formatTime(task.get(\'due_on\'))%></span>\n                <% } %>\n              <% } else { %>\n                <%= t(\'No due date #task-permalink\') %>\n              <% } %>\n            </div>\n          </div>\n          <% if (showResponsible && task.get(\'responsible\')) { %>\n            <div class="img-ext avatar two-column-inline-block tooltip" title="<%= task.get(\'responsible\').get(\'name\') %>">\n              <a href="<%= task.get(\'responsible\').get(\'link\') %>"><%- thumb_for_profile(task.get(\'responsible\'), \'small\') %></a>\n            </div>\n          <% } %>\n          <div class="bd">\n            <%- link_to(task.get(\'link\'), task.get(\'text\'), {"class": "task-title"}) %>\n\n            <% if (showRef && task.get(\'ref\')) { %>\n              <a href="<%= task.get(\'ref\').get(\'link\') %>" class="two-column-inline widget-reference"><%- referenceIconFor(task) %><%= task.get(\'ref\').get(\'title\') %></a>\n            <% } %>\n\n          </div>\n        </div>\n      </li>\n    <% }); %>\n  </ul>\n<% } %>\n<div class="footer">\n  <div class="overflow"></div>\n  <a href="#" class="create-task">+ <%= translations.create_task %></a>\n</div>\n')}),define("jst!dashboard/_addWidget_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="add-widget-wrapper">\n  <div class="centered">\n    <span class="icon-16 icon-16-grey-slim-plus"></span>\n    <%= t(\'Add a tile #dashboard\') %>\n  </div>\n</div>')}),define("jst!dashboard/_blank_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="header">\n  <h5 class="header-title"><%=t(\'New Title #dashboard\')%></h5>\n  <div class="actions">\n    <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n  </div>\n</div>\n<div class="content">\n  <p><%=t(\'Choose the type of tile, you would like to build #dashboard\')%></p>\n  <img src="<%= image_url(\'tile-setup-arrow.png\') %>" alt="" />\n</div>\n<div class="no-footer"><div class="overflow"></div></div>')}),define("jst!dashboard/_image_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="view-mode">\n  <div class="header">\n    <h5 class="header-title"><%= widget.getTitle() %></h5>\n    <div class="actions">\n      <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n      <a class="action tooltip modify icon-16 icon-16-edit" title="<%= translations.modify %>"></a>\n    </div>\n  </div>\n  <div class="image-container">\n  </div>\n  <div class="image-missing widget-centering-container sizey" data-sizey="<%= contentRows %>">\n    <div class="widget-centering">\n      <img src="<%= image_url(\'widget/missing-image.png\') %>" />\n    </div>\n  </div>\n  <div class="no-footer"><div class="overflow"></div></div>\n</div>\n')}),define("jst!dashboard/_image_widget_edit",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="edit-mode">\n  <div class="header">\n    <input type="text" maxlength="120" class="widget-title title" value="<%=widget.get(\'title\')%>" placeholder="<%= translations.titlePlaceholder %>" />\n    <div class="actions">\n      <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n      <div class="action tooltip change-link icon-16 icon-16-globe" title="<%= translations.change_link %>"></div>\n    </div>\n  </div>\n  <% if (widget.get("data").image) { %>\n    <div class="image-container">\n      <div class="image-actions">\n        <div class="action tooltip remove-image icon-16 icon-x-black2" title="<%= translations.remove_image %>"></div>\n      </div>\n    </div>\n  <% } else { %>\n    <div class="widget-centering-container sizey" data-sizey="<%= contentRows %>">\n      <div class="widget-centering">\n        <input type="button" value="<%= translations.pick_image_button_text %>" class="pick-image flatbutton blue">\n      </div>\n    </div>\n  <% } %>\n  <div class="no-footer"><div class="overflow"></div></div>\n</div>\n')}),define("jst!dashboard/_files_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="header">\n  <h5 class="header-title">\n    <%- link_to(routes.space_files_with_current_space_path({format: ""}), widget.getTitle()) %>\n    <span class="total"><%= widget.get(\'data\').total %></span>\n  </h5>\n  <div class="actions">\n    <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n  </div>\n</div>\n<% if(widget.get(\'data\').files.length == 0) { %>\n  <%- widget_blankslate_message(contentRows, translations.blankslate_message) %>\n<% } else { %>\n  <ul class="content">\n    <% _.each(widget.get(\'data\').files, function(file) { %>\n      <li>\n        <div class="inner image-block">\n          <div class="img">\n            <span class="file-icon icon-32 <%= icon_for_mimetype(file.mimetype, \'large\') %>"></span>\n          </div>\n          <div class="bd">\n            <%- link_to(file.link, file.name, {\'target\': file.link_target}) %>\n            <a href="<%=file.context.link%>" class="two-column-inline context">\n              <span class="<%=referenceIconClassFor(file.context)%>"></span>\n              <%=file.context.title%>\n            </a>\n          </div>\n        </div>\n      </li>\n    <% }); %>\n  </ul>\n<% } %>\n<div class="no-footer"><div class="overflow"></div></div>\n')}),define("jst!dashboard/_text_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="view-mode">\n  <div class="header">\n    <h5 class="header-title"><%= widget.getTitle() %></h5>\n    <div class="actions">\n      <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n      <a class="action tooltip modify icon-16 icon-16-edit" title="<%= translations.modify %>"></a>\n    </div>\n  </div>\n  <div class="content markdown">\n    <%-widget.getFormattedText()%>\n  </div>\n  <div class="no-footer"><div class="overflow"></div></div>\n</div>\n')}),define("jst!dashboard/_text_widget_edit",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="edit-mode">\n  <div class="header">\n    <input type="text" maxlength="120" class="title" value="<%=widget.get(\'title\')%>" placeholder="<%= translations.titlePlaceholder %>" />\n    <div class="actions">\n      <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n    </div>\n  </div>\n  <div class="content sizey" data-sizey="<%=contentRows%>">\n    <textarea><%=widget.get(\'config\').text%></textarea>\n  </div>\n  <div class="no-footer"><div class="overflow"></div></div>\n</div>')}),define("jst!dashboard/_link_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="view-mode">\n  <div class="header">\n    <h5 class="header-title"><%= widget.getTitle() %></h5>\n    <div class="actions">\n      <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n      <a class="action tooltip modify icon-16 icon-16-edit" title="<%= translations.modify %>"></a>\n    </div>\n  </div>\n  <% if (widget.get(\'data\').length === 0) { %>\n    <%- widget_blankslate_message(contentRows, translations.blankslate_message) %>\n  <% } else { %>\n    <ul class="content">\n      <% _.each(widget.get(\'data\'), function(link) { %>\n        <li>\n          <div class="inner">\n            <div class="image-block">\n            	<div class="bd">\n                <%- link_to(link.url, link.title || link.url, { \'title\': link.title, \'target\': \'_blank\', \'rel\': \'noreferrer\' }) %>\n            	</div>\n              <div class="img-ext">\n                <a href="#" class="remove-link tooltip" title="<%=translations.removeLink%>">&#x00D7;</a>\n              </div>\n            </div>\n          </div>\n        </li>\n      <% }); %>\n    </ul>\n  <% } %>\n  <div class="no-footer"><div class="overflow"></div></div>\n</div>\n')}),define("jst!dashboard/_link_widget_edit",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="edit-mode">\n  <div class="header">\n    <input type="text" maxlength="120" class="title" value="<%=widget.get(\'title\')%>" placeholder="<%= translations.titlePlaceholder %>" />\n    <div class="actions">\n      <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n    </div>\n  </div>\n  <% if (widget.get(\'data\').length === 0) { %>\n    <%- widget_blankslate_message(contentRows, translations.blankslate_message) %>\n  <% } else { %>\n    <ul class="content">\n      <% _.each(widget.get(\'data\'), function(link) { %>\n      <li>\n        <div class="inner">\n          <%- link_to(link.url, link.title || link.url, { \'title\': link.title, \'target\': \'_blank\', \'rel\': \'noreferrer\' }) %>\n        </div>\n      </li>\n      <% }); %>\n    </ul>\n  <% } %>\n  <div class="no-footer"><div class="overflow"></div></div>\n</div>')}),define("jst!dashboard/_contacts_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="header">\n  <h5 class="header-title">\n    <%- link_to(routes.spaces_contacts_with_current_space_path({format: ""}), widget.getTitle()) %>\n    <span class="total"><%= widget.get(\'data\').total %></span>\n  </h5>\n  <div class="actions">\n    <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n  </div>\n</div>\n<% if(widget.get(\'data\').contacts.length == 0) { %>\n  <%- widget_blankslate_message(contentRows, translations.blankslate_message) %>\n<% } else { %>\n  <ul class="content">\n    <% _.each(widget.get(\'data\').contacts, function(contact) { %>\n      <li>\n        <div class="inner image-block">\n          <div class="img">\n            <a href="<%= contact.link %>">\n              <%- thumb_for_profile(contact, "small") %>\n            </a>\n          </div>\n          <div class="bd">\n            <%- link_to(contact.link, contact.name, { "class": "permalink" }) %>\n            <% if(contact.mail && contact.mail.length > 0) { %>\n              <%- link_to("mailto:"+contact.mail[0], contact.mail[0], { "class": "two-column-inline widget-reference email" }) %>\n            <% } %>\n          </div>\n        </div>\n      </li>\n    <% }); %>\n  </ul>\n<% } %>\n<div class="no-footer"><div class="overflow"></div></div>\n')}),define("jst!dashboard/_recent_items_widget",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template("<div class=\"header\">\n  <h5 class=\"header-title\"><%= translations.title %></h5>\n  <div class=\"actions\">\n    <div class=\"action tooltip remove icon-16 icon-16-grey-slim-x\" title=\"<%= translations.remove %>\"></div>\n  </div>\n</div>\n<% if (items.length === 0) { %>\n  <div class=\"recent-items-blank\">\n    <div class=\"placeholder\">\n      <img src=\"<%= image_url('widget/recent_items_documents.png') %>\" />\n      <p><%= translations.no_activity %></p>\n    </div>\n\n    <% if (isDfdResolved) { %>\n      <div class=\"action\">\n        <% if (_.isDefined(topApp)) { %>\n          <%- dynamic_link_to(topApp.get('link_add'), translations.create_new_item.format(topApp.get('config').item_name), { 'class': 'button-new blue event-tracking', 'data-event-tracking-action': 'item.new'  }) %>\n        <% } else { %>\n          <a href=\"https://help.podio.com/hc/en-us/articles/201020278-The-Structure-of-Podio\" target=\"_blank\" class=\"help-center\"><%= translations.what_is_an_item %></a>\n        <% } %>\n      </div>\n      <% }Â %>\n  </div>\n<% } else { %>\n<ul class=\"content\">\n  <% _.each(items, function(item) { %>\n  <li>\n    <div class=\"inner\">\n      <div class=\"image-block\">\n        <div class=\"img app-icon\">\n          <%- link_to(item.app.url, '<span class=\"app-icon-16 sprite-icon icon-{0}\"></span>'.format(item.app.config.icon_id), { 'class': 'event-tracking', 'data-event-tracking-action': 'app', 'raw': 'true' }) %>\n        </div>\n        <div class=\"bd\">\n          <%- dynamic_link_to(item.link, item.title || item.link, { 'class': 'event-tracking', 'data-event-tracking-action': 'item'  }) %>\n        </div>\n        <div class=\"img-ext recent-items-space\">\n          <% if (_.isDefined(item.space)) { %>\n            <%- link_to(item.space.url, item.space.name, { 'class': 'event-tracking', 'data-event-tracking-action': 'space'  }) %>\n          <% } %>\n        </div>\n      </div>\n    </div>\n  </li>\n  <% }); %>\n</ul>\n<% } %>\n<div class=\"no-footer\"><div class=\"overflow\"></div></div>\n")}),define("views/dashboard/Podio.Views.Dashboard.Widget",["require","translate","underscore","lib/backbone/Backbone.PodioView","lib/Podio.UI.Modal","lib/Podio.Tracking","lib/Podio.UI.Tooltips","lib/Podio.Utils","jst!dashboard/_app_view_widget","jst!dashboard/_apps_widget","jst!dashboard/_calculation_breakdown_widget","jst!dashboard/_calculation_single_widget","jst!dashboard/_events_widget","jst!dashboard/_profiles_widget","jst!dashboard/_tasks_widget","jst!dashboard/_addWidget_widget","jst!dashboard/_blank_widget","jst!dashboard/_image_widget","jst!dashboard/_image_widget_edit","jst!dashboard/_files_widget","jst!dashboard/_text_widget","jst!dashboard/_text_widget_edit","jst!dashboard/_link_widget","jst!dashboard/_link_widget_edit","jst!dashboard/_contacts_widget","jst!dashboard/_recent_items_widget"],function(e){var t=e("translate"),i=e("underscore"),o=e("lib/backbone/Backbone.PodioView"),n=(e("lib/Podio.UI.Modal"),e("lib/Podio.Tracking"),e("lib/Podio.UI.Tooltips")),s=(e("lib/Podio.Utils"),{app_view_widget:e("jst!dashboard/_app_view_widget"),apps_widget:e("jst!dashboard/_apps_widget"),calculation_breakdown_widget:e("jst!dashboard/_calculation_breakdown_widget"),calculation_single_widget:e("jst!dashboard/_calculation_single_widget"),events_widget:e("jst!dashboard/_events_widget"),profiles_widget:e("jst!dashboard/_profiles_widget"),tasks_widget:e("jst!dashboard/_tasks_widget"),addWidget_widget:e("jst!dashboard/_addWidget_widget"),blank_widget:e("jst!dashboard/_blank_widget"),image_widget:e("jst!dashboard/_image_widget"),image_widget_edit:e("jst!dashboard/_image_widget_edit"),files_widget:e("jst!dashboard/_files_widget"),text_widget:e("jst!dashboard/_text_widget"),text_widget_edit:e("jst!dashboard/_text_widget_edit"),link_widget:e("jst!dashboard/_link_widget"),link_widget_edit:e("jst!dashboard/_link_widget_edit"),contacts_widget:e("jst!dashboard/_contacts_widget"),recent_items_widget:e("jst!dashboard/_recent_items_widget")});return o.extend({className:"gridster-widget",rowsPerItem:1,podioEvents:function(){return{"widget:resizeMove":"onResizedMoved","click .actions .remove":"onRemoveClicked",mouseleave:"onMouseLeave",mouseenter:"onMouseEnter"}},initialize:function(e){this._super(),this.translations={modify:t("Modify widget #dashboard"),remove:t("Remove widget #dashboard"),options:t("Change widget options #dashboard")},this.elm.addClass(this.model.get("type")),this.listenTo(this.model,"change",this.render)},renderOptions:function(){return{widget:this.model,translations:this.translations,contentRows:this.contentRows(),isFasterDashboardFeatureEnabled:!0}},render:function(){var e=this;return this.elm.html(this.getTemplate(s[this.templateName()],this.renderOptions())),e._hideUnauthorizedActions(),i.defer(function(){e._handleOverflow(),e._handleDisplayOptions({cols:e.model.get("cols")})}),this.elm},place:function(){this.gridsterWidget.append(this.elm).addClass("fadeIn")},templateName:function(){return this.model.get("type")+"_widget"},x:function(){return this.model.get("x")||1},y:function(){return this.model.get("y")||1},rows:function(){return this.model.get("rows")<this.minRows()?this.defaultRows():this.model.get("rows")},cols:function(){return this.model.getCols()},minRows:function(){return this.headerFooterRows()+1},defaultRows:function(){return this.headerFooterRows()+4},contentRows:function(){return this.rows()-this.headerFooterRows()},headerFooterRows:function(){return 2},dataCount:function(){var e=this.model.get("data");return e&&e.total},onResizedMoved:function(e,t,i){this._handleOverflow(),this._handleDisplayOptions(i),this.eventBus.trigger("resizeMove",i)},onMouseEnter:function(){this.elm.toggleClass("hovering",!0)},onMouseLeave:function(){this.elm.toggleClass("hovering",!1)},onRemoveClicked:function(e,t){n.hideAll(),this.eventBus.trigger("delete")},_hideUnauthorizedActions:function(){this.model.can("update")||this.elm.find(".actions .options, .actions .modify").hide(),this.model.can("delete")||this.elm.find(".actions .remove").hide()},_handleDisplayOptions:function(e){this.elm.toggleClass("two-column",2===e.cols)},showOverflow:function(){if(this.dataCount())return this.contentRows()<this.dataCount();var e=this.elm.find(".header").outerHeight()+this.elm.find(".footer").outerHeight()+this.elm.find(".no-footer").outerHeight(),t=this.elm.closest(".gridster-block").height()-e,i=this.elm.find(".content").height();return i>t},_handleOverflow:function(){this.elm.toggleClass("overflowing",this.showOverflow())},itemsForRowsCols:function(e,t){return Math.floor((e-this.headerFooterRows())/this.rowsPerItem)},bringToTop:function(){this.elm.parent().addClass("on-top")},draggable:function(){return this.model.can("move")},resizable:function(){return this.model.can("update")}})}),define("views/dashboard/Podio.Views.Dashboard.BlankWidget",["require","views/dashboard/Podio.Views.Dashboard.Widget"],function(e){var t=e("views/dashboard/Podio.Views.Dashboard.Widget");return t.extend({initialize:function(){this._super(),this.render()},templateName:function(){return"blank_widget"},onRemoveClicked:function(e,t){this.trigger("blankWidget:delete")}})}),define("routers/Podio.Routers.Dashboard",["require","underscore","lib/backbone/Backbone.PodioRouter"],function(e){var t=e("underscore"),i=e("lib/backbone/Backbone.PodioRouter");return i.extend({routes:{"widgets/{widgetId}":{action:"onWidgetRouteInvoked"},"change-avatar":{action:"onChangeAvatarRouteInvoked"}},initialize:function(e){this.eventBus=e.eventBus},onWidgetRouteInvoked:function(e,i){return t.isUndefined(i)?!1:void this.eventBus.trigger("dashboardRouter:widgetRouteInvoked",parseInt(i,10))},onChangeAvatarRouteInvoked:function(e){this.navigate(""),this.eventBus.trigger("dashboardRouter:changeAvatarRouteInvoked")}})}),define("models/Podio.Models.Integration",["require","lib/backbone/Backbone.PodioModel","translate"],function(e){var t=e("lib/backbone/Backbone.PodioModel"),i=e("translate");return t.extend({active:function(){return"active"===this.get("status")},inactive:function(){return"inactive"===this.get("status")},error:function(){return"error"===this.get("status")},display_name:function(){switch(this.get("type")){case"zendisk":return i("Zendesk");case"zendesk":return i("Zendesk");case"freshbooks":return i("FreshBooks");case"campaign_monitor":return i("Campaign Monitor");case"rss":return i("RSS");case"evernote":return i("Evernote");default:return""}}})}),define("models/Podio.Models.Field",["require","underscore","translate","lib/backbone/Backbone.PodioModel"],function(e){var t=e("underscore"),i=e("translate"),o=e("lib/backbone/Backbone.PodioModel");return o.extend({idAttribute:"field_id",validation:{"config.label":{required:!0}},labels:{"config.label":i("Field label #apps_items_v2")},initialize:function(){this.startTracking(),this._super()},isTypeOf:function(e){return this.get("type")===e},value:function(){return this.get("values")[0].value},values:function(){return this.get("values")},type:function(){return this.get("type")},isLargeTextField:function(){return"text"===this.get("type")&&"large"===this.get("config").settings.size},setTextFieldSize:function(e){return"text"!==this.type()?!1:void this.set({config:{settings:{size:e,format:null}}},{deep:!0})},setEmailFieldCcBcc:function(e){e=e||e,this.set({config:{settings:{include_in_cc:e.include_in_cc,include_in_bcc:e.include_in_bcc}}},{deep:!0})},setTextFieldFormat:function(e){if("text"!==this.type())return!1;if(!t.contains(["plain","html"],e))return!1;var i=t.clone(this.get("config")),o=t.extend(i,{settings:{format:e}});this.set({config:o},{deep:!0})},decimalCount:function(){return"number"===this.get("type")||"calculation"===this.get("type")?this.get("config").settings.decimals:null},setDecimalCount:function(e,i){return"number"!==this.type()&&"calculation"!==this.type()?!1:(i=t.extend({deep:!0},i),void this.set({config:{settings:{decimals:e}}},i))},defaultDecimalCount:function(e,i){t.isNumber(this.get("config").settings.decimals)||this.setDecimalCount(e,i)},setDateFieldProperty:function(e,t){if("date"!==this.type())return!1;var i={config:{settings:{}}};i.config.settings[e]=t,this.set(i,{deep:!0})},setDurationFieldProperty:function(e,t){return"duration"!==this.type()?!1:void this.set({config:{settings:{fields:t}}},{deep:!0})},setCalculationFieldProperty:function(e,t){if("calculation"!==this.type())return!1;var i={config:{settings:{}}};i.config.settings[e]=t,this.set(i,{deep:!0})},removeCalculationExpression:function(){return"calculation"!==this.type()?!1:void delete this.get("config").settings.expression},setMoneyFieldCurrency:function(e){return"money"!==this.type()?!1:void this.set({config:{settings:{allowed_currencies:e}}},{deep:!0})},setContactFieldSetting:function(e){return"contact"!==this.type()?!1:void this.set({config:{settings:{type:e}}},{deep:!0})},setLocationFieldProperty:function(e,t){if("location"!==this.type())return!1;var i={config:{settings:{}}};i.config.settings[e]=t,this.set(i,{deep:!0})},setHelpText:function(e){this.set({config:{description:e}},{deep:!0})},humanized_value:function(){return this.get("humanized_value")},isSortable:function(){var e=["state","text","location","money","number","tel","calculation","progress","duration","member","app","date","contact","question","category","tag"];return t.include(e,this.get("type"))},isFilterable:function(){var e=["state","money","number","calculation","progress","duration","member","app","date","contact","question","category","tag","location"];return"calculation"===this.get("type")&&"text"===this.get("config").settings.return_type?!1:t.include(e,this.get("type"))},isFlowable:function(){var e=["number","progress","app","contact","text","state","category"];return t.include(e,this.get("type"))},isActive:function(){return"active"===this.get("status")},isDeleted:function(){return"deleted"===this.get("status")},markAsDeleted:function(){this.set("status","deleted")},isRequired:function(){return this.get("config").required},isMultiselectCategory:function(){return"category"===this.get("type")&&this.get("config").settings.multiple},isMultiselectAppReference:function(){return"app"===this.get("type")?"undefined"==typeof this.get("config").settings.multiple?!0:this.get("config").settings.multiple:void 0},isMeetingParticipantContact:function(){return"meeting_participants"===this.get("config").mapping},setMultiselectSetting:function(e){this.set({config:{settings:{multiple:e}}},{deep:!0}),"category"===this.type()&&e===!0&&"dropdown"===this.getCategoryLayout()&&this.setCategoryLayout("inline")},getCategoryLayout:function(){return this.get("config").settings.display||"inline"},setCategoryLayout:function(e){this.set({config:{settings:{display:e}}},{deep:!0})},hasActiveCategoryOptions:function(){return this.getActiveCategoryOptions().length},getActiveCategoryOptions:function(){return t.filter(this.get("config").settings.options,function(e){return"deleted"!==e.status})},getActiveCategoryOptionsWithIndex:function(){var e=t.clone(this.get("config").settings.options);return t.filter(e,function(e,t){return e.index=t,"deleted"!==e.status})},getDeletedCategoryOptions:function(){return t.filter(this.get("config").settings.options,function(e){return"deleted"===e.status})},getCategoryFieldOptionsHash:function(e){var i;return i=e?this.getActiveCategoryOptions():this.get("config").settings.options,t.indexBy(i,"id")},getCategoryFieldOptions:function(){var e=this.getActiveCategoryOptions();return t.map(e,function(e){return{id:e.id,text:e.text}})},getStateFieldOptions:function(){var e=this.get("config").settings.allowed_values;return t.map(e,function(e){return{id:e,text:e}})},getCategorizableFieldOptions:function(){return t.include(["category","question"],this.get("type"))?this.getCategoryFieldOptions():"state"===this.get("type")?this.getStateFieldOptions():[]},isCategorizableField:function(){return t.include(["category","question","state"],this.get("type"))},setRequired:function(e){var t={required:e};e&&(t.hidden=!1),this.set({config:t},{deep:!0})},setHidden:function(e){var t={hidden:e};e&&(t.required=!1),this.set({config:t},{deep:!0})},addCategoryOption:function(e){var t=this.get("config").settings.options||[];return t.push({text:e}),this.set({config:{settings:{options:t}}},{deep:!0}),t.length-1},updateCategoryOption:function(e,t){var i=this.get("config").settings.options;i[e].text=t},sortCategoryOptions:function(e){var i=this.get("config").settings.options,o=t.map(e,function(e){return i[e]});o=o.concat(this.getDeletedCategoryOptions()),this.set({config:{settings:{options:o}}},{deep:!0})},deleteCategoryOption:function(e){var t=this.get("config").settings.options,i=t[e];i.status="deleted"},getColorByIndex:function(e){var t=this.get("config").settings.options,i=t[e];return i.color},setColorByIndex:function(e,t){var i=this.get("config").settings.options,o=i[e];o.color=t},getAppReferenceApps:function(){return this.get("config").settings.apps},getAllowedAppReferenceApps:function(){return this.get("config").settings.apps.filter(function(e){return-1!==e.rights.indexOf("add_item")})},cleanUncreatedCategoryOptions:function(){var e=this.get("config").settings.options;this.get("config").settings.options=t.reject(e,function(e){return t.isUndefined(e.id)&&"deleted"===e.status})},isSaved:function(){return this.has("field_id")}})}),define("collections/Podio.Collections.Fields",["require","underscore","lib/backbone/Backbone.PodioCollection","models/Podio.Models.Field"],function(e){var t=e("underscore"),i=e("lib/backbone/Backbone.PodioCollection");return i.extend({url:"/field",configure:function(){this.model=e("models/Podio.Models.Field")},find_all:function(e){return this.filter(function(i){return t.isArray(e)?t.include(e,i.get("type")):i.get("type")===e})},find_all_active:function(e){return this.filter(function(i){return t.isArray(e)?t.include(e,i.get("type"))&&i.isActive():i.get("type")===e&&i.isActive()})},find_first:function(e){return this.find(function(t){return t.get("type")===e})},find_by_id:function(e){return this.find(function(t){return t.get("field_id")===e})},getByExternalId:function(e){return this.find(function(t){return t.get("external_id")===e})},getCalculationFieldsByReturnType:function(e){return t.filter(this.find_all("calculation"),function(t){return t.get("config").settings.return_type===e})},getSortableFields:function(){return this.filter(function(e){return e.isSortable()})},getFilterableFields:function(){return this.filter(function(e){return e.isFilterable()})},getCalculatableFields:function(){return this.filter(function(e){return"calculation"===e.get("type")&&"number"===e.get("config").settings.return_type?!0:t(["number","money","progress","duration"]).include(e.get("type"))})},getActiveFields:function(){return this.filter(function(e){return e.isActive()})},getFlowableFields:function(){return this.filter(function(e){return e.isFlowable()&&e.isActive()})},getCardLayoutFields:function(){
var e=["category","question","state","contact","app"];return this.find_all(e)},applyDeltasByExternalIds:function(e){t.each(e,function(e,t){this.where({external_id:e})[0].set({config:{delta:t}},{deep:!0})},this)},addField:function(e,i,o){var n,s={};return"text"===e&&(s.size="large"),n={status:"active",type:e,label:i,external_id:t.uniqueId("field"),config:{settings:s,required:!1,delta:o,label:i}},this.add(n)}})}),define("models/Podio.Models.Application",["require","underscore","jquery","translate","lib/backbone/Backbone.PodioModel","lib/Podio.Routes","lib/Podio.Config","lib/Podio.Utils","models/Podio.Models.Integration","models/Podio.Models.Space","collections/Podio.Collections.Fields"],function(e){var t=e("underscore"),i=e("jquery"),o=e("translate"),n=e("lib/backbone/Backbone.PodioModel"),s=e("lib/Podio.Routes"),a=e("lib/Podio.Config");e("lib/Podio.Utils");return n.extend({idAttribute:"app_id",CREATE_APP_URL:"/app",validation:{"config.name":{required:!0},"config.item_name":{required:!0}},labels:{"config.name":o("App Name #apps_items_v2"),"config.item_name":o("Item Name #apps_items_v2")},urlAPI:function(){var e,t;return this.get("app_id")?this.useV2API?"/app/{0}/v2".format(this.get("app_id")):"/app/{0}".format(this.get("app_id")):this.get("url_label")&&(e=this.get("space"))&&e.get("url_label")&&(t=this.get("space").get("org"))&&t.get("url_label")?"/app/org/{0}/space/{1}/{2}".format(t.get("url_label"),e.get("url_label"),this.get("url_label")):"/app/space/{0}/{1}".format(this.get("space_id"),this.get("url_label"))},has_one:function(){return{integration:e("models/Podio.Models.Integration"),space:e("models/Podio.Models.Space")}},has_many:function(){return{fields:e("collections/Podio.Collections.Fields")}},canAddAdvancedFlow:function(){return this.can("add_advanced_flow")},isActive:function(){return"active"===this.get("status")},isMeeting:function(){return"meeting"===this.get("config").type},subscribe:function(){return this.request("post",s.subscribe_path("app",this.get("app_id")),{})},unsubscribe:function(){return this.request("delete",s.unsubscribe_path("app",this.get("app_id")),{})},cleanupRatings:function(e){return t.omit(e,["rsvp","fivestar","yesno","thumbs","rsvp_label","fivestar_label","yesno_label","thumbs_label"])},set:function(e,i,o){var n;return"object"==typeof e?(n=e,o=i):(n={})[e]=i,t.isUndefined(n.app_id)||t.isUndefined(n.config)||!this.shouldCleanupRatings||(n.config=this.cleanupRatings(n.config)),this._super(n,o)},delete_app:function(){return this.request("delete",s.app_with_current_space_path(this.get("app_id")),{})},deactivateApp:function(){return this.request("post",s.deactivate_app_with_current_space_path(this.get("app_id")),{})},activateApp:function(){return this.request("post",s.activate_app_with_current_space_path(this.get("app_id")),{})},setDescription:function(e){return this.request("post",s.json_set_app_description_path(this.get("app_id")),{description:e})},setUsage:function(e){return this.request("post",s.json_set_app_usage_path(this.get("app_id")),{usage:e})},install_on_mobile:function(e){return this.request("post",s.install_on_mobile_app_with_current_space_path(this.get("app_id")),{})},export_items:function(e){return this.request("post",s.items_export_path(this.get("app_id"),e))},has_field_type:function(e){return this.get("fields").any(function(t){return t.get("type")===e})},getFieldsOfType:function(e){return this.get("fields").find_all(e)},getActiveFieldsOfType:function(e){return this.get("fields").find_all_active(e)},calendar_ics_url:function(){return a.endpoints.api+"/calendar/app/"+this.get("app_id")+"/ics/"+a.user.user_id+"/"+a.user.calendar_code+"/?priority=0"},hasIntegration:function(){return this.get("integration")&&void 0!==this.get("integration").get("type")},removeUncreatedCategoryOptions:function(){var e=this.get("fields");e&&e.each(function(e){"category"===e.type()&&e.cleanUncreatedCategoryOptions()})},save:function(e,t){return this.removeUncreatedCategoryOptions(),this._super(e,t)},createApp:function(){var e=this.toJSON({recursive:!0});return this.request("post",this.CREATE_APP_URL,e).then(function(e){return this.set(this.parse(e)),(new i.Deferred).resolve()}.bind(this))},deleteField:function(e,t){var i=this.get("fields_to_delete")||[];i.push({field_id:e,delete_values:t}),this.set("fields_to_delete",i)}})}),define("jst!net_promoter_score/rate",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="rater">\n	<form id="rate_form" name="rate">\n		<ul>\n			<li class="thumb down">\n				<div class="icon-32 icon-32-thumbdown"></div>\n			</li>\n			<li class="rate-1" data-score="0">\n				<span>0</span>\n				<input type="radio" id="score0" name="score" value="0" />\n			</li>\n			<li class="rate-2" data-score="1">\n				<span>1</span>\n				<input type="radio" id="score1" name="score" value="1" />\n			</li>\n			<li class="rate-3" data-score="2">\n				<span>2</span>\n				<input type="radio" id="score2" name="score" value="2" />\n			</li>\n			<li class="rate-4" data-score="3">\n				<span>3</span>\n				<input type="radio" id="score3" name="score" value="3" />\n			</li>\n			<li class="rate-5" data-score="4">\n				<span>4</span>\n				<input type="radio" id="score4" name="score" value="4" />\n			</li>\n			<li class="rate-6" data-score="5">\n				<span>5</span>\n				<input type="radio" id="score5" name="score" value="5" />\n			</li>\n			<li class="rate-7" data-score="6">\n				<span>6</span>\n				<input type="radio" id="score6" name="score" value="6" />\n			</li>\n			<li class="rate-8" data-score="7">\n				<span>7</span>\n				<input type="radio" id="score7" name="score" value="7" />\n			</li>\n			<li class="rate-9" data-score="8">\n				<span>8</span>\n				<input type="radio" id="score8" name="score" value="8" />\n			</li>\n			<li class="rate-10" data-score="9">\n				<span>9</span>\n				<input type="radio" id="score9" name="score" value="9" />\n			</li>\n			<li class="rate-11" data-score="10">\n				<span class="last">10</span>\n				<input type="radio" id="score10" name="score" value="10" />\n			</li>\n			<li class="thumb up">\n				<div class="icon-32 icon-32-thumbup"></div>\n			</li>\n		</ul>\n	</form>\n</div>\n')}),define("jst!net_promoter_score/feedback",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div>\n	<p><%= translations.headline %></p>\n\n	<textarea class="feedback-text elastic-textarea" placeholder="<%= translations.placeholder %>"></textarea>\n</div>')}),define("jst!net_promoter_score/_footer_step01",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template("<div class=\"footer-feedback\">\n	<%- button(t('Done #net_promoter_score_modal'), '#', {color:'green', class: 'rate-complete disabled'}) %>\n</div>")}),define("jst!net_promoter_score/_footer_feedback",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template("<div class=\"footer-feedback\">\n	<%- button(t('Done #net_promoter_score_modal'), '#', {color:'green', class: 'feedback-complete'}) %>\n</div>")}),define("views/net_promoter_score/Podio.Views.NetPromoterScoreRate",["require","translate","underscore","jquery","lib/Podio.Tracking.GA","lib/backbone/Backbone.PodioView","lib/Podio.UI.Modal","lib/Podio.UI.FlashMessage","jst!net_promoter_score/rate","jst!net_promoter_score/feedback","jst!net_promoter_score/_footer_step01","jst!net_promoter_score/_footer_feedback","lib/jquery/jquery.elastic"],function(e){var t=e("translate"),i=e("underscore"),o=e("jquery"),n=e("lib/Podio.Tracking.GA"),s=e("lib/backbone/Backbone.PodioView"),a=e("lib/Podio.UI.Modal"),r=e("lib/Podio.UI.FlashMessage"),d=e("jst!net_promoter_score/rate"),l=e("jst!net_promoter_score/feedback"),c=e("jst!net_promoter_score/_footer_step01"),h=e("jst!net_promoter_score/_footer_feedback");return e("lib/jquery/jquery.elastic"),s.extend({podioEvents:{"click .feedback-complete":"onFeedbackCompleteButtonClicked","click .rate-complete":"onRateCompleteButtonClicked"},initialize:function(){this._super(),i.bindAll(this,"onFeedbackCompleteButtonClicked","onModalAborted"),this.modalClassName="net-promoter-score-modal",a.signals.onModalClosed.add(this.onModalAborted),a.signals.onModalHidden.add(this.onModalAborted)},mapTextByScore:{promoter:{headline:t("Thank you for rating us. Do you have additional comments that could help us improve your rating of Podio? #net_promoter_score_modal_promoters"),placeholder:t("Please provide some feedback. #net_promoter_score_modal_promoters")},feedback:{headline:t("Thank you for rating us. Do you have additional comments that could help us improve your rating of Podio? #net_promoter_score_modal"),placeholder:t("Please provide some feedback. #net_promoter_score_modal")}},render:function(){var e=this;this.el=a.show(this.getTemplate(d),{title:t("How likely would you be to recommend Podio to a friend or colleague? #net_promoter_score_modal"),className:this.modalClassName,contentClass:"net-promoter-score-content",footerClass:"net-promoter-score-footer",footerHtml:this.getTemplate(c),width:695}),this.setElement(this.el),this.elm=o(this.el),this.podioDelegateEvents(),o("."+this.modalClassName+" .rater").on("click",function(){e.onRateClicked.apply(e,arguments)})},renderFeedback:function(){var e="feedback";this.score>=8&&(e="promoter");var i=this.getTemplate(l,{translations:this.mapTextByScore[e]}),s=this.getTemplate(h);a.hide();var r=a.show(i,{title:t("Thanks #net_promoter_score_modal"),className:this.modalClassName,contentClass:"net-promoter-score-content",footerClass:"net-promoter-score-footer",footerHtml:s});r.find(".feedback-complete").on("click",this.onFeedbackCompleteButtonClicked),o("."+this.modalClassName).find("textarea").elastic().focus(),n.trackEvent("nps","score",this.score,{nps_score:this.score.toString()})},onRateClicked:function(e){e.stopPropagation();var t=o(e.target);t.is(":input")?t=t.parent():(t.is("span")&&(t=t.parent()),t.find("input").prop("checked",!0).focus()),this.score=t.data("score"),i.isUndefined(this.score)||o("."+this.modalClassName).find(".rate-complete").removeClass("disabled")},onRateCompleteButtonClicked:function(e,t){i.isUndefined(this.score)||this.eventBus.trigger("score:click",this.score)},onFeedbackCompleteButtonClicked:function(e,t){var i=o("."+this.modalClassName).find("textarea").val();this.eventBus.trigger("feedback:complete",i)},hideModal:function(){a.hide(),r.show(t("Your feedback has been submitted. #net_promoter_score_modal"))},onModalAborted:function(){this.eventBus.trigger("modal:abort")}})}),define("controllers/net_promoter_score/Podio.Controllers.NetPromoterScore",["require","underscore","lib/backbone/Backbone.PodioController","views/net_promoter_score/Podio.Views.NetPromoterScoreRate","lib/Podio.Routes"],function(e){var t=e("underscore"),i=e("lib/backbone/Backbone.PodioController"),o=e("views/net_promoter_score/Podio.Views.NetPromoterScoreRate"),n=e("lib/Podio.Routes");return i.extend({initialize:function(e){t.bindAll(this,"onScoreChanged"),this._super(),this._bindEvents(),this.promotionData=e.promotionData,this.netPromoterScoreRateView=new o({eventBus:this.eventBus}),this.launchRatingModal(),this.id=0,this.alreadyPostedScore=!1},_bindEvents:function(){this.listenTo(this.eventBus,"score:click",this.onScoreChanged),this.listenTo(this.eventBus,"feedback:complete",this.onFeedbackComplete),this.listenTo(this.eventBus,"modal:abort",this.onModalAborted)},onScoreChanged:function(e){var t=this;return this.alreadyPostedScore&&this.id>0?void t.launchFeedbackModal():void this.request("post",n.net_promoter_score_index_path({score:e})).done(function(e){t.id=e.data.id,t.alreadyPostedScore=!0,t.launchFeedbackModal()})},onFeedbackComplete:function(e){var t=this;this.request("put",n.net_promoter_score_path(this.id),{feedback:e}).done(function(e){t.netPromoterScoreRateView.hideModal()})},onModalAborted:function(){this.request("delete",n.promotion_path(this.promotionData.promotion_id))},launchRatingModal:function(){this.netPromoterScoreRateView.render()},launchFeedbackModal:function(){this.netPromoterScoreRateView.renderFeedback()}})}),define("component!GlobalHomeHelpPane",["require","translate","react","component!HelpPane","lib/view_helpers/base"],function(e){"use strict";var t=e("translate"),i=e("react"),o=e("component!HelpPane"),n=e("lib/view_helpers/base"),s=i.createClass({displayName:"GlobalHomeHelpPane",getDefaultProps:function(){return{closeEvent:"overlay.open"}},render:function(){return i.createElement(o,{openImmediately:this.props.openImmediately,promotionId:this.props.promotionId,closeEvent:this.props.closeEvent,variant:"workspace"},i.createElement("header",{className:"help-pane__header"},i.createElement("p",null,t("There are things to explore... #global_home_help_pane"))),i.createElement("section",{className:"help-pane__content"},i.createElement("h3",{className:"header-title"},t("Your Workspaces #global_home_help_pane")),i.createElement("ul",{className:"help-pane--workspace__space-list"},i.createElement("li",null,i.createElement("p",{className:"help-pane-header"},t("Project Management #global_home_help_pane")),i.createElement("p",null,t("Gather all your projects in one place and use the Deliverables and Meetings apps to structure your work and keep everything on track. #global_home_help_pane"))),i.createElement("li",null,i.createElement("p",{className:"help-pane-header"},t("Intranet #global_home_help_pane")),i.createElement("p",null,t("See whoâ€™s away, schedule staff meetings and set up a company FAQ for those recurring questions. #global_home_help_pane"))),i.createElement("li",null,i.createElement("p",{className:"help-pane-header"},t("Sales Management #global_home_help_pane")),i.createElement("p",null,t("Get an overview of all your deals while keeping track of and sorting leads by the statuses you choose. #global_home_help_pane"))))),i.createElement("footer",{className:"help-pane__footer"},i.createElement("h3",{className:"header-title"},t("Where your workspaces live #global_home_help_pane")),i.createElement("img",{className:"lower-right",src:n.image_url("components/GlobalHomeHelpPane/menu-pane-loop.gif"),width:"310",height:"253"})))}});return s}),define("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController",["require","underscore","lib/backbone/Backbone.PodioController","views/dashboard/Podio.Views.Dashboard.Widget"],function(e){var t=e("underscore"),i=e("lib/backbone/Backbone.PodioController");return i.extend({initialize:function(t){this._super(),this.dashboardEventBus=t.dashboardEventBus,this.context=t.context,this.viewClass||(this.viewClass=e("views/dashboard/Podio.Views.Dashboard.Widget")),this._initViewClass(t),this._bindEvents()},_initViewClass:function(e){this.view=new this.viewClass(t.extend({model:this.model,elmContainer:e.elmContainer,eventBus:this.eventBus,dashboardEventBus:this.dashboardEventBus,context:this.context},e.viewOptions||{}))},onResizedMoved:function(e){this.model.setDashboardData(e),"addWidget"!==this.model.get("type")&&this.dashboardEventBus.trigger("widget:update",this.model)},onDeleted:function(){this.model.get("id")?this.dashboardEventBus.trigger("widget:delete",this.model):this.dashboardEventBus.trigger("widget:deleteDefault",this.model)},onConfigChange:function(e){this.model.set(e,{silent:!0}),this.dashboardEventBus.trigger("widget:update",this.model)},_bindEvents:function(){this.listenTo(this.eventBus,"resizeMove",this.onResizedMoved),this.listenTo(this.eventBus,"delete",this.onDeleted),this.listenTo(this.eventBus,"configChange",this.onConfigChange)}})}),define("controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin",["require","underscore","controllers/dashboard/Podio.Controllers.Dashboard.WidgetController"],function(e){var t=e("underscore"),i=e("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController"),o=99;return{loadChunkSize:1,preloadedItems:0,limit:function(){return this.model.get("config").limit},optimalLimit:function(e,t){return Math.ceil((this.view.itemsForRowsCols(e,t)+this.preloadedItems)/this.loadChunkSize)*this.loadChunkSize},shouldChangeLimit:function(e,t){return this.view.itemsForRowsCols(e,t)+this.preloadedItems>this.limit()||this.limit()>this.optimalLimit(e,t)},onResizedMoved:function(e){var n,s,a=t.extend({},e);this.shouldChangeLimit(e.rows,e.cols)&&(s=this.optimalLimit(e.rows,e.cols),n=Math.min(s,o),a.config=t.extend({},this.model.get("config"),{limit:n})),i.prototype.onResizedMoved.call(this,a)}}}),define("views/dashboard/Podio.Views.Dashboard.OptionsWidgetMixin",["require","underscore","lib/Podio.UI.Tooltips"],function(e){var t=e("underscore"),i=e("lib/Podio.UI.Tooltips");return{podioEvents:function(){return t.extend({},this._super(),{"click .actions .options":"onOptionsClicked"})},optionsViewAttachmentTarget:function(){return this.elm.find(".actions .options")},onOptionsClicked:function(e,o){var n=this;return this.optionsView.isVisible()?void this.optionsView.hide():void this.getOptionsContent().then(function(e){i.hideAll();var o=n.optionsView.render(n.optionsViewAttachmentTarget(),e);t.defer(function(){o.one("outsideclick",function(){n.optionsView.hide()}),n.elm.one("outsideclick",function(){n.elm.toggleClass("hovering",!1)})})})},render:function(){return this.optionsView&&(this.optionsView.hide(),this.optionsView.dispose()),this.optionsView=this.createOptionsView(),this._super()},onMouseLeave:function(){this.optionsView.isVisible()||this._super()}}}),define("views/dashboard/Podio.Views.Dashboard.WidgetOptions",["require","translate","underscore","lib/backbone/Backbone.PodioView","lib/Podio.UI.SimpleBalloon"],function(e){var t=e("translate"),i=e("underscore"),o=e("lib/backbone/Backbone.PodioView"),n=e("lib/Podio.UI.SimpleBalloon");return o.extend({podioEvents:function(){return i.extend({},o.prototype.podioEvents,{"click li":"onOptionClicked"})},initialize:function(e){this._super(),this.simpleBallonView=new n({eventBus:this.options.eventBus,balloonId:this.options.popOverId,contentClass:this.options.contentClass,arrowOffset:this.options.arrowOffset,arrowPosition:this.options.arrowPosition}),this.elm=this.simpleBallonView.elm,this.setElement(this.simpleBallonView.elm.get(0)),i.bindAll(this,"render","isVisible","hide")},render:function(e,t){return this.simpleBallonView.elmAttachmentTarget=e,this.simpleBallonView.content=t,this.simpleBallonView.render(),this.podioDelegateEvents(),this.simpleBallonView.elm.show(),this.elm},isVisible:function(){return this.simpleBallonView.isVisible()},hide:function(){this.simpleBallonView.elm.hide()},getDefaultTitle:function(e,i){switch(this.model.get("type")){case"tasks":return t("mine"===e.config.kind?"My Tasks #dashboard":"My Delegated Tasks #dashboard");case"app_view":return i;default:return this.model.get("title")}},onOptionClicked:function(e,t){var o={config:i.clone(this.model.get("config"))};o.config[e.data("key")]=e.data("value"),o.title=this.getDefaultTitle(o,e.text()),this.hide(),this.eventBus.trigger("configChange",o)}})}),define("collections/Podio.Collections.Labels",["require","underscore","lib/backbone/Backbone.PodioCollection"],function(e){var t=e("underscore"),i=e("lib/backbone/Backbone.PodioCollection");return i.extend({getForPicker:function(){return this.map(function(e){return{icon:"task-label-icon color-{0}".format(e.get("color")),id:e.get("text"),name:e.get("text")}})},getByValue:function(e){return t.isEmpty(e)?this.toJSON():t.compact(this.map(function(t){return t.get("name").toLowerCase().indexOf(e.toLowerCase())>-1?t.toJSON():null}))}})}),define("models/Podio.Models.Form",["require","lib/backbone/Backbone.PodioModel","lib/Podio.Router","lib/Podio.Routes"],function(e){var t=e("lib/backbone/Backbone.PodioModel"),i=e("lib/Podio.Router"),o=e("lib/Podio.Routes");return t.extend({perma_link:function(){return i.getGlobalUrl()+o.webform_path(this.get("app_id"),this.get("form_id"),{format:"html"})}})}),define("models/Podio.Models.App",["require","lib/backbone/Backbone.PodioModel","lib/Podio.Transport","lib/Podio.Routes","models/Podio.Models.Application","models/Podio.Models.Space","models/Podio.Models.Organization","models/Podio.Models.User","models/Podio.Models.Form"],function(e){var t=e("lib/backbone/Backbone.PodioModel"),i=e("lib/Podio.Transport"),o=e("lib/Podio.Routes");return t.extend({has_one:function(){return{application:e("models/Podio.Models.Application"),space:e("models/Podio.Models.Space"),org:e("models/Podio.Models.Organization"),user:e("models/Podio.Models.User"),webform:e("models/Podio.Models.Form")}},subscribe:function(){this.set({subscribed:!0}),i.postJSON(o.subscribe_path("app",this.get("id")),{})},unsubscribe:function(){this.set({subscribed:!1}),i.deleteJSON(o.unsubscribe_path("app",this.get("id")),{})}})}),define("models/Podio.Models.ItemValues",["require","translate","underscore","jquery","numeral","lib/backbone/Backbone.PodioModel","backbone","lib/backbone/backbone-validation-amd","lib/Podio.Time","lib/Podio.Utils"],function(e){var t=e("translate"),i=e("underscore"),o=e("jquery"),n=e("numeral"),s=e("lib/backbone/Backbone.PodioModel"),a=e("backbone"),r=e("lib/backbone/backbone-validation-amd"),d=e("lib/Podio.Time"),l=(e("lib/Podio.Utils"),s.extend({urlAPI:function(){return"/item/{0}/value".format(this.relationParent.get("item_id"))},initialize:function(){i.bindAll(this,"validateMoney"),this.startTracking(),this.addCustomValidatorOnce=i.once(this.addCustomValidatorOnce),this._super()},_flattenProperty:function(e,t){var o=this.get(e);i.isNull(o)||i.every(o,function(e){return i.isNumber(e)})||(i.isArray(o)?this.set(e,i.pluck(o,t?t:"id")):this.set(e,[o.id]))},isNew:function(){return!1},fetchSingleValue:function(e){var t=this,i=new o.Deferred,n="{0}/{1}/v2".format(this.urlAPI(),e);return this.request("get",n).done(function(o){t.set(e,o.values),i.resolve()}),i},saveChanged:function(){var e=this.changedAttributes();if(e===!1)return(new o.Deferred).resolve();var t=this.formatValuesForAPI(e);return this.request("put",this.urlAPI(),t)},formatValuesForAPI:function(e){var t=this.relationParent.get("app").get("fields"),o={};return i.each(e,function(e,n){"app"===t.getByExternalId(n).get("type")?o[n]=this.formatAppReference(e):"contact"===t.getByExternalId(n).get("type")?o[n]=this.formatContact(e):"embed"===t.getByExternalId(n).get("type")?o[n]=this.formatEmbed(e):"image"===t.getByExternalId(n).get("type")?o[n]=i.pluck(e,"file_id"):o[n]=e},this),o},getFormattedValues:function(){return this.formatValuesForAPI(this.toJSON())},formatAppReference:function(e){return e&&!i.isArray(e)&&(e=[e]),i.map(e,function(e){return{value:e.item_id}})},formatEmbed:function(e){return i.map(e,function(e){return{embed:e.embed.embed_id,file:e.file?e.file.file_id:null}})},formatContact:function(e){return i.map(e,function(e){var t=e.type;"space"===t&&e.profile_id&&(t="profile");var i=e.id;if(!i)switch(t){case"user":i=e.user_id;break;case"profile":i=e.profile_id}return{value:{type:t,id:i}}})},getDurationValue:function(e,t){var o=this.get(e);if(t=t||["hours","minutes","seconds"],i.isNull(o)||i.isNaN(o)||i.isUndefined(o))return[null,null,null,null];var n=86400,s=3600,a=60,r=Math.floor(o/n),d=Math.floor((o-r*n)/s),l=Math.floor((o-r*n-d*s)/a),c=Math.round(o-r*n-d*s-l*a);return i.include(t,"days")||(d+=24*r,r=null),i.include(t,"hours")||(l+=60*d,d=null),i.include(t,"minutes")||(c+=60*l,l=null),i.include(t,"seconds")||(c=null),[r,d,l,c]},getNumberValue:function(e,t){var o=this.get(e);if(i.isNull(o)||i.isUndefined(o))return null;var s=n.language();n.language("en");var a=n().unformat(t?o[t]:o);return n.language(s),a},getCategoryValue:function(e){return this._flattenProperty(e),this.get(e)||[]},toggleCategoryValue:function(e,t){var o=i.clone(this.get(e)),n=i.indexOf(o,t);i.isNull(o)&&(o=[]),n>-1?(o.splice(n,1),o.length||(o=null)):o.push(t),this.set(e,o)},toggleSingleselectCategoryValue:function(e,t){var o=this.get(e);i.isNull(o)&&(o=[]),(o.length>1||o[0]!==t)&&(o=[]),this.set(e,o),this.toggleCategoryValue(e,t)},completeFieldsFromApp:function(){var e=this,t=this.relationParent.get("app").get("fields");t.each(function(t){var i=t.get("external_id");e.has(i)||t.isDeleted()||e.set(i,null)})},setupValidation:function(){var e=this,t=this.relationParent.get("app").get("fields");this.completeFieldsFromApp(),this.addCustomValidatorOnce(),this.validation=this.validation||{},this.labels={},i.each(this.keys(),function(i){var o=t.getByExternalId(i);switch(e.labels[i]=o.get("label"),e.validation[i]={requiredAppField:o.isActive()},o.type()){case"category":e.validation[i]={requireCategory:o.isActive()};break;case"number":e.validation[i].requireNumber=!0;break;case"duration":e.validation[i].requireInteger=!0;break;case"money":e.validation[i].requireMoney=!0;break;case"date":e.validation[i].requireDate=!0;break;case"state":case"question":case"video":e.validation[i]={}}})},addCustomValidatorOnce:function(){i.extend(a.Validation.validators,{requiredAppField:this.validateRequired,requireNumber:this.validateNumber,requireInteger:this.validateInteger,requireMoney:this.validateMoney,requireCategory:this.validateCategory.curry(this),requireDate:this.validateDate})},validateInteger:function(e,i,o,n){return null===e||"number"==typeof e&&e%1===0&&e>=0?void 0:t("Only whole numbers are allowed #apps_items_v2")},validateNumber:function(e,i,o,s){var a=n.languageData().delimiters,r=e?(e.toString().match(new RegExp("\\"+a.decimal,"g"))||[]).length:0;return null!==e&&!e.match(/^-?[0-9\.\s,]*$/)||r>1?t("Only numbers are allowed #apps_items_v2"):void 0},validateMoney:function(e,i,o,n){var s=n.relationParent.get("app").get("fields"),a=s.getByExternalId(i),r=a.get("config").settings.allowed_currencies;return null!==e?r.indexOf(e.currency)<0?t("Currency {0} is no longer available for this field. Please choose another currency. #apps_items_v2.money_error").format(e.currency):this.validateNumber(e.value,i,o,n):void 0},validateDate:function(e,o,n,s){var a=(s.relationParent.get("app").get("config").type,s.relationParent.get("app").get("fields")),r=a.getByExternalId(o),l=i.isUndefined(r.get("config").settings.end)||"required"===r.get("config").settings.end||"enabled"===r.get("config").settings.end;i.isUndefined(r.get("config").settings.time)||"required"===r.get("config").settings.time||"enabled"===r.get("config").settings.time;if(!i.isNull(e)){if(!e.start_date)return t("You must provide a start date #apps_items_v2");if(l){if(e.end_time&&!e.start_time)return t("Start time is required if end time is specified #apps_items_v2");if(e.end_time&&!e.end_date)return t("End date has to be specified if end time is present. #apps_items_v2");if(!e.end_time&&e.end_date&&e.start_time)return t("End time has to be specified if start time is specified #apps_items_v2")}if("required"===r.get("config").settings.time)if(l){if(!e.start_time||!e.end_time)return t("You must provide start and end times #apps_items_v2")}else if(!e.start_time)return t("You must provide a start time #apps_items_v2");if("required"===r.get("config").settings.end&&!e.end_date)return t("You must provide an end date #apps_items_v2");var c=d.localMomentFromDateFieldString("{0} {1}".format(e.start_date,e.start_time?e.start_time:""));if(e.end_date){var h=d.localMomentFromDateFieldString("{0} {1}".format(e.end_date,e.end_time?e.end_time:""));if("required"===r.get("config").settings.end&&c>=h)return t("End date must be after start date #apps_items_v2");if(c>h)return t("Start date must be before end date #apps_items_v2")}}},validateCategory:function(e,t,o,n,s){var a=s.relationParent.get("app").get("fields"),r=a.getByExternalId(o),d=i.toArray(arguments);return d.splice(0,1),r.hasActiveCategoryOptions()?e.validateRequiredArray.apply(this,d):void 0},validateRequiredArray:function(e,o,n,s){var a=s.relationParent.get("app").get("fields"),r=a.getByExternalId(o),d=r.get("config").required;return d&&i.isEmpty(e)?this.format(t("{0} is required #validation"),this.formatLabel(o,s)):void 0},validateRequired:function(e,t,o,n){var s=n.relationParent.get("app").get("fields");if(!s)return!1;var a,r=s.getByExternalId(t),d=r.get("config").required;return d&&(a=this.required(e,t,!0,n,i.clone(n.attributes)))?a:void 0},isEmpty:function(){var e=this;return this._super()||i.all(this.keys(),function(t){return i.isNull(e.get(t))})},hasUnsavedAttributes:function(){var e=this.unsavedAttributes();return e===!1?!1:i.any(e,function(e){return!i.isNull(e)})},belongsToExistingItem:function(){return!i.isUndefined(this.relationParent.get("item_id"))}}));return i.extend(l.prototype,r.mixin),l}),define("models/Podio.Models.Recurrence",["require","lib/backbone/Backbone.PodioModel"],function(e){var t=e("lib/backbone/Backbone.PodioModel");return t.extend({})}),define("models/Podio.Models.Reminder",["require","lib/backbone/Backbone.PodioModel"],function(e){var t=e("lib/backbone/Backbone.PodioModel");return t.extend({})}),define("models/Podio.Models.Grant",["require","lib/backbone/Backbone.PodioModel","lib/Podio.Routes","lib/Podio.Routes","models/Podio.Models.Reference"],function(e){var t=e("lib/backbone/Backbone.PodioModel");e("lib/Podio.Routes"),e("lib/Podio.Routes");return t.extend({urlAPI:function(){return"/grant/{0}/{1}/own".format(this.get("ref").get("type"),this.get("ref").get("id"))},has_one:function(){return{ref:e("models/Podio.Models.Reference")}}})}),define("models/Podio.Models.ItemField",["require","underscore","models/Podio.Models.Field","lib/Podio.Routes"],function(e){var t=e("underscore"),i=e("models/Podio.Models.Field");e("lib/Podio.Routes");return i.extend({idAttribute:"field_id",urlAPI:function(){var e=this.collection?this.collection.relationParent.get("item_id"):this.relationParent.get("item_id");return"/item/{0}/value/{1}".format(e,this.get("field_id"))},parse:function(e,t){return this.useDirectAPIAccess&&(e={values:e}),this._super(e,t)},getCategorizableFieldValues:function(){return t.include(["category","question"],this.get("type"))?this.getCategoryFieldValues():"state"===this.get("type")?this.getStateFieldValues():[]},getCategoryFieldValues:function(){var e=t.pluck(this.get("values"),"value");return t.filter(e,function(e){return"active"===e.status})},getStateFieldValues:function(){return t.map(this.get("values"),function(e){return{id:e.value,text:e.value}})},getContactFieldValues:function(){return t.map(this.get("values"),function(e){return{id:e.value.profile_id,text:e.value.name}})},getAppRefFieldValues:function(){return t.map(this.get("values"),function(e){return{id:e.value.item_id,text:e.value.title}})}})}),define("collections/Podio.Collections.ItemFields",["require","collections/Podio.Collections.Fields","models/Podio.Models.ItemField"],function(e){var t=e("collections/Podio.Collections.Fields");return t.extend({configure:function(){this.model=e("models/Podio.Models.ItemField")}})}),define("models/Podio.Models.Item",["require","underscore","jquery","lib/backbone/Backbone.PodioModel","lib/Podio.Routes","lib/Podio.Routes","lib/Podio.Utils","models/Podio.Models.Application","models/Podio.Models.ItemValues","models/Podio.Models.Recurrence","models/Podio.Models.Reminder","models/Podio.Models.Grant","collections/Podio.Collections.ItemFields","collections/Podio.Collections.Comments","collections/Podio.Collections.Files"],function(e){var t=e("underscore"),i=e("jquery"),o=e("lib/backbone/Backbone.PodioModel"),n=e("lib/Podio.Routes"),s=e("lib/Podio.Routes"),a=e("lib/Podio.Utils");return o.extend({urlRails:function(){return s.app_item_show_path(this.get("org_slug"),this.get("space_slug"),this.get("app_id"),this.get("app_item_id"))},urlAPI:function(){return"/org/{0}/space/{1}/app/{2}/item/{3}".format(this.get("org_slug"),this.get("space_slug"),this.get("app_id"),this.get("app_item_id"))},has_one:function(){return{app:e("models/Podio.Models.Application"),values:e("models/Podio.Models.ItemValues"),recurrence:e("models/Podio.Models.Recurrence"),reminder:e("models/Podio.Models.Reminder"),grant:e("models/Podio.Models.Grant")}},has_many:function(){return{fields:e("collections/Podio.Collections.ItemFields"),comments:e("collections/Podio.Collections.Comments"),
files:e("collections/Podio.Collections.Files")}},initialize:function(){this.set({views:[]})},subscribe:function(){return this.set({subscribed:!0}),this.request("post",n.subscribe_path("item",this.get("item_id")),{},{useLegacyTransport:!0})},unsubscribe:function(){return this.set({subscribed:!1}),this.request("delete",n.unsubscribe_path("item",this.get("item_id")),{},{useLegacyTransport:!0})},like:function(e){return this.request("post",n.rating_path("item",this.get("item_id"),"like",{value:1,variant:e}),{},{useLegacyTransport:!0})},unlike:function(e){return this.request("delete",n.rating_path("item",this.get("item_id"),"like",{value:1,variant:e}),{},{useLegacyTransport:!0})},reload:function(){var e=new i.Deferred,t=this,o=this.request("get",n.json_item_path(this.get("item_id")),{},{useLegacyTransport:!0});return o.done(function(i,n){t.set(i.data.item[0]),o=null,e.resolve(this)}),e},hasTasks:function(){return this.get("task_count")>0},hasComments:function(){return this.get("comment_count")>0},getLikeCount:function(){return this.request("get",n.ratings_like_count_path("item",this.get("item_id")),{},{useLegacyTransport:!0})},getAllLikes:function(){return this.request("get",n.ratings_all_likes_path("item",this.get("item_id")),{},{useLegacyTransport:!0})},moveCardItem:function(e,t,o){var s=this,a=this.get("views"),r=i.Deferred(),d=this.get("groupFieldId"),l=this.get("colFieldId"),c=n.item_rearrange_path(this.get("id")),h={},u={move_item:{priority:{},values:{}}};return o.aboveId&&(u.move_item.priority.above=o.aboveId),o.belowId&&(u.move_item.priority.below=o.belowId),l&&("no-value"!==e.from&&(h.from=e.from),"no-value"!==e.to&&(h.to=e.to),u.move_item.values[l.toString()]=h,h={}),d&&("no-value"!==t.from&&(h.from=t.from),"no-value"!==t.to&&(h.to=t.to),u.move_item.values[d.toString()]=h),this.request("post",c,u).done(function(e){"ok"===e.status&&(s.reset(e.data.object),s.set({views:a,colFieldId:l,groupFieldId:d}),r.resolve())}),r},printPath:function(){return n.print_item_path(this.get("item_id"),{format:"html"})},getFirstCategorizableFieldValue:function(){var e=this.get("fields").find(function(e){return e.getCategorizableFieldValues().length>0});return e?e.getCategorizableFieldValues()[0]:void 0},saveNewItem:function(){var e=a.showFeature("sharefile_edit_preview")?"files.fields(preview_link,edit_link,expandable)":"files.fields(expandable)",o="/item/app/{0}?fields=values,app.view(edit).fields(rights,space.view(micro).fields(premium,contact_migration,role,org.view(micro).fields(type))),like_count,subscribed,is_liked,grant_count,{1},tags,refs,grant.fields(message,action,created_by),votes,email_item_comment_user,email_item_comment_app&view=full_nested".format(this.get("app").get("app_id"),e),n=this.get("values").validate(),s=t.isUndefined(n);return s?this.request("POST",o,{fields:this.get("values").getFormattedValues(),file_ids:this.get("files")?this.get("files").pluck("file_id"):[],tags:this.get("tags")||[]}):(new i.Deferred).reject()},fetchItemClone:function(e){var t=this._getAPIHostName()+"/item/{0}/clone".format(e);return this.unset("title"),this.fetch({url:t,deep:!0})},downloadAllFiles:function(){var e="/file/item/{0}/zip".format(this.get("item_id"));return this.request("GET",e)},hasRelatedItems:function(){return!t.isEmpty(this.get("refs"))},getRelatedItems:function(){return this.get("refs")}})}),define("models/Podio.Models.Reference",["require","lib/backbone/Backbone.PodioModel","models/Podio.Models.Space","models/Podio.Models.App","models/Podio.Models.Item","models/Podio.Models.File"],function(e){var t=e("lib/backbone/Backbone.PodioModel");return t.extend({modelMap:function(){return{space:e("models/Podio.Models.Space"),app:e("models/Podio.Models.App"),item:e("models/Podio.Models.Item"),file:e("models/Podio.Models.File"),conversation:t,status:t,action:t}},getEntity:function(){var e=this.modelMap();if(!this.entity){var t=this.get("data");this.entity=new(e[this.get("type")])(t)}return this.entity},getIcon:function(){var e=this.getEntity();switch(this.get("type")){case"app":return e.get("icon_id");case"item":return e.get("app").get("icon_id");case"conversation":return"333";case"space":return"28";case"status":return"status";case"action":return"324"}}})}),define("models/Podio.Models.Task",["require","translate","underscore","jquery","lib/backbone/Backbone.PodioModel","lib/Podio.Routes","lib/Podio.UI.FlashMessage","lib/Podio.Time","collections/Podio.Collections.Files","collections/Podio.Collections.Comments","collections/Podio.Collections.Labels","models/Podio.Models.User","models/Podio.Models.User","models/Podio.Models.User","models/Podio.Models.Reference","models/Podio.Models.Recurrence","models/Podio.Models.Reminder","models/Podio.Models.Application"],function(e){var t=e("translate"),i=e("underscore"),o=e("jquery"),n=e("lib/backbone/Backbone.PodioModel"),s=e("lib/Podio.Routes"),a=e("lib/Podio.UI.FlashMessage"),r=e("lib/Podio.Time");return n.extend({urlRoot:s.json_task_index_path({format:""}),has_many:function(){return{files:e("collections/Podio.Collections.Files"),comments:e("collections/Podio.Collections.Comments"),labels:e("collections/Podio.Collections.Labels")}},has_one:function(){return{responsible:e("models/Podio.Models.User"),created_by:e("models/Podio.Models.User"),completed_by:e("models/Podio.Models.User"),ref:e("models/Podio.Models.Reference"),recurrence:e("models/Podio.Models.Recurrence"),reminder:e("models/Podio.Models.Reminder"),app:e("models/Podio.Models.Application")}},initialize:function(){i.bindAll(this,"updateModel","complete","uncomplete")},isOverdue:function(){return this.get("overdue?")?this.get("overdue?"):this.get("due_on")?r.current()>r.localMomentFromAPIString(this.get("due_on")):!1},isDueToday:function(){return this.get("due_on")?r.current().format("YYYY-MM-DD")===r.localMomentFromAPIString(this.get("due_on")).format("YYYY-MM-DD"):!1},isCompleted:function(){return this.get("status")?"completed"===this.get("status"):!i.isNull(this.get("completed_on"))},hasDueDate:function(){return!i.isNull(this.get("due_on"))},hasDueTime:function(){return!i.isNull(this.get("due_time"))},hasResponsible:function(){return!i.isNull(this.get("responsible"))},hasDescription:function(){return!i.isNull(this.get("description"))&&this.get("description").length},hasVisibility:function(){return!i.isNull(this.get("private"))},hasReference:function(){return!i.isNull(this.get("ref"))},hasLabels:function(){return!i.isNull(this.get("labels"))&&!this.get("labels").isEmpty()},hasFiles:function(){return!i.isNull(this.get("files"))},allowPrivacyChange:function(){return this.hasReference()&&"conversation"!==this.get("ref").get("type")},toggleCompletion:function(){return this.isCompleted()?this.uncomplete():this.complete()},complete:function(){return this.request("post",s.complete_json_task_path(this.get("task_id")),{}).done(this.updateModel)},uncomplete:function(){return this.request("post",s.uncomplete_json_task_path(this.get("task_id")),{}).done(this.updateModel)},updateModel:function(e){"ok"===e.status&&this.set(e.data.task)},validateProperty:function(e,t){switch(e){case"responsible":case"text":return!i.isEmpty(t);default:return!0}},prepareLabelUpdateData:function(e){return{update_labels:!0,label_list_existing:e}},prepareDueDateUpdateData:function(e){var t={field:"due_on",due_date:e.date};return i.isNull(e.time)||(t.due_date_time=e.time),t},saveField:function(e,t){var i,n=new o.Deferred;return this.get(e)===t?n.resolve():this.validateProperty(e,t)?(i="labels"===e?this.prepareLabelUpdateData(t):"due"===e?this.prepareDueDateUpdateData(t):{field:e,value:t},this.request("put",s.json_task_path(this.get("task_id")),i).done(this.updateModel)):n.reject()},removeReference:function(){return this.saveReference("",null)},saveReference:function(e,i){var o=s.update_reference_json_task_path(this.get("task_id")),n=this.request("put",o,{ref_type:i,ref_id:e}).done(this.updateModel);return n.done(function(e){var i;"error"===e.status&&(i="forbidden"===e.error_code?t("The assignee of the task does not have access to the space you are trying to reference. #tasks"):e.message,e.error_propagate||a.show(i,"error"))}),n},like:function(e){return this.request("post",s.rating_path("task",this.get("id")||this.get("task_id"),"like",{value:1,variant:e}))},unlike:function(e){return this.request("delete",s.rating_path("task",this.get("id")||this.get("task_id"),"like",{value:1,variant:e}))},subscribe:function(){return this.set({subscribed:!0}),this.request("post",s.subscribe_path("task",this.get("id")||this.get("task_id")),{})},unsubscribe:function(){return this.set({subscribed:!1}),this.request("delete",s.unsubscribe_path("task",this.get("id")||this.get("task_id")),{})},printPath:function(){return s.print_task_path(this.get("id"),{format:"html"})}})}),define("jst!dashboard/_options",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<ul>\n  <% _.each(options, function(option){ %>\n    <li class="image-block<%= currentValue === option.value ? \' selected\' : \'\' %>" data-value="<%= option.value %>" data-key="<%= option.key %>">\n      <div class="icon-16 img space-right<%= currentValue === option.value ? \' icon-16-single-green-tick\' : \'\' %>"></div>\n      <div class="bd"><%= option.label %></div>\n    </li>\n  <% }); %>\n</ul>\n')}),define("views/dashboard/Podio.Views.Dashboard.TasksWidget",["require","translate","underscore","jquery","views/dashboard/Podio.Views.Dashboard.Widget","views/dashboard/Podio.Views.Dashboard.OptionsWidgetMixin","views/dashboard/Podio.Views.Dashboard.WidgetOptions","models/Podio.Models.Task","lib/Podio.UI.Tasks.Create","lib/Podio.UI.SimpleBalloon","lib/Podio.Event","lib/Podio.Config","lib/Podio.Tracking","jst!dashboard/_tasks_widget","jst!dashboard/_options"],function(e){var t=e("translate"),i=e("underscore"),o=e("jquery"),n=e("views/dashboard/Podio.Views.Dashboard.Widget"),s=e("views/dashboard/Podio.Views.Dashboard.OptionsWidgetMixin"),a=e("views/dashboard/Podio.Views.Dashboard.WidgetOptions"),r=e("models/Podio.Models.Task"),d=e("lib/Podio.UI.Tasks.Create"),l=(e("lib/Podio.UI.SimpleBalloon"),e("lib/Podio.Event")),c=(e("lib/Podio.Config"),e("lib/Podio.Tracking"),e("jst!dashboard/_tasks_widget"),e("jst!dashboard/_options"));return n.extend(s).extend({podioEvents:function(){return i.extend({},this._super(),{"click .create-task":"onCreateTaskClicked","click .tickbox":"onToggleTaskClicked"})},initialize:function(e){this._super(),i.extend(this.translations,{blankslate_message:t("No tasks #dashboard"),create_task:t("Create task #dashboard")}),this.listenTo(this.model,"change:data",this.updateTaskModels),this.taskModels=[],this.updateTaskModels(),i.bindAll(this,"onCreateTaskClicked","updateTaskModels","onToggleTaskClicked","render","onTaskCreated"),l.bind(l.Types.taskComplete,this.onTaskCreated)},updateTaskModels:function(){this.taskModels=i.map(this.model.get("data").tasks,function(e){return new r(e)})},onTaskCreated:function(){this.model.fetch()},renderOptions:function(){var e=this.model.get("ref"),t=this.model.get("config").kind,o="user"===e.type,n="user"===e.type&&"mine"===t,s="space"===e.type||"delegated"===t,a={format:""};return"delegated"===t&&(a.show="delegated"),i.extend(this._super(),{showOptions:o,showResponsible:s,showRef:n,linkParameters:a,tasks:this.taskModels})},createOptionsView:function(){return new a({eventBus:this.eventBus,balloonId:"taskWidget-"+this.model.id,contentClass:"dashboard-options",arrowOffset:25,arrowPosition:"right",model:this.model})},getOptionsContent:function(){var e=o.Deferred(),i=[{label:t("My Tasks #dashboard"),value:"mine",key:"kind"},{label:t("My Delegated Tasks #dashboard"),value:"delegated",key:"kind"}];return e.resolve(this.getTemplate(c,{options:i,currentValue:this.model.get("config").kind})),e},onCreateTaskClicked:function(e,t){var i={},o=this.model.get("ref");("space"===o.type||"app"===o.type)&&(i.attributes={ref_type:o.type,ref_id:o.id}),d.newModal(i)},onToggleTaskClicked:function(e,t){var o=e.closest("li").data("id"),n=i.find(this.taskModels,function(e){return e.get("task_id")===o}),s=n.isCompleted()?"uncomplete":"complete";n[s]().done(this.render)},headerFooterRows:function(){return 3}})}),define("controllers/dashboard/Podio.Controllers.Dashboard.TasksWidgetController",["require","controllers/dashboard/Podio.Controllers.Dashboard.WidgetController","controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin","views/dashboard/Podio.Views.Dashboard.TasksWidget"],function(e){var t=e("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController"),i=e("controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin");return t.extend(i).extend({initialize:function(t){this.viewClass=e("views/dashboard/Podio.Views.Dashboard.TasksWidget"),this._super(t)}})}),define("views/dashboard/Podio.Views.Dashboard.EventsWidget",["require","translate","underscore","views/dashboard/Podio.Views.Dashboard.Widget"],function(e){var t=e("translate"),i=e("underscore"),o=e("views/dashboard/Podio.Views.Dashboard.Widget");return o.extend({initialize:function(){this._super(),i.extend(this.translations,{blankslate_message:t("No events #dashboard")})}})}),define("controllers/dashboard/Podio.Controllers.Dashboard.EventsWidgetController",["require","controllers/dashboard/Podio.Controllers.Dashboard.WidgetController","controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin","views/dashboard/Podio.Views.Dashboard.EventsWidget"],function(e){var t=e("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController"),i=e("controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin");return t.extend(i).extend({initialize:function(t){this.viewClass=e("views/dashboard/Podio.Views.Dashboard.EventsWidget"),this._super(t)}})}),define("views/dashboard/Podio.Views.Dashboard.ProfilesWidget",["require","underscore","jquery","views/dashboard/Podio.Views.Dashboard.Widget","lib/Podio.UI.Tooltips","lib/Podio.Config","lib/Podio.Tracking"],function(e){var t=e("underscore"),i=e("jquery"),o=e("views/dashboard/Podio.Views.Dashboard.Widget"),n=e("lib/Podio.UI.Tooltips");e("lib/Podio.Config"),e("lib/Podio.Tracking");return o.extend({podioEvents:function(){return t.extend({},this._super(),{"click .avatar a":"onAvatarClicked"})},initialize:function(){this._super(),t.bindAll(this,"onActionClicked"),this.showActionsForProfile=null,this.elmActions=i('<div class="dashboard-profile-actions"></div>'),i("body").append(this.elmActions),this.elmActions.delegate("a","click",this.onActionClicked)},onAvatarClicked:function(e,i){var o=this;if(this.elmActions.unbind("outsideclick"),this.showActionsForProfile===e.data("id"))this.elmActions.hide(),this.showActionsForProfile=null;else{var s=e.offset();n.hideAll(),this.elmActions.html(e.closest(".avatar").find(".actions").html()).show(),this.showActionsForProfile=e.data("id"),this.elmActions.css({top:s.top+52,left:s.left-49}),t.defer(function(){o.elmActions.bind("outsideclick",function(){o.elmActions.unbind("outsideclick"),o.elmActions.hide(),o.showActionsForProfile=null})})}},onActionClicked:function(e){this.elmActions.hide()},itemsForRowsCols:function(e,t){var i=6,o=1,n=e-this.headerFooterRows();return n*(t*i+t-o)},headerFooterRows:function(){return 3}})}),define("controllers/dashboard/Podio.Controllers.Dashboard.ProfilesWidgetController",["require","controllers/dashboard/Podio.Controllers.Dashboard.WidgetController","controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin","views/dashboard/Podio.Views.Dashboard.ProfilesWidget"],function(e){var t=e("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController"),i=e("controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin");return t.extend(i).extend({initialize:function(t){this.viewClass=e("views/dashboard/Podio.Views.Dashboard.ProfilesWidget"),this._super(t)}})}),define("views/dashboard/Podio.Views.Dashboard.AppsWidget",["require","translate","underscore","views/dashboard/Podio.Views.Dashboard.Widget","jst!dashboard/_apps_widget"],function(e){var t=e("translate"),i=e("underscore"),o=e("views/dashboard/Podio.Views.Dashboard.Widget");e("jst!dashboard/_apps_widget");return o.extend({initialize:function(){this._super(),i.extend(this.translations,{blankslate_message:t("No favorite apps #dashboard"),createItemTooltip:t("Create new {0} #dashboard")})}})}),define("controllers/dashboard/Podio.Controllers.Dashboard.AppsWidgetController",["require","controllers/dashboard/Podio.Controllers.Dashboard.WidgetController","controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin","views/dashboard/Podio.Views.Dashboard.AppsWidget"],function(e){var t=e("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController"),i=e("controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin");return t.extend(i).extend({headerFooterRows:2,initialize:function(t){this.viewClass=e("views/dashboard/Podio.Views.Dashboard.AppsWidget"),this._super(t)}})}),define("models/Podio.Models.CalcWidget",["require","underscore","lib/backbone/Backbone.PodioModel","lib/Podio.Config","lib/Podio.Routes","lib/backbone/FiltersFormattingMixin"],function(e){var t=e("underscore"),i=e("lib/backbone/Backbone.PodioModel"),o=e("lib/Podio.Config"),n=e("lib/Podio.Routes"),s=e("lib/backbone/FiltersFormattingMixin"),a=i.extend({defaults:{rows:7},urlRootRails:n.widgets_path({format:""}),urlRootAPI:"/widget",initialize:function(){t.bindAll(this,"setUnits","getUnits","parse","setTarget"),t.bindAll(this,"fetchWidget","fetchWidgetFilters","parseWidget")},setUnits:function(e){this.get("config").unit=e},getUnits:function(){return this.get("config").unit||""},setTitle:function(e){this.set({title:e})},setTarget:function(e){var t={type:e};t.id=this._getTargetIdByType(e),this.set({ref_type:t.type,ref_id:t.id,ref:t})},_getTargetIdByType:function(e){var t;switch(e){case"app":t=this.get("config").app_id;break;case"space":t=parseInt(o.space_id,10);break;case"emp_network":t=o.current_employee_network_id;break;case"org":t=o.current_org_id;break;case"user":t=o.user.user_id}return t},cloneTo:function(e){this.useDirectAPIAccess=!0;var t="emp_network"===e?"space":e,i=this.request("POST","/widget/{0}/clone".format(this.get("widget_id")),{type:t,id:this._getTargetIdByType(e)});return this.useDirectAPIAccess=!1,i},getTarget:function(){return this.get("ref")?this.get("ref").type:""},saveModel:function(e,i){var o=e;this.set({type:"calculation"}),t.isEmpty(i)||(o.filters=i);var n=t.extend(this.get("config"),{calculation:o});return this.isNew()?this.save(null,null,{data:t.extend(this.toJSON(),{config:n})}):this.save(null,null,{data:{title:this.get("title"),type:this.get("type"),config:n}})},fetchWidget:function(){return this.fetch({success:this.parseWidget})},fetchWidgetFilters:function(){return this.fetch().then(function(e){return this.useDirectAPIAccess&&(t.isNull(e.config.calculation.filters)||(e.config.calculation.filters=this.mapFiltersForPresentation(e.config.calculation.filters,this.appModel))),e}.bind(this))},parseWidget:function(e,t){this.useDirectAPIAccess?this.set(t):"ok"===t.status&&t.data.object&&(this.trigger("calcWidget:widgetDataLoaded",t.data.object),this.set(t.data.object))},parse:function(){return{}},hasCalculation:function(){return!t.isEmpty(this.get("config").calculation)},getCalculation:function(){return this.get("config").calculation},isGrouped:function(){return this.hasCalculation()&&this.getCalculation().grouping}});return t.extend(a.prototype,s),a}),define("lib/view_helpers/appCalculations",["require","translate","moment","lib/view_helpers/base","lib/Podio.Config"],function(e){var t=e("translate"),i=e("moment"),o=e("lib/view_helpers/base"),n=e("lib/Podio.Config"),s={formatDate:function(e,t){return i(e).format("L")},formatWeekday:function(e,t){var i=parseInt(e,10);return n.localeSettings.moment.weekdays[i>5?0:i+1]},formatWeek:function(e,i){var o=e.split("-");return t("Week #date")+" {0}, {1}".format(o[1],o[0])},formatMonth:function(e,t){return t?i(e,"YYYY-MM").format("MMM YYYY"):i(e,"YYYY-MM").format("MMMM YYYY")},formatTimeLabel:function(e,t,i){var o=this["format"+t.capitalize()];return o?o(e,i):e},formatCalculationValue:function(e,t){if("week"===e){var o=i(t,"YYYY-ww"),n=o.clone().add(6,"days");return"{0}:{1}".format(o.format("YYYY-MM-DD"),n.format("YYYY-MM-DD"))}return"date"===e?"{0}:{0}".format(t):t}};return o.registerHelpers(s),s}),define("lib/view_helpers/charts",["require","underscore","moment","lib/Podio.Utils","lib/view_helpers/appCalculations"],function(e){var t=e("underscore"),i=e("moment"),o=e("lib/Podio.Utils"),n=e("lib/view_helpers/appCalculations"),s=function(e,i,o){var n={bar:{baselineColor:"transparent",gridlines:{color:"transparent"},textStyle:{color:"#444444",fontSize:13}},line:{baselineColor:"#e9e9e9",gridlines:{color:"transparent"},textStyle:{color:"#444444",fontSize:13}}},s=300>i,a={bar:{tooltip:{trigger:"none"},fontName:"Arial",colors:["#d2e4ec"],chartArea:s?{width:"45%",left:"50%",top:"0%",height:o-17}:{width:"80%",left:"20%",top:"0%",height:o-17},legend:{position:"none"},hAxis:n.bar,vAxis:n.bar},line:{pointSize:5,chartArea:s?{width:"65%",left:"35%"}:{width:"85%",left:"15%"},tooltip:{isHtml:!1},fontName:"Arial",colors:["#d2e4ec"],legend:{position:"none"},hAxis:t.extend(n.line),vAxis:t.extend(n.line)}};return a[e]},a=function(e,t,s,a){var r=-1!==["date","weekday","week","month","year"].indexOf(s),d="line"===e&&-1!==["date","month","year"].indexOf(s);return t=t.map(function(t){var a=r?n.formatTimeLabel(t.label,s,!0):t.label,l=o.formatNumber(t.count);return"bar"===e?[a,t.count,l]:d?(a=t.value,-1!==a.indexOf(":")&&(a=a.split(":"),a=a[0]),[i(a).toDate(),t.count]):[a,t.count]}),"line"===e&&t.reverse(),t};return{getConfig:s,formatGroups:a}}),define("jst!dashboard/_calculation_blank",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<span class="header">\n  <h5 class="header-title"><span class="app-icon-16 icon-<%=appIcon%>"></span><%- link_to(headerUrl, title) %></h5>\n  <div class="actions">\n    <div class="action tooltip remove icon-16 icon-16-grey-slim-x" title="<%= translations.remove %>"></div>\n  </div>\n</span>\n\n<div class="content">\n  <div class="inner blank-slate">\n    <p>\n      <% if (canAddWidget) { %>\n        <%=t(\'You will be taken to an app where you can create a new widget or save an existing one to this dashboard #dashboard\')%>\n      <% } else { %>\n        <%=t(\'You do not have rights to create new widgets on the selected app, please ask an admin for assistance #dashboard\')%>\n      <% } %>\n    </p>\n    <% if (canAddWidget) { %>\n      <a href="<%=appUrl%>"><%=t(\'Add or modify a widget #dashboard\')%></a>\n    <% } %>\n  </div>\n</div>\n\n<div class="no-footer"><div class="overflow"></div></div>')}),define("async",[],function(){function e(e){var t,i;t=document.createElement("script"),t.type="text/javascript",t.async=!0,t.src=e,i=document.getElementsByTagName("script")[0],i.parentNode.insertBefore(t,i)}function t(e,t){var i=/!(.+)/,n=e.replace(i,""),s=i.test(e)?e.replace(/.+!/,""):o;return n+=n.indexOf("?")<0?"?":"&",n+s+"="+t}function i(){return n+=1,"__async_req_"+n+"__"}var o="callback",n=0;return{load:function(o,n,s,a){if(a.isBuild)s(null);else{var r=i();window[r]=s,e(t(n.toUrl(o),r))}}}}),define("propertyParser",[],function(){function e(e){for(var o,n={};o=i.exec(e);)n[o[1]]=t(o[2]||o[3]);return n}function t(e){return o.test(e)?e=e.replace(o,"$1").split(","):"null"===e?e=null:"false"===e?e=!1:"true"===e?e=!0:""===e||"''"===e||'""'===e?e="":isNaN(e)||(e=+e),e}var i=/([\w-]+)\s*:\s*(?:(\[[^\]]+\])|([^,]+)),?/g,o=/^\[([^\]]+)\]$/;return{parseProperties:e,typecastVal:t}}),define("goog",["async","propertyParser"],function(e,t){function i(e){var i=o.exec(e),n={moduleName:i[1],version:i[2]||"1"};return n.settings=t.parseProperties(i[3]),n}var o=/^([^,]+)(?:,([^,]+))?(?:,(.+))?/;return{load:function(e,t,o,n){if(n.isBuild)o(null);else{var s=i(e),a=s.settings;a.callback=o,t(["async!"+("https:"===document.location.protocol?"https":"http")+"://www.google.com/jsapi"],function(){google.load(s.moduleName,s.version,a)})}}}}),define("views/dashboard/Podio.Views.Dashboard.CalculationWidget",["require","translate","underscore","views/dashboard/Podio.Views.Dashboard.Widget","models/Podio.Models.CalcWidget","lib/view_helpers/appCalculations","lib/view_helpers/charts","lib/view_helpers/base","lib/Podio.Router","lib/Podio.Routes","lib/Podio.Tracking","lib/Podio.Utils","moment","jst!dashboard/_calculation_breakdown_widget","jst!dashboard/_calculation_single_widget","jst!dashboard/_calculation_blank"],function(e){var t=e("translate"),i=e("underscore"),o=e("views/dashboard/Podio.Views.Dashboard.Widget"),n=e("models/Podio.Models.CalcWidget"),s=e("lib/view_helpers/appCalculations"),a=e("lib/view_helpers/charts"),r=(e("lib/view_helpers/base"),e("lib/Podio.Router")),d=e("lib/Podio.Routes"),l=(e("lib/Podio.Tracking"),e("lib/Podio.Utils"),e("moment")),c={calculation_breakdown_widget:e("jst!dashboard/_calculation_breakdown_widget"),calculation_single_widget:e("jst!dashboard/_calculation_single_widget"),calculation_blank:e("jst!dashboard/_calculation_blank")};return o.extend({podioEvents:function(){return i.extend({},this._super(),{"click .actions .print":"onPrintOptionClick","click .actions .copy":"onCloneClicked"})},initialize:function(){this._super(),this.chart=null,this.isFasterDashboardFeatureEnabled=!0,this.calculationWidgetModel=new n(this.model.attributes)},render:function(){var e,o=this,n=!1;if(this.calculationWidgetModel.hasCalculation())n="table"!==this.calculationWidgetModel.get("config").layout,this.isDateGrouping=this.model.get("config").calculation.grouping&&i.include(["date","weekday","week","month","year"],this.model.get("config").calculation.grouping.sub_value),this.elm.html(this.getTemplate(c[this.templateName()],{widget:this.model,calculationWidgetModel:this.calculationWidgetModel,calcHelpers:s,isDateGrouping:this.isDateGrouping,headerUrl:this.model.get("config").app_link+"#/widgets/"+this.model.get("id")+"/filter/",canSaveTo:this.options.canSaveTo,isChart:n,translations:i.extend(this.translations,{count:t("Count #reporting-composer"),sum:t("Sum #reporting-composer"),average:t("Average #reporting-composer"),minimum:t("Minimum #reporting-composer"),maximum:t("Maximum #reporting-composer"),widgetTitle:t("Enter a title #reporting-widget"),units:t("Unit... #reporting-widget")}),isFasterDashboardFeatureEnabled:this.isFasterDashboardFeatureEnabled})),o._hideUnauthorizedActions();else{var a=this.model.get("ref"),r=["#","widgets","new","emp_network"===this.getOption("context")?"emp_network":a.type,a.id].join("/");e=this.model.get("config").app_link+r,this.elm.html(this.getTemplate(c.calculation_blank,{headerUrl:e,appUrl:e,appIcon:this.model.get("config").icon_id,title:this.model.get("title"),canAddWidget:i.include(this.model.get("data").rights,"add_widget"),translations:this.translations,isFasterDashboardFeatureEnabled:this.isFasterDashboardFeatureEnabled}))}return i.defer(function(){if(o._handleOverflow(),o._handleDisplayOptions({cols:o.model.get("cols")}),n){var e=o.elm.closest(".gridster-block").height()-o.elm.find(".header").height()-o.elm.find(".content").height()-o.elm.find(".no-footer").height();o.elmChart=o.elm.find(".widget-chart-target"),o.elmChart.css({height:e}),o.drawChart(o.elmChart.width(),e)}}),this.elm},templateName:function(){return this.calculationWidgetModel.isGrouped()?"calculation_breakdown_widget":"calculation_single_widget"},onPrintOptionClick:function(e,t){var i=r.getGlobalUrl()+d.print_widget_path(this.model.get("id"),{format:"html"});window.open(i,"","height=600,width=480")},onCloneClicked:function(e){var t=e.data("target");("user"===t||this.options.canSaveTo[t])&&this.trigger("widget:onCloneClicked",t,this.calculationWidgetModel)},itemsForRowsCols:function(e,t){if(!this.calculationWidgetModel.hasCalculation())return this._super(e,t);var i=this.calculationWidgetModel.get("config").layout;return"table"===i||"bar"===i?this._super(e,t):"line"===i?14*t-5:void 0},headerFooterRows:function(){return this.calculationWidgetModel.isGrouped()?2:1},dataCount:function(){return this.calculationWidgetModel.isGrouped()?this.model.get("data").count:null},getGroups:function(){return this.isFasterDashboardFeatureEnabled?this.model.get("data").groups:this.model.get("formatted_groups")},drawChart:function(t,i){var o=this;e(["goog!visualization,1,packages:[corechart]"],function(){o.chart&&o.chart.clearChart();var e=o.getGroups();if(e&&e.length){var n=o.model.get("config"),s=n.layout,r=o.calculationWidgetModel.getUnits(),d=a.getConfig(s,t,i);e=a.formatGroups(s,e,n.calculation.grouping.sub_value,r);var l="line"===s&&-1!==["date","month","year"].indexOf(o.model.get("config").calculation.grouping.sub_value),c=new google.visualization.DataTable;l?c.addColumn("date","Label"):c.addColumn("string","Label"),c.addColumn("number","Count"),"bar"===s&&c.addColumn({type:"string",role:"annotation"}),c.addRows(e),"line"===s?o.chart=new google.visualization.LineChart(o.elmChart.get(0)):o.chart=new google.visualization.BarChart(o.elmChart.get(0)),google.visualization.events.addListener(o.chart,"select",o.handleSelection.bind(o)),o.chart.draw(c,d)}})},handleSelection:function(){var e=this.chart.getSelection();if(!e.length)return null;var t=e[0].row,i=this.model.get("config"),o=i.calculation.grouping,n="voting"===o.type,s=(this.isDateGrouping||n)&&"line"===i.layout?this.getGroups().reverse():this.getGroups(),a=s[t],r=o&&"week"===o.sub_value,d=n?"voting_"+o.value:o.value,l=n?a.stars:r?this.handleWeekGrouping(a.value):a.value;window.location.href=i.app_link+"#/widgets/{0}/filter/{1}/{2}".format(this.model.get("id"),d,encodeURIComponent(l))},handleWeekGrouping:function(e){var t=l(e,"YYYY-ww").startOf("week").format("YYYY-MM-DD"),i=l(e,"YYYY-ww").endOf("week").format("YYYY-MM-DD");return t+":"+i}})}),define("controllers/dashboard/Podio.Controllers.Dashboard.CalculationWidgetController",["require","underscore","controllers/dashboard/Podio.Controllers.Dashboard.WidgetController","controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin","lib/Podio.Config","lib/Podio.Routes","models/Podio.Models.Application","models/Podio.Models.Space","models/Podio.Models.Widget","views/dashboard/Podio.Views.Dashboard.CalculationWidget"],function(e){var t=e("underscore"),i=e("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController"),o=e("controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin"),n=e("lib/Podio.Config"),s=e("lib/Podio.Routes"),a=e("models/Podio.Models.Application"),r=e("models/Podio.Models.Space"),d=e("models/Podio.Models.Widget");return i.extend(o).extend({initialize:function(t){this.viewClass=e("views/dashboard/Podio.Views.Dashboard.CalculationWidget"),this.hasBootstrapData("app")&&(this.appModel=new a(this.getBootstrapData("app"))),"emp_network"===t.context?this.hasBootstrapData("Space")&&(this.empNetModel=new r(this.getBootstrapData("Space"))):(this.hasBootstrapData("Space")&&(this.spaceModel=new r(this.getBootstrapData("Space"))),this.hasBootstrapData("emp_network")&&(this.empNetModel=new r(this.getBootstrapData("emp_network")))),this._super(t),this.listenTo(this.eventBus,"widget:onCloneClicked",this.cloneWidget.bind(this),this)},_initViewClass:function(e){var i={app:this.appModel?this.appModel.can("add_widget"):!1,space:this.spaceModel?this.spaceModel.can("add_widget"):!1,emp_network:this.empNetModel?this.empNetModel.can("add_widget"):!1};this.view=new this.viewClass(t.extend({model:this.model,elmContainer:e.elmContainer,eventBus:this.eventBus,dashboardEventBus:this.dashboardEventBus,context:this.context,canSaveTo:i},e.viewOptions||{}))},cloneWidget:function(e,t){t.cloneTo(e).then(function(i){var o="/widgets/{0}".format(i.widget_id),a=this.context;if("home"===a&&(a="user"),e===a){var r=new d(i);r.set("formatted_groups",t.get("formatted_groups")),this.dashboardEventBus.trigger("widget:clone",r)}else switch(i.ref.type){case"app":window.location=s.dashboard_app_with_current_space_path(t.get("url_label"),{
anchor:o,format:"html"});break;case"space":i.ref.id===n.current_employee_network_id?window.location=s.org_root_path(n.orgSlug,{anchor:o,format:"html"}):window.location=s.space_path(n.orgSlug,n.space_url_label,{anchor:o,format:"html"});break;case"user":window.location=s.home_path({format:"html",anchor:o})}}.bind(this))},getCalculation:function(){return this.model.get("config").calculation},limit:function(){var e=this.getCalculation();return e&&e.limit},shouldChangeLimit:function(e,t){var i=this.getCalculation(),o=i&&i.grouping;return o?this._super(e,t):!1},onResizedMoved:function(e){var o,n=t.extend({},e);this.shouldChangeLimit(e.rows,e.cols)&&(o=this.optimalLimit(e.rows,e.cols),this.model.get("config").calculation.limit=o),i.prototype.onResizedMoved.call(this,n)}})}),define("models/Podio.Models.AppState",["require","underscore","lib/backbone/Backbone.PodioModel"],function(e){var t=e("underscore"),i=e("lib/backbone/Backbone.PodioModel");return i.extend({initialize:function(){t.bindAll(this,"buildUrlParams")},buildUrlParams:function(e){var i,o=this.toJSON();return t.extend(o,e),o.offset=t.isNumber(o.offset)&&!t.isNaN(o.offset)?o.offset:this.items.itemsCollection.length,e&&e.viewId?i=e.viewId:this.get("viewModified")||(i=o.viewId),o.offset+(i?"/views/{0}".format(i):"")}})}),define("views/lib/Podio.Views.Mixins.Popover",["require","underscore","lib/Podio.UI.SimpleBalloon"],function(e){var t=e("underscore"),i=e("lib/Podio.UI.SimpleBalloon");return{initBalloon:function(){t.bindAll(this,"onOutsideClick"),this.simpleBallonView=new i({eventBus:this.eventBus,balloonId:this.popOverId,contentClass:this.popOverClass,arrowOffset:this.arrowOffset,arrowPosition:this.arrowPosition,offsets:this.offsets}),this.elmAttachmentTarget=this.options.elmAttachmentTarget,this.elm=this.simpleBallonView.elm,this.setElement(this.simpleBallonView.elm.get(0))},dispose:function(){this.destroy(),this.remove()},renderBalloon:function(e){this.simpleBallonView.content=e,this.simpleBallonView.elmAttachmentTarget=this.elmAttachmentTarget,this.simpleBallonView.render(),this.podioDelegateEvents()},isVisible:function(){return this.simpleBallonView.isVisible()},hide:function(){this.simpleBallonView.fadeOut(),this.elm.unbind("outsideclick.layoutselector")},show:function(){this.simpleBallonView.renderGravity(),this.simpleBallonView.fadeIn(),t.defer(t.bind(function(){this.elm.bind("outsideclick.layoutselector",this.onOutsideClick)},this))},updateAttachmentReference:function(e){this.elmAttachmentTarget=e,this.simpleBallonView.elmAttachmentTarget=this.elmAttachmentTarget},onOutsideClick:function(e,t){this.hide()}}}),define("jst!layouts/_settings_dropdown_item",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<li class="dropdown-label <%= data.className ? data.className : \'\' %> <%= data.isSelected ? \'current\' : \'\' %>" data-id="<%= data.id %>">\n  <div class="image-block">\n\n  <div class="img space-right">\n    <span class="icon-checked icon-16 icon-16-single-green-tick"></span>\n    <% if (data.icon) { %>\n      <span class="icon-16 <%= data.icon %>"></span>\n    <% } %>\n  </div>\n\n  <% if (data.actionIcon || data.actionButton) { %>\n    <div class="img-ext actions">\n      <% if (data.actionButton) { %>\n        <div class="icon-16 <%= data.actionButton %> action-button tooltip" title="<%= data.actionButtonTooltip %>"></div>\n      <% } %>\n      <% if (data.actionIcon) { %>\n        <span class="icon-16 <%= data.actionIcon %> action-icon"></span>\n      <% } %>\n    </div>\n  <% } %>\n\n  <div class="bd">\n    <% if (data.url) { %>\n      <a href="<%=data.url%>">\n    <% } %>\n\n    <% if (data.rawText) { %>\n      <%- data.rawText %>\n    <% } else { %>\n      <%= data.text %>\n    <% }  %>\n\n    <% if (data.contextIcon) { %>\n     <span class="icon-16 <%= data.contextIcon %>"></span>\n    <% } %>\n\n    <% if (data.infoText) { %>\n      <span class="info-text"><%= data.infoText %></span>\n    <% } %>\n\n    <% if (data.url) { %>\n      </a>\n    <% } %>\n\n  </div>\n\n\n  </div>\n</li>\n')}),define("jst!apps/_app_view_selector",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="app-view-selector-wrapper">\n\n  <div class="views">\n    <%- viewsContent %>\n  </div>\n\n</div>\n')}),define("jst!apps/_app_view_selector_views",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('  <ul class="app-settings-dropdown-list views-list">\n    <%- defaultListContent %>\n  </ul>\n\n  <div class="seperator"></div>\n\n  <% if(myListContent) { %>\n    <h4><%= t(\'My saved views #appviews\') %></h4>\n    <ul class="app-settings-dropdown-list views-list">\n      <%- myListContent %>\n    </ul>\n  <% } %>\n\n  <% if(othersListContent) { %>\n    <h4><%= t(\'Others saved views #appviews\') %></h4>\n    <ul class="app-settings-dropdown-list views-list">\n      <%- othersListContent %>\n    </ul>\n  <% } %>\n')}),define("jst!apps/_app_view_selector_blank_slate",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template("<div class=\"blank-slate\">\n  <h4><%= t('My saved views #appviews') %></h4>\n  <p><%= t('You can save the exact way you are currently view this app to use later, or to share with others #appviews') %></p>\n  <a href=\"#\" class=\"save-view-button\"><%=t('Save current view #appviews')%></a>\n</div>\n")}),define("views/apps/Podio.Views.AppsViewSelector",["require","translate","underscore","jquery","lib/backbone/Backbone.PodioView","views/lib/Podio.Views.Mixins.Popover","lib/Podio.Config","lib/view_helpers/base","jst!layouts/_settings_dropdown_item","jst!apps/_app_view_selector","jst!apps/_app_view_selector_views","jst!apps/_app_view_selector_blank_slate"],function(e){var t=e("translate"),i=e("underscore"),o=e("jquery"),n=e("lib/backbone/Backbone.PodioView"),s=e("views/lib/Podio.Views.Mixins.Popover"),a=e("lib/Podio.Config"),r=e("lib/view_helpers/base"),d=e("jst!layouts/_settings_dropdown_item"),l=e("jst!apps/_app_view_selector"),c=e("jst!apps/_app_view_selector_views"),h=e("jst!apps/_app_view_selector_blank_slate"),u=n.extend({podioEvents:{"click .views-list > li":"onOptionItemClicked","click .save-view-button":"onBlankSlateSaveClicked"},initialize:function(e){i.bindAll(this,"render","onOptionItemClicked"),i.defaults(e,{arrowPosition:"left",arrowOffset:25,popOverId:"viewSelectorPopover",popOverClass:"app-view-selector"}),this.app=e.app,this.viewsCollection=this.options.viewsCollection,this.appState=this.options.appState,this.layoutIconMap=this.options.layoutIconMap,this.offsets=this.options.offsets,this.popOverId=this.options.popOverId,this.popOverClass=this.options.popOverClass,this.arrowPosition=this.options.arrowPosition,this.arrowOffset=this.options.arrowOffset,this.initBalloon(),this._super()},render:function(){return this.viewsCollection.nonStandardViewsCount()?this._renderViews():this._renderBlankSlate(),this.viewsCollection.isEmpty()&&!this.viewsCollection.hasFetchedData&&this._renderLoader(),this},_translations:function(){return i.extend({blankslate_header:t("My saved views #appviews"),blankslate_copy:t("You can save the exact way you are currently view this app to use later, or to share with others #appviews"),blankslate_link_text:t("Save current view #appviews")},this.options.translations)},_getStandardViewMarkup:function(){var e=o("<div />"),t=this.viewsCollection.getAllStandard();return this._renderViewItems(t,{elmList:e,shouldShowAuthor:!1}),e.html()},_getMyViewsMarkup:function(){var e=o("<div />"),t=a.user.user_id,i=this.viewsCollection.getAllByUser(t);return this._renderViewItems(i,{elmList:e,shouldShowAuthor:!1}),e.html()},_renderBaseLayout:function(e){var t;this.appState.get("viewId")&&(t=this.viewsCollection.get(this.appState.get("viewId")));var i=this.getTemplate(l,{app:this.app,viewsContent:e,canUpdateCurrentView:t?t.can("update"):!1});this.renderBalloon(i),this.elmViewsSelector=this.elm.find(".app-view-selector-wrapper"),this._hideLoader(),this.elm.removeClass("empty"),this.elm.removeClass("loading")},_renderViews:function(){var e=this.getTemplate(c,{defaultListContent:this._getStandardViewMarkup(),myListContent:this._getMyViewsMarkup(),othersListContent:this._renderOthersViews()});this._renderBaseLayout(e)},_renderBlankSlate:function(){var e=r.content_tag("ul",{"class":"app-settings-dropdown-list views-list",html:this._getStandardViewMarkup()});e+=this.options.blankslateContent?this.options.blankslateContent():this.getTemplate(h),this._renderBaseLayout(e),this.elm.addClass("empty")},_renderLoader:function(){this.elm.addClass("loading"),this.elmViewsSelector.addClass("loading-overlay-big"),this.trigger("viewSelector:renderedLoading")},_hideLoader:function(){this.elm.removeClass("loading"),this.elmViewsSelector.removeClass("loading-overlay-big")},_renderOthersViews:function(){var e=o("<div />"),t=a.user.user_id,i=this.viewsCollection.getAllExceptUser(t);return this._renderViewItems(i,{elmList:e,shouldShowAuthor:!0}),e.html()},_renderViewItems:function(e,i){var o=i.elmList,n=i.shouldShowAuthor;e.each(function(e){var i,s=this.appState.get("viewId")===e.id,a=e.get("layout")||"badge";this.options.skipItemLinks||(i="#"+this.appState.buildUrlParams({offset:0,viewId:e.id})),o.append(this.getTemplate(d,{data:{id:e.get("id"),value:e.get("id"),rawText:'{0} <span class="count">({1})</span>'.format(e.get("name").htmlEncode(),e.get("items")),infoText:n?t("saved by {0}").format(e.get("created_by").get("name")):"",url:i,isSelected:s,icon:this.layoutIconMap[a],contextIcon:e.isPrivate()?"icon-tiny-lock-closed":""}}))},this)},onOptionItemClicked:function(e,t){var i=e.data("id");this.options.router&&this.options.router.navigate(e.find("a").attr("href")),this.trigger("viewSelector:viewChanged",i)},onBlankSlateSaveClicked:function(e,t){this.hide(),this.trigger("viewSelector:blankSlateSave")}});return i.extend(u.prototype,s),u}),define("models/Podio.Models.AppView",["require","lib/backbone/Backbone.PodioModel","lib/Podio.Routes","lib/Podio.Config","lib/Podio.Time","moment","underscore","lib/backbone/FiltersFormattingMixin","models/Podio.Models.User"],function(e){var t=e("lib/backbone/Backbone.PodioModel"),i=e("lib/Podio.Routes"),o=e("lib/Podio.Config"),n=e("lib/Podio.Time"),s=e("moment"),a=e("underscore"),r=e("lib/backbone/FiltersFormattingMixin"),d=t.extend({has_one:function(){return{created_by:e("models/Podio.Models.User")}},initialize:function(e,t){a.bindAll(this,"canDelete"),t&&(this.saveLastUrl=t.saveLastUrl,this.urlRoot=t.saveUrl,this.appId=t.appId)},isCreatedBy:function(e){return this.get("created_by").get("user_id")===e},isPrivate:function(){return"private"===this.get("type")},canDelete:function(){return this.collection.viewDeleteRight||o.user.user_id===this.get("created_by").get("user_id")},changePrivacy:function(e){var t="/view/{0}/privacy".format(this.get("view_id"));return this.set("private",e,{silent:!0}),this.request("put",t,{"private":e})},makePublic:function(){return this.changePrivacy(!1)},makePrivate:function(){return this.changePrivacy(!0)},save:function(){var e="/view/app/{0}".format(this.appId);return this.request("post",e,this.toJSON()).done(function(e){this.set(e)}.bind(this))},destroy:function(){var e="/view/{0}".format(this.get("view_id"));return this.useDirectAPIAccess?this.request("delete",e).done(function(){this.trigger("destroy",this,this.collection)}.bind(this)):this._super()},saveLast:function(){var e="/view/app/{0}/last".format(this.appId);return this.useDirectAPIAccess?this.request("put",e,this.toJSON()):void this.request("post",this.saveLastUrl,this.toJSON())},apiFriendlyDateString:function(e){return n.apiFriendlyDateString(e)},calculateWeeklyBreakdownDateRange:function(e){var t=s(e,"gggg-ww"),i=this.apiFriendlyDateString(t.weekday(0)),o=this.apiFriendlyDateString(t.weekday(6));return i+":"+o},formatDateBreakdownFragment:function(e){var t;switch(this.get("grouping").sub_value){case"date":t=e+":"+e;break;case"weekday":t=null;break;case"week":t=this.calculateWeeklyBreakdownDateRange(e);break;case"month":case"year":t=e}return t},findFilterValueByFragment:function(e){var t=a.find(this.get("groupings").groups,function(t){return this.formatDateBreakdownFragment(t.value)===e}.bind(this));return a.isDefined(t)?t.value:void 0},updateView:function(){var e;return this.useDirectAPIAccess?(e="/view/{0}".format(this.get("view_id")),this.request("put",e,this.toJSON())):(e=i.update_app_view_path(this.id),this.request("put",e,this))},fetchView:function(){var e="/view/app/{0}/{1}".format(this.appId,this.get("view_id"));return this.request("get",e).done(function(e){this.set(e)}.bind(this))}});return a.extend(d.prototype,r),d}),define("collections/Podio.Collections.AppViews",["require","underscore","lib/backbone/Backbone.PodioCollection","lib/Podio.Routes","models/Podio.Models.AppView"],function(e){var t=e("underscore"),i=e("lib/backbone/Backbone.PodioCollection"),o=e("lib/Podio.Routes");return i.extend({urlRails:o.app_views_path({format:""}),urlAPI:function(){return"/view/app/{0}/".format(this.appId)},configure:function(){this.model=e("models/Podio.Models.AppView")},initialize:function(e,t){this.hasFetchedData=!1,this.userId=t.userId,this.appId=t.appId,this.viewDeleteRight=t.viewDeleteRight},nonStandardViewsCount:function(){return this.getAllNonStandard().value().length},getViews:function(e,i){var o={silent:i,data:{include_standard_views:e||!1}};return this.useDirectAPIAccess||t.extend(o,{reset:!0,data:{app_id:this.appId}}),this.fetchViewListStatus=this.fetch(o),this.hasFetchedData=!0,this.fetchViewListStatus},updateViewOrder:function(e){var t="/view/{0}/order".format(this.appId);return this.request("put",t,e)},getAllNonStandard:function(){return t(this.reject(function(e){return"standard"===e.get("type")}))},getAllStandard:function(){return t(this.where({type:"standard"}))},getAllPrivate:function(){return t(this.where({type:"private"}))},getAllPublic:function(){return t(this.where({type:"saved"}))},getAllByUser:function(e){return e||(e=this.userId),t(this.filter(function(t){return t.get("created_by").get("user_id")===e&&"standard"!==t.get("type")}))},getAllExceptUser:function(e){return e||(e=this.userId),t(this.reject(function(t){return t.get("created_by").get("user_id")===e}))}})}),define("controllers/apps/ItemNavigationDelegate",["require","jquery","underscore"],function(e){function t(e,t,i){this.collection=e,this.currentIndex=t,this.getNextPageCallback=i&&i.getNextPageCallback}var i=e("jquery"),o=e("underscore");return t.prototype={updateIndex:function(e){var t=this.collection.findWhere({item_id:e});this.currentIndex=this.collection.indexOf(t)},resetIndex:function(){delete this.currentIndex},getItemByIndex:function(e){return this.collection.at(e)},loadItemByIndex:function(){var e=this.getItemByIndex(this.currentIndex),t=new i.Deferred;return o.isDefined(e)?t.resolve(e):this.getNextPageCallback?(this.collection.once("add",function(){t.resolve(this.getItemByIndex(this.currentIndex))}.bind(this)),this.getNextPageCallback(),t):t.reject()},loadNext:function(){if(o.isUndefined(this.currentIndex))throw new Error("Invocation with no index set");return this.currentIndex++,this.loadItemByIndex()},loadPrev:function(){if(o.isUndefined(this.currentIndex))throw new Error("Invocation with no index set");return this.currentIndex--,this.loadItemByIndex()},hasNext:function(){return o.isUndefined(this.currentIndex)?!1:this.getNextPageCallback?!this.collection.endReached||this.currentIndex+1<this.collection.length:this.currentIndex+1<this.collection.length},hasPrev:function(){return o.isUndefined(this.currentIndex)&&this.getNextPageCallback?!1:this.currentIndex>0},isNextItemAvailable:function(){return o.isDefined(this.getItemByIndex(this.currentIndex+1))}},t}),define("jst!dashboard/app_view_widget/_app_view_selector_blank_slate",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="blank-slate">\n  <h4><%= translations.blankslate_header %></h4>\n  <p><%= translations.blankslate_copy %></p>\n  <a href="<%= blankslate_url %>" ><%= translations.blankslate_link_text%></a>\n</div>\n')}),define("views/dashboard/Podio.Views.Dashboard.AppViewWidget",["require","translate","underscore","views/dashboard/Podio.Views.Dashboard.Widget","views/apps/Podio.Views.AppsViewSelector","collections/Podio.Collections.AppViews","lib/Podio.Router.Content","lib/Podio.Config","models/Podio.Models.Item","lib/backbone/Backbone.PodioCollection","controllers/apps/ItemNavigationDelegate","jst!dashboard/app_view_widget/_app_view_selector_blank_slate"],function(e){var t=e("translate"),i=e("underscore"),o=e("views/dashboard/Podio.Views.Dashboard.Widget"),n=e("views/apps/Podio.Views.AppsViewSelector"),s=e("collections/Podio.Collections.AppViews"),a=e("lib/Podio.Router.Content"),r=e("lib/Podio.Config"),d=e("models/Podio.Models.Item"),l=e("lib/backbone/Backbone.PodioCollection"),c=e("controllers/apps/ItemNavigationDelegate"),h=e("jst!dashboard/app_view_widget/_app_view_selector_blank_slate");return o.extend({podioEvents:function(){return i.extend({},this._super(),{"click .actions .options":"onOptionsClicked","click .content .inner a":"onItemClicked"})},initialize:function(){i.bindAll(this,"_blankslateContent"),this._super(),i.extend(this.translations,{blankslate_message:t("No items to show #dashboard"),create_item:t("Create {0} #dashboard")}),this.viewsCollection=new s(null,{userId:r.user.user_id,appId:this.model.get("data").app.app_id}),this._bindEvents()},renderOptions:function(){return this.items=i.map(this.model.get("data").app_view.items,function(e){return new d(e)}),i.extend(this._super(),{items:this.items,app:this.getApp(),canCreateItem:this.canCreateItem()})},onOptionsClicked:function(e,t){var i=this;this.optionsView.isVisible()?this.optionsView.hide():(this._fetchViews(),this.optionsView.show(),this.elm.one("outsideclick",function(){i.elm.toggleClass("hovering",!1)}))},getNavigationDelegate:function(e,t){return i.isDefined(this.navigationDelegate)&&delete this.navigationDelegate,this.navigationDelegate=new c(e,t),this.navigationDelegate},onItemClicked:function(e,t){var o,n=e.data("id");o=i.findIndex(this.items,function(e){return e.get("app_item_id")===n}),a.navigate(e.attr("href"),{renderType:"overlay",itemNavigationDelegate:this.getNavigationDelegate(new l(this.items),o)})},onViewChanged:function(e){this.optionsView.hide()},render:function(){this._super(),this.optionsView||(this.optionsView=this._createOptionsView()),this.optionsView.elmAttachmentTarget=this.elm.find(".actions .options"),this.optionsView.render()},_createOptionsView:function(){var e=this.model.get("widget_id"),t="app-view-selector app-view-widget-{0}".format(e);return new n({app:this.model.get("data").app,viewsCollection:this.viewsCollection,appState:this.options.appState,eventBus:this.eventBus,layoutIconMap:{},arrowPosition:"right",skipItemLinks:!0,blankslateContent:this._blankslateContent,popOverClass:t})},_blankslateContent:function(){return this.getTemplate(h,{blankslate_url:this.model.get("data").app.url,translations:{blankslate_header:t("My saved views #appviews #dashboard"),blankslate_copy:t("You can filter this app and save views based on your own filters by going to the app. #appviews"),blankslate_link_text:t("Create view #appviews")}})},_fetchViews:function(){this.viewsCollection.getViews().then(this.optionsView.render)},_bindEvents:function(){this.listenTo(this.eventBus,"viewSelector:viewChanged",this.onViewChanged)},getApp:function(){return this.model.get("data").app},canCreateItem:function(){return i.include(this.getApp().rights,"add_item")},headerFooterRows:function(){return this.canCreateItem()?3:2},onMouseLeave:function(){this.optionsView&&this.optionsView.isVisible()||this._super()},dataCount:function(){return this.model.get("data").app_view.filtered}})}),define("controllers/dashboard/Podio.Controllers.Dashboard.AppViewWidgetController",["require","underscore","controllers/dashboard/Podio.Controllers.Dashboard.WidgetController","controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin","models/Podio.Models.AppState","views/dashboard/Podio.Views.Dashboard.AppViewWidget"],function(e){var t=e("underscore"),i=e("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController"),o=e("controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin"),n=e("models/Podio.Models.AppState");return i.extend(o).extend({initialize:function(i){this.viewClass=e("views/dashboard/Podio.Views.Dashboard.AppViewWidget"),this.appState=new n({viewId:this.model.get("config").view_id}),this._super(t.extend(i||{},{viewOptions:{appState:this.appState}}))},onViewChanged:function(e){var i=t.extend({},this.model.get("config"),{view_id:e});this.appState.set({viewId:e}),this.trigger("configChange",{config:i})},_bindEvents:function(){this._super(),this.listenTo(this.eventBus,"viewSelector:viewChanged",this.onViewChanged)}})}),define("jst!dashboard/create_widget/_start",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="tab-start">\n  <div class="core">\n    <ul class="list">\n      <% _.each(coreWidgetsData, function(item) { %>\n        <%-render(listItemTemplate, item)%>\n      <% }); %>\n    </ul>\n  </div>\n\n  <div class="favourite-apps">\n    <fieldset>\n      <legend><%=t(\'Favourite apps #dashboard\')%></legend>\n    </fieldset>\n    <ul class="apps-list list">\n      <li><%-render(loaderTemplate)%></li>\n    </ul>\n  </div>\n</div>')}),define("jst!dashboard/create_widget/_core",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="tab-core">\n  <ul class="list">\n    <% _.each(coreWidgetsData, function(item) { %>\n      <%-render(listItemTemplate, item)%>\n    <% }); %>\n  </ul>\n</div>')}),define("jst!dashboard/create_widget/_apps",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="tab-<%=tabName%>">\n  <div class="search">\n    <span class="icon-16 icon-magnifier"></span>\n    <input type="text" placeholder="<%=translations.placeholder%>"/>\n  </div>\n  <div class="apps-container">\n\n  </div>\n</div>')}),define("jst!shared/_generic_list_item",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<li class="list-item" <%-typeof id !== \'undefined\' ? \'data-id="\' + id + \'"\' : \'\'%>>\n  <div class="image-block">\n    <div class="img">\n      <div class="icon-wrapper">\n        <div class="<%=icon%>"></div>\n      </div>\n    </div>\n    <div class="bd">\n      <h4><%=title%></h4>\n      <%=description%>\n    </div>\n  </div>\n</li>')}),define("jst!dashboard/create_widget/_blank_slate",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="is-blank-slate">\n  <p>\n    <% if (initial) { %>\n      <%= t("You don\'t have any apps to select from #dashboard") %>\n    <% } else { %>\n      <%= t(\'We could not find apps matching your search #dashboard\') %>\n    <% } %>\n  </p>\n</div>\n')}),define("jst!dashboard/create_widget/_top_apps",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template("<% _.each(data, function(item) { %>\n  <%-render(listItemTemplate, { icon: 'app-icon-24 icon-' + (item.icon_id || 251), title: item.config.name, description: item.space.name, id: item.id })%>\n<% }); %>")}),define("views/dashboard/Podio.Views.Dashboard.AddWidgetModal",["require","translate","underscore","jquery","lib/jquery/jquery.podioCheckList","views/lib/Podio.Views.SideTabsLayout","root/dashboard/Podio.Dashboard.WidgetFactory","lib/Podio.UI.Modal","lib/Podio.UI.Tooltips","lib/Podio.Event.UI","lib/Podio.Tracking","lib/Podio.Utils","jst!dashboard/create_widget/_start","jst!dashboard/create_widget/_core","jst!dashboard/create_widget/_apps","jst!shared/_generic_list_item","jst!dashboard/create_widget/_blank_slate","jst!dashboard/create_widget/_top_apps","jst!shared/generic_loader_small"],function(e){var t=e("translate"),i=e("underscore"),o=e("jquery");e("lib/jquery/jquery.podioCheckList");var n=e("views/lib/Podio.Views.SideTabsLayout"),s=e("root/dashboard/Podio.Dashboard.WidgetFactory"),a=e("lib/Podio.UI.Modal"),r=e("lib/Podio.UI.Tooltips"),d=e("lib/Podio.Event.UI"),l=(e("lib/Podio.Tracking"),e("lib/Podio.Utils")),c=e("jst!dashboard/create_widget/_start"),h=e("jst!dashboard/create_widget/_core"),u=e("jst!dashboard/create_widget/_apps"),p=e("jst!shared/_generic_list_item"),g=e("jst!dashboard/create_widget/_blank_slate"),f=e("jst!dashboard/create_widget/_top_apps"),m=e("jst!shared/generic_loader_small"),_=i.clone(n.prototype.podioEvents);return n.extend({START_TOP_APPS_NUMBER:3,START_CORE_WIDGETS_NUMBER:3,MODAL_WIDTH:500,MODAL_HEIGHT:465,MODAL_HOR_OFFSET:20,podioEvents:i.extend(_,{"click .tab-core .list li":"onNewCoreWidgetClicked","click .tab-start .core .list li":"onNewCoreWidgetClicked","click .favourite-apps .list li":"onNewFavAppClicked"}),initialize:function(e){i.bindAll(this,"onModalClosed","_renderTopApps","_onAppDataReady","onAppSelected","_onTopBarClick"),this.navigationOptions=e.navigationOptions,this.navigationSelectedItem=e.navigationSelectedItem,this.modalClass=e.modalClass,this.topAppsCollection=e.topAppsCollection,this.context=e.context,this.contextName=e.contextName},_getCoreWidgetsData:function(e){var o,n;return"home"===this.context?(o=[{id:"tasks",icon:"app-icon-24 icon-51",title:s.getDefaultTitle("tasks",this.context),description:t("Shows all my upcoming tasks. #dashboard")},{id:"events",icon:"app-icon-24 icon-45",title:s.getDefaultTitle("events",this.context),description:t("Shows all events and meetings. #dashboard")},{id:"profiles",icon:"app-icon-24 icon-30",title:s.getDefaultTitle("profiles",this.context),description:t("Shows all my Podio contacts #dashboard")},{id:"apps",icon:"icon-24 icon-24-gear",title:s.getDefaultTitle("apps",this.context),description:t("Shows my Podio apps sorted by use #dashboard")},{id:"text",icon:"icon-24 icon-24-text-input",title:s.getDefaultTitle("text",this.context),description:t("Add a note to my home #dashboard")},{id:"image",icon:"icon-24 icon-24-image",title:s.getDefaultTitle("image",this.context),description:t("Add an image to my home #dashboard")},{id:"link",icon:"icon-24 icon-24-chain",title:s.getDefaultTitle("link",this.context),description:t("Add a list of relevant links to my home #dashboard")}],o.push({id:"recent_items",icon:"app-icon-24 icon-19",title:s.getDefaultTitle("recent_items",this.context),description:t("Shows the recent item history #dashboard")})):i.include(["space","emp_network"],this.context)?(n=this.contextName.ellipsis(25),o=[{id:"tasks",icon:"app-icon-24 icon-51",title:s.getDefaultTitle("tasks",this.context),description:t("Shows all upcoming tasks in {0}. #dashboard").format(n)},{id:"files",icon:"icon-24 icon-24-documents",title:s.getDefaultTitle("files",this.context),description:t("Shows all files in {0} #dashboard").format(n)},{id:"text",icon:"icon-24 icon-24-text-input",title:s.getDefaultTitle("text",this.context),description:t("Add a message or instructions to the workspace #dashboard")},{id:"image",icon:"icon-24 icon-24-image",title:s.getDefaultTitle("image",this.context),description:t("Add an image to the workspace #dashboard")},{id:"link",icon:"icon-24 icon-24-chain",title:s.getDefaultTitle("link",this.context),description:t("Add a list of relevant links #dashboard")}],"space"===this.context&&(o.splice(1,0,{id:"events",icon:"app-icon-24 icon-45",title:s.getDefaultTitle("events",this.context),description:t("Shows all events and meetings in {0}. #dashboard").format(n)}),l.showFeature("workspace_contacts_migration")?this.options.showWorkspaceContacts&&o.splice(3,0,{id:"contacts",icon:"app-icon-24 icon-30",title:s.getDefaultTitle("contacts",this.context),description:t("Shows all workspace contacts in {0} #dashboard").format(n)}):o.splice(3,0,{id:"contacts",icon:"app-icon-24 icon-30",title:s.getDefaultTitle("contacts",this.context),description:t("Shows all workspace contacts in {0} #dashboard").format(n)}))):"app"===this.context&&(o=[{id:"text",icon:"icon-24 icon-24-text-input",title:s.getDefaultTitle("text",this.context),description:t("Add a message or instructions to the app #new_app_reporting")},{id:"image",icon:"icon-24 icon-24-image",title:s.getDefaultTitle("image",this.context),description:t("Add an image to the app #new_app_reporting")},{id:"link",icon:"icon-24 icon-24-chain",title:s.getDefaultTitle("link",this.context),description:t("Add a list of relevant links to my home #dashboard")},{id:"tasks",icon:"app-icon-24 icon-51",title:s.getDefaultTitle("tasks",this.context),description:t("Shows all upcoming tasks in this app. #new_app_reporting")},{id:"calculation",icon:"icon-24 icon-24-skyline",title:s.getDefaultTitle("reports",this.context),description:t("Add a report #new_app_reporting")}]),e&&e<o.length?i.first(o,e):o},_renderTopApps:function(e){var t=this.topAppsCollection.toJSON(),o=this.elmContent.find(".favourite-apps .apps-list");return i.isEmpty(t)?(this.elmContent.find(".favourite-apps").addClass("hidden"),!1):(e&&e<t.length&&(t=i.first(t,e)),i.each(t,function(e){e.icon_id=e.config.icon_id}),void o.html(this.getTemplate(f,{data:t,listItemTemplate:p})))},_onAppDataReady:function(e,t){var o;this.elmContent.html(this.getTemplate(u,{tabName:e.tabName,translations:{placeholder:e.placeholder}})),o=this.elmContent.find(".search input");var n=i.extend(e.checkListOptions||{},{data:t,searchEnabled:!0,searchInstantSearchCallback:!0,idKey:"id",preselectAll:!1,templates:{list:i.template('<ul class="apps-check-list list"><%-content%></ul>'),empty:g.curry({initial:!1}),emptyInitial:g.curry({initial:!0}),item:function(e){return p(i.extend(e,{title:e.data.name,description:e.data.space_name,icon:"app-icon-24 icon-"+e.data.icon_id,id:e.data.id,isChecklistItem:!0}))}},classes:{resultContainer:".apps-container",nonCheckable:"list-item"},callbacks:{onNonCheckableClick:this.onAppSelected.curry(e,o)}});o.podioChecklist(n),o.focus()},_renderGenericApp:function(e){this.elmContent.html(this.getTemplate(m)),e.checkListOptions.searchFunc().done(this._onAppDataReady.curry(e))},_calculateModalPosition:function(e){var t,i=document.height-e.positionTop;return i<this.MODAL_HEIGHT?(t=window.innerHeight-this.MODAL_HEIGHT,e.positionTop-t>this.MODAL_HEIGHT/4?e.className+=" bottom-aligned-arrow":e.className+=" top-aligned-arrow",delete e.positionTop,e.positionBottom=20):e.className+=" top-aligned-arrow",e.elmContainer.parents(".app-dashboard-overlay").length&&1===e.elmContainer.data("col")?e.className+=" right-aligned":e.className+=" left-aligned",e},_onTopBarClick:function(e,t){a.hide(),d.unbind("click","#header-global",this._onTopBarClick)},_enableClickingOnTopBar:function(){d.bind("click","#header-global",this._onTopBarClick,!0)},onNewCoreWidgetClicked:function(e,t){var i=e.data("id");this._getCoreWidgetsData();e.parents(".tab-start").find(".list li").removeClass("selected"),e.addClass("selected").siblings().removeClass("selected"),this.trigger("addWidgetModalView:newWidgetTriggered",i,{})},onNewFavAppClicked:function(e,t){var i=e.data("id");e.parents(".tab-start").find(".list li").removeClass("selected"),e.addClass("selected"),this.trigger("addWidgetModalView:newWidgetTriggered","app_view",{appId:i})},onAppSelected:function(e,t,o,n){var s,a,r=n.data("id");n.addClass("selected").siblings().removeClass("selected"),"reporting"===e.tabName?(s=t.podioChecklist("getData"),a=i.find(s,function(e){return e.id===r}),this.trigger("addWidgetModalView:newWidgetTriggered","calculation",{appUrl:a.link,iconId:a.icon_id,rights:a.rights})):this.trigger("addWidgetModalView:newWidgetTriggered","app_view",{appId:r})},renderModal:function(e){var t;t=i.extend(e||{},{className:this.options.className,modalClass:this.modalClass,
width:this.MODAL_WIDTH,height:this.MODAL_HEIGHT,autoHeight:!1,doNotScrollToTop:!0,overlay:!1}),t=this._calculateModalPosition(t),a.show("",t),a.signals.onModalHidden.addOnce(this.onModalClosed),this._enableClickingOnTopBar(),this.elm=o("."+this.options.className),this.el=this.elm.get(0),this.podioDelegateEvents(),this.elmMain=this.elm.find(".modal-content"),this.initTabsLayout(),this.elmContent=this.elmMain.find(".content")},closeModal:function(){r.hideAll(),a.hide()},onModalClosed:function(){this.trigger("addWidgetModalView:modalClosed")},renderStart:function(){this.elmContent.html(this.getTemplate(c,{loaderTemplate:m,listItemTemplate:p,coreWidgetsData:this._getCoreWidgetsData(this.START_CORE_WIDGETS_NUMBER)})),this.topAppsCollection.promise.done(this._renderTopApps.curry(this.START_TOP_APPS_NUMBER))},renderCore:function(){this.elmContent.html(this.getTemplate(h,{loaderTemplate:m,listItemTemplate:p,coreWidgetsData:this._getCoreWidgetsData()}))},renderApp:function(e){this._renderGenericApp({tabName:"apps",placeholder:t("Pick an app to create an app view title #dashboard"),checkListOptions:{searchFunc:e}})},renderReporting:function(e){this._renderGenericApp({tabName:"reporting",placeholder:t("Pick an app to create a reporting title #dashboard"),checkListOptions:{searchFunc:e}})}})}),define("controllers/dashboard/Podio.Controllers.Dashboard.AddWidgetModalController",["require","underscore","translate","lib/backbone/Backbone.PodioController","views/dashboard/Podio.Views.Dashboard.AddWidgetModal","lib/backbone/Backbone.Mixins.StateMachine","lib/backbone/Backbone.PodioCollection","lib/Podio.Transport.Picker","lib/Podio.Config","lib/Podio.Routes","lib/Podio.Utils","lib/Podio.Utils","lib/Podio.Bootstrap"],function(e){var t=e("underscore"),i=e("translate"),o=e("lib/backbone/Backbone.PodioController"),n=e("views/dashboard/Podio.Views.Dashboard.AddWidgetModal"),s=e("lib/backbone/Backbone.Mixins.StateMachine"),a=e("lib/backbone/Backbone.PodioCollection"),r=e("lib/Podio.Transport.Picker"),d=e("lib/Podio.Config"),l=e("lib/Podio.Routes"),c=(e("lib/Podio.Utils"),o.extend({TOP_APPS_LIMIT:6,states:["start","core","app","reporting"],enterState:{start:"enterStart",core:"enterCore",app:"enterApp",reporting:"enterReporting"},leaveState:{},initialize:function(e){t.bindAll(this,"_searchApps"),this.context=e.context,this.topAppsCollection=new a,this.topAppsCollection.url=l.json_top_apps_path(),this.modalView=new n(this.getViewConfig()),this._bindEvents(),this._super()},_bindEvents:function(){this.listenTo(this.eventBus,"sideTabsLayout:navItemSelected",this.onTabSelected)},getViewConfig:function(){var o={topAppsCollection:this.topAppsCollection,eventBus:this.eventBus,context:this.context,className:"add-dashboard-widget-modal",modalClass:"add-dashboard-widget-modal-wrapper",navigationOptions:[{id:"core",label:i("Core Tiles #dashboard"),className:"tab-core"},{id:"app",label:i("App Tiles #dashboard"),className:"tab-app"},{id:"reporting",label:i("Reports & Charts #report_charts"),className:"tab-reporting"}]};return"home"===this.context?(o.navigationSelectedItem="start",o.navigationOptions.unshift({id:"start",label:i("Get started #dashboard"),className:"tab-get-started"})):t.include(["space","emp_network"],this.context)?(o.navigationSelectedItem="core",o.contextName=d.space_name,o.navigationOptions[0].label=i("Overviews #dashboard"),o.showWorkspaceContacts=e("lib/Podio.Utils").showWorkspaceContacts(e("lib/Podio.Bootstrap").getBootstrapData("Space"))):"app"===this.context&&(o.navigationSelectedItem="core",o.navigationOptions[0].label=i("App widets #new_app_reporting"),o.navigationOptions.splice(1)),o},_searchApps:function(e,i){var o={target:"apps"};return t.isEmpty(e)&&(o.limit=this.TOP_APPS_LIMIT),"space"===this.context?(o.filterKey="space_ids",o.filterVal=[d.space_id]):"emp_network"===this.context&&(o.filterKey="org_id",o.filterVal=[d.org_id]),r.getReferenceData(e||"",o,function(e){t.isFunction(i)&&i(t.isEmpty(e)?e:e[0].items)}).pipe(function(e){return t.isEmpty(e)?e:e[0].items})},onTabSelected:function(e){this.toState(e)},launch:function(e){this.modalView.renderModal(e),"home"===this.context?this.toState("start"):t.include(["space","emp_network","app"],this.context)&&this.toState("core")},closeModal:function(){this.modalView.closeModal()},enterStart:function(){this.topAppsCollection.isEmpty()&&(this.topAppsCollection.promise=this.topAppsCollection.fetch({reset:!0,data:{limit:5}})),this.modalView.renderStart()},enterCore:function(){this.modalView.renderCore()},enterApp:function(){this.modalView.renderApp(this._searchApps)},enterReporting:function(){this.modalView.renderReporting(this._searchApps)}}));return t.extend(c.prototype,s),c}),define("views/dashboard/Podio.Views.Dashboard.AddWidget",["require","views/dashboard/Podio.Views.Dashboard.Widget","lib/Podio.Tracking"],function(e){var t=e("views/dashboard/Podio.Views.Dashboard.Widget");e("lib/Podio.Tracking");return t.extend({podioEvents:{"click .add-widget-wrapper":"onAddWidgetClick"},x:function(){return this.model.getX()},y:function(){return this.model.getY()},onAddWidgetClick:function(e,t){t.stopPropagation(),this.trigger("addWidget:addWidgetClick")},draggable:function(){return!1},resizable:function(){return!1},minRows:function(){return 3}})}),define("controllers/dashboard/Podio.Controllers.Dashboard.AddWidgetController",["require","controllers/dashboard/Podio.Controllers.Dashboard.WidgetController","controllers/dashboard/Podio.Controllers.Dashboard.AddWidgetModalController","views/dashboard/Podio.Views.Dashboard.AddWidget"],function(e){var t=e("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController"),i=e("controllers/dashboard/Podio.Controllers.Dashboard.AddWidgetModalController");return t.extend({initialize:function(t){this.viewClass=e("views/dashboard/Podio.Views.Dashboard.AddWidget"),this._super(t)},_bindEvents:function(){this._super(),this.listenTo(this.eventBus,"addWidget:addWidgetClick",this.onWidgetCreateClick),this.listenTo(this.eventBus,"addWidgetModalView:modalClosed",this.onWidgetModalClosed),this.listenTo(this.eventBus,"addWidgetModalView:newWidgetTriggered",this.onNewWidgetTriggered)},onWidgetCreateClick:function(){this.dashboardEventBus.trigger("addWidgetController:addWidgetClick")},onNewWidgetTriggered:function(e,t){this.dashboardEventBus.trigger("addWidgetController:newWidgetTriggered",e,t)},launchModal:function(e){this.modalController=new i({eventBus:this.eventBus,context:this.context}),this.modalController.launch(e)},closeModal:function(){this.modalController&&(this.modalController.closeModal(),this.modalController.dispose(),delete this.modalController)},onWidgetModalClosed:function(){this.dashboardEventBus.trigger("addWidgetController:AddWidgetModalClosed",this.model)}})}),define("views/dashboard/Podio.Views.Dashboard.EditableWidget",["require","translate","underscore","jquery","views/dashboard/Podio.Views.Dashboard.Widget","lib/backbone/Backbone.Mixins.StateMachine","lib/Podio.UI.Tooltips"],function(e){var t=e("translate"),i=e("underscore"),o=e("jquery"),n=e("views/dashboard/Podio.Views.Dashboard.Widget"),s=e("lib/backbone/Backbone.Mixins.StateMachine"),a=e("lib/Podio.UI.Tooltips");return n.extend(s).extend({states:["view","edit"],enterState:{view:"enterView",edit:"enterEdit"},leaveState:{view:"leaveView",edit:"leaveEdit"},initialize:function(e){this._super(),i.bindAll(this,"onOutsideclick"),i.extend(this.translations,{modify:t("Edit #dashboard"),titlePlaceholder:t("Add title #dashboard")}),this.forceEditMode=!1},podioEvents:function(){return i.extend(this._super(),{"click .view-mode .action.modify":"onModifyClick"})},enterView:function(e,t){t&&t.alreadyRendered||this.render()},leaveView:function(){},enterEdit:function(e,t){var o=this;t&&t.alreadyRendered||this.render(),i.delay(function(){o.elm.on("outsideclick",o.onOutsideclick)},200)},leaveEdit:function(){this.elm.off("outsideclick",this.onOutsideclick),this.options.fresh=!1},onOutsideclick:function(e,t){var i=o(t);return this.outsideClickExceptions&&(i.is(this.outsideClickExceptions)||i.parents(this.outsideClickExceptions).length)?!1:void(this.forceEditMode||this.toState("view"))},persistChangeDebounced:i.debounce(function(){this.model.save({},{silent:!0})},500),onModifyClick:function(e,t){a.hideAll(),this.toState("edit")},onMouseLeave:function(){"view"===this.currentState&&this._super()}})}),function(e,t){"function"==typeof define&&define.amd&&define("backbone.syphon",["underscore","jquery","backbone"],t)}(this,function(e,t,i){return i.Syphon=function(e,t,i){var o={};o.ignoredTypes=["button","submit","reset","fieldset"],o.serialize=function(e,o){var a={},l=r(o),c=n(e,l);return i.each(c,function(e){var i=t(e),o=s(i),n=l.keyExtractors.get(o),r=n(i),c=l.inputReaders.get(o),h=c(i),u=l.keyAssignmentValidators.get(o);if(u(i,r,h)){var p=l.keySplitter(r);a=d(a,p,h)}}),a},o.deserialize=function(e,o,a){var d=r(a),c=n(e,d),h=l(d,o);i.each(c,function(e){var i=t(e),o=s(i),n=d.keyExtractors.get(o),a=n(i),r=d.inputWriters.get(o),l=h[a];r(i,l)})};var n=function(e,o){var n=a(e),r=n.elements;return r=i.reject(r,function(e){var n,a=s(e),r=o.keyExtractors.get(a),d=r(t(e)),l=i.include(o.ignoredTypes,a),c=i.include(o.include,d),h=i.include(o.exclude,d);return n=c?!1:o.include?!0:h||l})},s=function(e){var i,o=t(e),n=o[0].tagName,s=n;return"input"===n.toLowerCase()&&(i=o.attr("type"),s=i?i:"text"),s.toLowerCase()},a=function(e){return i.isUndefined(e.$el)&&"form"===e.tagName.toLowerCase()?e:e.$el.is("form")?e.el:e.$("form")[0]},r=function(e){var t=i.clone(e)||{};return t.ignoredTypes=i.clone(o.ignoredTypes),t.inputReaders=t.inputReaders||o.InputReaders,t.inputWriters=t.inputWriters||o.InputWriters,t.keyExtractors=t.keyExtractors||o.KeyExtractors,t.keySplitter=t.keySplitter||o.KeySplitter,t.keyJoiner=t.keyJoiner||o.KeyJoiner,t.keyAssignmentValidators=t.keyAssignmentValidators||o.KeyAssignmentValidators,t},d=function(e,t,o){if(!t)return e;var n=t.shift();return e[n]||(e[n]=i.isArray(n)?[]:{}),0===t.length&&(i.isArray(e[n])?e[n].push(o):e[n]=o),t.length>0&&d(e[n],t,o),e},l=function(e,t,o){var n={};return i.each(t,function(t,s){var a={};o&&(s=e.keyJoiner(o,s)),i.isArray(t)?(s+="[]",a[s]=t):i.isObject(t)?a=l(e,t,s):a[s]=t,i.extend(n,a)}),n};return o}(i,t,e),i.Syphon.TypeRegistry=function(){this.registeredTypes={}},i.Syphon.TypeRegistry.extend=i.Model.extend,e.extend(i.Syphon.TypeRegistry.prototype,{get:function(e){var t=this.registeredTypes[e];return t||(t=this.registeredTypes["default"]),t},register:function(e,t){this.registeredTypes[e]=t},registerDefault:function(e){this.registeredTypes["default"]=e},unregister:function(e){this.registeredTypes[e]&&delete this.registeredTypes[e]}}),i.Syphon.KeyExtractorSet=i.Syphon.TypeRegistry.extend(),i.Syphon.KeyExtractors=new i.Syphon.KeyExtractorSet,i.Syphon.KeyExtractors.registerDefault(function(e){return e.prop("name")}),i.Syphon.InputReaderSet=i.Syphon.TypeRegistry.extend(),i.Syphon.InputReaders=new i.Syphon.InputReaderSet,i.Syphon.InputReaders.registerDefault(function(e){return e.val()}),i.Syphon.InputReaders.register("checkbox",function(e){var t=e.prop("checked");return t}),i.Syphon.InputWriterSet=i.Syphon.TypeRegistry.extend(),i.Syphon.InputWriters=new i.Syphon.InputWriterSet,i.Syphon.InputWriters.registerDefault(function(e,t){e.val(t)}),i.Syphon.InputWriters.register("checkbox",function(e,t){e.prop("checked",t)}),i.Syphon.InputWriters.register("radio",function(e,t){e.prop("checked",e.val()===t)}),i.Syphon.KeyAssignmentValidatorSet=i.Syphon.TypeRegistry.extend(),i.Syphon.KeyAssignmentValidators=new i.Syphon.KeyAssignmentValidatorSet,i.Syphon.KeyAssignmentValidators.registerDefault(function(){return!0}),i.Syphon.KeyAssignmentValidators.register("radio",function(e,t,i){return e.prop("checked")}),i.Syphon.KeySplitter=function(e){var t=e.match(/[^\[\]]+/g);return e.indexOf("[]")===e.length-2&&(lastKey=t.pop(),t.push([lastKey])),t},i.Syphon.KeyJoiner=function(e,t){return e+"["+t+"]"},i.Syphon}),define("lib/backbone/Backbone.Mixins.ValidatableView",["require","translate","underscore","jquery","lib/backbone/backbone-validation-amd","backbone.syphon","lib/Podio.UI.Tooltips"],function(e){var t=e("translate"),i=e("underscore"),o=(e("jquery"),e("lib/backbone/backbone-validation-amd")),n=e("backbone.syphon"),s=e("lib/Podio.UI.Tooltips");return o.configure({labelFormatter:"label"}),i.extend(o.patterns,{url:/^((?:(?:https?|ftp):\/\/)?(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.â€Œâ€‹\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[â€Œâ€‹6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1â€Œâ€‹,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00â€Œâ€‹a1-\uffff0-9]+-?)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]+-?)*[a-z\uâ€Œâ€‹00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?)?$/i}),i.extend(o.messages,{pattern:t("{0} must be a valid {1} #validation"),required:t("{0} is required #validation")}),{valid:function(e,t){e.$('[name~="'+t+'"]').removeClass("invalid tooltip").removeAttr("title"),s.hideAll()},invalid:function(e,t,i){e.$('[name~="'+t+'"]').addClass("invalid tooltip").attr("title",i)},initValidation:function(){o.bind(this,{valid:this.valid,invalid:this.invalid})},removeValidation:function(){o.unbind(this)},serializeForm:function(e){return n.serialize(e.get(0))},liveValidateAttribute:function(e,t,i){var o=this.model.preValidate(e,t),n=i||this.elm,s={$:n.find.bind(n)};return o?(this.invalid(s,e,o),!1):(this.valid(s,e),!0)},isModelValid:function(e){var t;return i.isUndefined(this.model.isValid(e))?(t=this.model.validate(),i.isUndefined(t)):this.model.isValid(e)}}}),define("views/dashboard/Podio.Views.Dashboard.ImageWidget",["require","translate","underscore","jquery","views/dashboard/Podio.Views.Dashboard.EditableWidget","lib/Podio.UI.FileFinder","lib/Podio.UI.SimpleBalloon","lib/Podio.UI.Tooltips","lib/view_helpers/base","lib/backbone/Backbone.Mixins.ValidatableView"],function(e){var t=e("translate"),i=e("underscore"),o=e("jquery"),n=e("views/dashboard/Podio.Views.Dashboard.EditableWidget"),s=e("lib/Podio.UI.FileFinder"),a=e("lib/Podio.UI.SimpleBalloon"),r=e("lib/Podio.UI.Tooltips"),d=e("lib/view_helpers/base"),l=e("lib/backbone/Backbone.Mixins.ValidatableView"),c=n.extend({podioEvents:function(){return i.extend(this._super(),{"click .edit-mode .pick-image":"onPickImage","click .edit-mode .remove-image":"onRemoveImage","click .edit-mode .change-link":"onChangeLink"})},initialize:function(e){this._super(),i.bindAll(this,"_onFileFinderDone","_onFileFinderClose"),i.extend(this.translations,{pick_image_button_text:t("Upload file #dashboard"),change_link:t("Change link #dashboard"),remove_image:t("Remove image #dashboard"),enter_link:t("Enter image link #dashboard")}),this.outsideClickExceptions=".remove-image",this.context=e.context},beforeInitialRender:function(){this.toState(this.options.fresh?"edit":"view",null,{alreadyRendered:!0})},templateName:function(){return"edit"===this.currentState?"image_widget_edit":this._super()},render:function(){this._super();var e=this.elm.find(".image-container");if(this.model.get("data").url){var t=o("<a />",{href:this.model.get("data").url,target:"_blank",rel:"noreferrer"});t.append(this.imageElm()),e.append(t)}else e.append(this.imageElm());this.imageElm()?this.elm.find(".image-missing").hide():this.elm.find(".image-missing").css("display","")},imageElm:function(){return!this.cachedImageElm&&this.model.get("data").image&&(this.cachedImageElm=o("<img />",{src:d.image_url_for(this.model.get("data").image.thumbnail_link,"tile")})),this.cachedImageElm},onRemoveImage:function(){delete this.cachedImageElm,delete this.model.get("data").image,r.hideAll(),this._updateConfig({},"file_id")},onChangeLink:function(e,t){var i=o("<input />",{type:"text",value:this.model.get("data").url,"class":"image-widget-link",name:"data.url"}),n="app"===this.context?-80:-120;t.stopPropagation(),i.attr("placeholder",this.translations.enter_link),this.balloon=new a({elmAttachmentTarget:this.elm.find(".change-link"),content:o("<div/>").append(i).html(),arrowPosition:"right",offsets:{left:n},contentClass:"link-balloon"}),this.forceEditMode=!0,this.balloon.render(),this.balloon.show(),this.balloon.elmContainer.find(".image-widget-link").focus(),this.balloon.elm.bind("outsideclick",this.onLinkBalloonOutsideclick.bind(this,this.balloon))},onLinkBalloonOutsideclick:function(e){var t=e.elm.find(".image-widget-link").val();this.liveValidateAttribute("data.url",t,e.elm)&&(e.hide(),e.elm.unbind("outsideclick"),this.forceEditMode=!1,this._updateConfig({url:t}))},onPickImage:function(){var e=new s({onlyAllowImages:!0,multipleFiles:!1,onlyPodioFiles:!0});e.signals.onDone.add(this._onFileFinderDone),e.signals.onClose.add(this._onFileFinderClose),this.forceEditMode=!0,e.init()},leaveEdit:function(){this._updateConfig(),this._super()},_onFileFinderDone:function(e){e.length&&(this.forceEditMode=!1,delete this.cachedImageElm,this._updateConfig({file_id:e[0].file_id}))},_onFileFinderClose:function(){this.forceEditMode=!1},_updateConfig:function(e,t){t=t||[];var o=this.model.get("config");o=i.omit(o,t),i.extend(o,e);var n=this.elm.find(".widget-title").val();this.trigger("configChange",{title:n,config:o})},dispose:function(){i.isDefined(this.balloon)&&(this.balloon.destroy(),delete this.balloon),this._super()}});return i.extend(c.prototype,l),c}),define("controllers/dashboard/Podio.Controllers.Dashboard.ImageWidgetController",["require","controllers/dashboard/Podio.Controllers.Dashboard.WidgetController","views/dashboard/Podio.Views.Dashboard.ImageWidget"],function(e){var t=e("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController");return t.extend({initialize:function(t){this.viewClass=e("views/dashboard/Podio.Views.Dashboard.ImageWidget"),this._super(t)}})}),define("views/dashboard/Podio.Views.Dashboard.FilesWidget",["require","translate","underscore","views/dashboard/Podio.Views.Dashboard.Widget"],function(e){var t=e("translate"),i=e("underscore"),o=e("views/dashboard/Podio.Views.Dashboard.Widget");return o.extend({initialize:function(){this._super(),i.extend(this.translations,{blankslate_message:t("No files to show #dashboard")})}})}),define("controllers/dashboard/Podio.Controllers.Dashboard.FilesWidgetController",["require","controllers/dashboard/Podio.Controllers.Dashboard.WidgetController","controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin","views/dashboard/Podio.Views.Dashboard.FilesWidget"],function(e){var t=e("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController"),i=e("controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin");return t.extend(i).extend({initialize:function(t){this.viewClass=e("views/dashboard/Podio.Views.Dashboard.FilesWidget"),this._super(t)}})}),define("views/dashboard/Podio.Views.Dashboard.TextWidget",["require","underscore","views/dashboard/Podio.Views.Dashboard.EditableWidget"],function(e){var t=e("underscore"),i=e("views/dashboard/Podio.Views.Dashboard.EditableWidget");return i.extend({podioEvents:function(){return t.extend(this._super(),{"keyup .edit-mode textarea":"onTextUpdated","keyup .edit-mode .title":"onTitleUpdated"})},initialize:function(){t.bindAll(this,"persistChangeDebounced"),this._super()},beforeInitialRender:function(){this.toState(this.options.fresh?"edit":"view",null,{alreadyRendered:!0})},templateName:function(){return"edit"===this.currentState?"text_widget_edit":this._super()},onTextUpdated:function(e,t){var i=this.model.get("config");i.text=e.val(),this.persistChangeDebounced()},onTitleUpdated:function(e,t){this.model.set({title:e.val()},{silent:!0}),this.persistChangeDebounced()}})}),define("controllers/dashboard/Podio.Controllers.Dashboard.TextWidgetController",["require","controllers/dashboard/Podio.Controllers.Dashboard.WidgetController","views/dashboard/Podio.Views.Dashboard.TextWidget"],function(e){var t=e("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController");return t.extend({initialize:function(t){this.viewClass=e("views/dashboard/Podio.Views.Dashboard.TextWidget"),this._super(t)}})}),define("views/dashboard/Podio.Views.Dashboard.LinksWidgetPopover",["require","views/lib/Podio.Views.Mixins.Popover","lib/backbone/Backbone.Mixins.ValidatableView","lib/backbone/Backbone.PodioView","lib/Podio.UI"],function(e){var t=e("views/lib/Podio.Views.Mixins.Popover"),i=e("lib/backbone/Backbone.Mixins.ValidatableView"),o=e("lib/backbone/Backbone.PodioView"),n=e("lib/Podio.UI");return o.extend(i).extend(t).extend({arrowPosition:"center",arrowOffset:309,popOverClass:"link-widget-popover",popOverId:"linkWidgetPopover",podioEvents:{"blur input":"onInputBlur","click .add-link-button":"onSubmitClick"},initialize:function(e){this.elmAttachmentTarget=e.elmAttachmentTarget,this.arrowOffset=Math.floor(this.elmAttachmentTarget.outerWidth(!0)/2),this.initBalloon(),this.linksCollection=e.linksCollection,this._super(),this.model=e.linkModel,this.initValidation()},onInputBlur:function(e,t){var i=e.val(),o=e.attr("name");this.model.set(o,i,{validate:!0})},onSubmitClick:function(e,t){var i=this.serializeForm(this.elm.find(".inputs-container > form"));this.model.set(i,{validate:!0}),this.model.isValid()&&(n.disableButtonWithLoader(e),this.trigger("linksWidgetPopover:linkSubmitted",this.model))},afterDataSubmitted:function(){n.restoreButtonWithLoader(this.elm.find(".add-link-button")),this.elm.find("input").val("")},onOutsideClick:function(){}})}),define("jst!dashboard/_link_widget_popover",["underscore","translate"],function(){var e=require("underscore");require("translate");return e.template('<div class="image-block">\n	<div class="img-ext">\n    <%-button(translations.buttonTitle, \'#\', { color: \'green\', \'class\': \'add-link-button\' })%>\n	</div>\n	<div class="bd">\n    <div class="inputs-container">\n      <form>\n        <input type="text" name="url" class="link-url-input no-autoblur" placeholder="<%=translations.urlPlaceholder%>" />\n        <input type="text" maxlength="120" name="title" class="link-title-input no-autoblur" placeholder="<%=translations.titlePlaceholder%>" />\n      </form>\n    </div>\n	</div>\n</div>')}),define("views/dashboard/Podio.Views.Dashboard.LinksWidget",["require","translate","underscore","views/dashboard/Podio.Views.Dashboard.EditableWidget","views/dashboard/Podio.Views.Dashboard.LinksWidgetPopover","lib/Podio.UI.Tooltips","jst!dashboard/_link_widget_popover"],function(e){var t=e("translate"),i=e("underscore"),o=e("views/dashboard/Podio.Views.Dashboard.EditableWidget"),n=e("views/dashboard/Podio.Views.Dashboard.LinksWidgetPopover"),s=e("lib/Podio.UI.Tooltips"),a=e("jst!dashboard/_link_widget_popover");return o.extend({outsideClickExceptions:".link-widget-popover",podioEvents:function(){return i.extend(this._super(),{"keyup .edit-mode .title":"onTitleUpdated","click .remove-link":"onRemoveLinkClick"})},initialize:function(){this._super(),i.extend(this.translations,{blankslate_message:t("No links to show #dashboard"),removeLink:t("Remove this link #dashboard")})},_hideUnauthorizedActions:function(){this.model.can("update")||this.elm.find(".content .remove-link").hide(),this._super()},afterInitialRender:function(){this.toState(this.options.fresh?"edit":"view",null,{alreadyRendered:!0})},templateName:function(){return"edit"===this.currentState?"link_widget_edit":this._super()},renderPopover:function(){this.popoverView=new n({elmAttachmentTarget:this.elm,linksCollection:this.model.get("data"),linkModel:this.options.linkModel,eventBus:this.eventBus}),this.popoverView.renderBalloon(this.getTemplate(a,{translations:{urlPlaceholder:t("Enter link URL #dashboard"),titlePlaceholder:t("Enter title for the link #dashboard"),buttonTitle:t("Add #dashboard")}})),this.popoverView.elm.css("width",this.elm.outerWidth()),this.popoverView.show()},enterEdit:function(){this._super(),this.renderPopover()},leaveEdit:function(){this.popoverView.dispose(),delete this.popoverView,this._super()},onTitleUpdated:function(e,t){this.model.set({title:e.val()},{silent:!0}),this.persistChangeDebounced()},onRemoveLinkClick:function(e,t){var i=e.parents("li:first");s.hideAll(),this.model.removeLinkByIndex(i.index()),this.model.save({})},dispose:function(){this.popoverView&&this.popoverView.dispose(),this._super()}})}),define("controllers/dashboard/Podio.Controllers.Dashboard.LinksWidgetController",["require","underscore","translate","controllers/dashboard/Podio.Controllers.Dashboard.WidgetController","lib/backbone/Backbone.PodioModel","views/dashboard/Podio.Views.Dashboard.LinksWidget"],function(e){var t=e("underscore"),i=e("translate"),o=e("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController"),n=e("lib/backbone/Backbone.PodioModel");return o.extend({initialize:function(i){this.viewClass=e("views/dashboard/Podio.Views.Dashboard.LinksWidget"),this.options.viewOptions=t.extend(this.options.viewOptions||{},{linkModel:this.getNewWidgetLinkModel()}),this._super(i),this._bindLocalEvents()},_bindLocalEvents:function(){this.listenTo(this.eventBus,"linksWidgetPopover:linkSubmitted",this.onNewLinkSubmitted)},onNewLinkSubmitted:function(e){var t=this;this.view.model.get("config").links.push(e.toJSON()),this.view.model.save().done(function(){t.view.render(),t.view.popoverView.afterDataSubmitted()})},getNewWidgetLinkModel:function(){var e=n.extend({validation:{url:{pattern:"url",required:!0}},labels:{url:i("Link URL #dashboard")}});return new e}})}),define("views/dashboard/Podio.Views.Dashboard.SpaceContactsWidget",["require","translate","underscore","views/dashboard/Podio.Views.Dashboard.Widget"],function(e){var t=e("translate"),i=e("underscore"),o=e("views/dashboard/Podio.Views.Dashboard.Widget");return o.extend({initialize:function(){this._super(),i.extend(this.translations,{blankslate_message:t("No contacts to show #dashboard")})}})}),define("controllers/dashboard/Podio.Controllers.Dashboard.SpaceContactsWidgetController",["require","controllers/dashboard/Podio.Controllers.Dashboard.WidgetController","controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin","views/dashboard/Podio.Views.Dashboard.SpaceContactsWidget"],function(e){var t=e("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController"),i=e("controllers/dashboard/Podio.Controllers.Dashboard.LimitableWidgetMixin");return t.extend(i).extend({initialize:function(t){this.viewClass=e("views/dashboard/Podio.Views.Dashboard.SpaceContactsWidget"),this._super(t)}})}),define("collections/RecentItems",["require","underscore","lib/backbone/Backbone.PodioCollection"],function(e){var t=e("underscore"),i=e("lib/backbone/Backbone.PodioCollection");return i.extend({exclude_demo:!0,limit:5,prepareCollectionForDisplay:function(){this.models=t.filter(this.models,function(e){var t=e.get("rights");return t?t.indexOf("add_item")>-1:!0}),this.isWorkspace&&(this.models=this.models.slice(0,this.limit))},initialize:function(e){this.useDirectAPIAccess=!0,this.isWorkspace=e.isWorkspace,this.id=e.id,t.isDefined(e.limit)&&(this.limit=e.limit),t.bindAll(this,"prepareCollectionForDisplay"),this.isWorkspace&&this.id?this.urlAPI="/app/space/"+this.id:this.urlAPI="/app/top/"},fetch:function(){return this._super({reset:!0,data:{exclude_demo:this.exclude_demo,view:"reference",fields:"rights",limit:this.limit},success:this.prepareCollectionForDisplay})}})}),define("views/dashboard/Podio.Views.Dashboard.RecentItemsWidget",["require","translate","underscore","views/dashboard/Podio.Views.Dashboard.Widget","collections/RecentItems","lib/GlobalEventBus","lib/Podio.Tracking"],function(e){var t=e("translate"),i=e("underscore"),o=e("views/dashboard/Podio.Views.Dashboard.Widget"),n=e("collections/RecentItems"),s=e("lib/GlobalEventBus"),a=e("lib/Podio.Tracking");return o.extend({podioEvents:function(){return i.extend(this._super(),{"click default .event-tracking":"onEventTracking"})},initialize:function(e){this.dashboardEventBus=this.options.dashboardEventBus,this._bindEvents(),this._super(e)},_bindEvents:function(){s.on("recentItems:update",this._ensureDefaultLayoutWasPersisted.bind(this),this),this.dashboardEventBus.on("dashboardView:defaultLayoutPersisted",this.fetchModel.bind(this))},renderOptions:function(){var e=this.model.get("data").items||[],o=i.isDefined(this.dfdTopAppsCollection)&&"resolved"===this.dfdTopAppsCollection.state();return 0!==e.length||o||this.fetchTopAppsCollection(),i.extend(this._super(),{items:e,isDfdResolved:o,topApp:i.isDefined(this.topAppsCollection)&&this.topAppsCollection.length>0?this.topAppsCollection.first():void 0,translations:{title:t("My Recent Items #dashboard.tile"),no_activity:t("You have no item activity yet #dashboard.tile"),what_is_an_item:t("What's an item? #dashboard.tile"),create_new_item:t("Create new {0} #dashboard.tile")}})},fetchTopAppsCollection:function(){this.topAppsCollection=new n({id:void 0,isWorkspace:!1,limit:1}),this.dfdTopAppsCollection=this.topAppsCollection.fetch(),this.dfdTopAppsCollection.done(this.render.bind(this))},render:function(){return this._super(),i.defer(function(){this._handleOverflow(),this._handleDisplayOptions({cols:this.model.get("cols")})}.bind(this)),this},_ensureDefaultLayoutWasPersisted:function(){this.options.dashboardEventBus.trigger("dashboardView:persistDefaultLayout")},fetchModel:function(){this.model.fetch().done(this.render.bind(this))},onEventTracking:function(e,t){var i={type:"dashboard",subtype:"recent_items",data:{action:"click:{0}".format(e.data("event-tracking-action"))}};a.eventTracking(i).done(function(){"no-reload"!==e.data("link-type")&&(window.location.href=e.attr("href"))})}})}),define("controllers/dashboard/Podio.Controllers.Dashboard.RecentItemsWidgetController",["require","controllers/dashboard/Podio.Controllers.Dashboard.WidgetController","views/dashboard/Podio.Views.Dashboard.RecentItemsWidget"],function(e){var t=e("controllers/dashboard/Podio.Controllers.Dashboard.WidgetController");return t.extend({initialize:function(t){this.viewClass=e("views/dashboard/Podio.Views.Dashboard.RecentItemsWidget"),this._super(t)}})}),define("controllers/dashboard/Podio.Controllers.Dashboard",["require","underscore","jquery","translate","jquery.scrollTo","lib/backbone/Backbone.PodioController","models/Podio.Models.AddDashboardWidget","collections/Podio.Collections.Widget","views/dashboard/Podio.Views.Dashboard","views/dashboard/Podio.Views.Dashboard.BlankWidget","models/Podio.Models.Widget","root/dashboard/Podio.Dashboard.WidgetFactory","routers/Podio.Routers.Dashboard","models/Podio.Models.Application","lib/Podio.UI.Modal","lib/Podio.Logger","lib/Podio.Utils","controllers/avatar_uploader/Podio.Controllers.AvatarUploader","controllers/promotion/Podio.Controllers.PromotionController","controllers/net_promoter_score/Podio.Controllers.NetPromoterScore","react","react-dom","component!GlobalHomeHelpPane","controllers/dashboard/Podio.Controllers.Dashboard.TasksWidgetController","controllers/dashboard/Podio.Controllers.Dashboard.EventsWidgetController","controllers/dashboard/Podio.Controllers.Dashboard.ProfilesWidgetController","controllers/dashboard/Podio.Controllers.Dashboard.AppsWidgetController","controllers/dashboard/Podio.Controllers.Dashboard.CalculationWidgetController","controllers/dashboard/Podio.Controllers.Dashboard.AppViewWidgetController","controllers/dashboard/Podio.Controllers.Dashboard.AddWidgetController","controllers/dashboard/Podio.Controllers.Dashboard.ImageWidgetController","controllers/dashboard/Podio.Controllers.Dashboard.FilesWidgetController","controllers/dashboard/Podio.Controllers.Dashboard.TextWidgetController","controllers/dashboard/Podio.Controllers.Dashboard.LinksWidgetController","controllers/dashboard/Podio.Controllers.Dashboard.SpaceContactsWidgetController","controllers/dashboard/Podio.Controllers.Dashboard.RecentItemsWidgetController"],function(e){var t=e("underscore"),i=e("jquery"),o=e("translate");e("jquery.scrollTo");var n=e("lib/backbone/Backbone.PodioController"),s=e("models/Podio.Models.AddDashboardWidget"),a=e("collections/Podio.Collections.Widget"),r=e("views/dashboard/Podio.Views.Dashboard"),d=e("views/dashboard/Podio.Views.Dashboard.BlankWidget"),l=e("models/Podio.Models.Widget"),c=e("root/dashboard/Podio.Dashboard.WidgetFactory"),h=e("routers/Podio.Routers.Dashboard"),u=e("models/Podio.Models.Application"),p=e("lib/Podio.UI.Modal"),g=e("lib/Podio.Logger"),f=e("lib/Podio.Utils"),m=e("controllers/avatar_uploader/Podio.Controllers.AvatarUploader"),_=e("controllers/promotion/Podio.Controllers.PromotionController"),v=e("controllers/net_promoter_score/Podio.Controllers.NetPromoterScore"),b=e("react"),w=e("react-dom"),y=b.createFactory(e("component!GlobalHomeHelpPane")),k={
tasks:e("controllers/dashboard/Podio.Controllers.Dashboard.TasksWidgetController"),events:e("controllers/dashboard/Podio.Controllers.Dashboard.EventsWidgetController"),profiles:e("controllers/dashboard/Podio.Controllers.Dashboard.ProfilesWidgetController"),apps:e("controllers/dashboard/Podio.Controllers.Dashboard.AppsWidgetController"),calculation:e("controllers/dashboard/Podio.Controllers.Dashboard.CalculationWidgetController"),app_view:e("controllers/dashboard/Podio.Controllers.Dashboard.AppViewWidgetController"),addWidget:e("controllers/dashboard/Podio.Controllers.Dashboard.AddWidgetController"),image:e("controllers/dashboard/Podio.Controllers.Dashboard.ImageWidgetController"),files:e("controllers/dashboard/Podio.Controllers.Dashboard.FilesWidgetController"),text:e("controllers/dashboard/Podio.Controllers.Dashboard.TextWidgetController"),link:e("controllers/dashboard/Podio.Controllers.Dashboard.LinksWidgetController"),contacts:e("controllers/dashboard/Podio.Controllers.Dashboard.SpaceContactsWidgetController"),recent_items:e("controllers/dashboard/Podio.Controllers.Dashboard.RecentItemsWidgetController")};return n.extend({PREVIEW_WIDGET_SCROLL_OFFSET:57,PREVIEW_WIDGET_ROWS:7,PREVIEW_WIDGET_COLS:1,initialize:function(e){this._super(),this.context=e.context,this.ref=e.ref,t.bindAll(this,"addWidget","removeWidget","removeDefaultWidget","_onWidgetsChanged","disposeWidgetByModel","_addNewWidget","createNewWidget","setupDefaultDashboard","_renderAddWidgetButton"),this.router=new h({eventBus:this.eventBus}),this.widgets=new a([],{ref:this.ref,context:this.context}),this.widgetControllers=[],this.widgetsLoaded=this.widgets.fetch({reset:!0}),this.listenTo(this.widgets,"reset",this._onWidgetsChanged),this.view=new r({elmContainer:e.elmContainer,eventBus:this.eventBus}),this.hasBootstrapData("app")&&(this.appModel=new u(this.getBootstrapData("app"))),this._bindEvents(),"app"!==this.context&&this.initPromotions()},initPromotions:function(){this.promotionController=new _({promotions:[{display_type:"net_promoter_score",controller:v},{display_type:"help_pane",callback:function(e){if(e.display_data.help_pane_id&&"GlobalHomeHelpPane"===e.display_data.help_pane_id){var t=document.querySelector(".help-panes"),i=document.getElementById("globalHomeHelp");i||(i=document.createElement("section"),i.id="globalHomeHelp",t.appendChild(i));w.render(y({openImmediately:!0,promotionId:e.promotion_id}),i)}}}]}),this.promotionController.checkForPromotions()},_bindEvents:function(){this.listenTo(this.eventBus,"widget:delete",this.onWidgetDeleted),this.listenTo(this.eventBus,"widget:update",this.onWidgetUpdated),this.listenTo(this.eventBus,"widget:clone",this.onWidgetCloned),this.listenTo(this.eventBus,"widget:deleteDefault",this.removeDefaultWidget),this.listenTo(this.eventBus,"addWidgetController:addWidgetClick",this.onAddNewWidgetTriggered),this.listenTo(this.eventBus,"addWidgetController:AddWidgetModalClosed",this.onAddWidgetModalClosed),this.listenTo(this.eventBus,"addWidgetController:newWidgetTriggered",this.onNewWidgetSelected),this.listenTo(this.eventBus,"blankWidget:delete",this.onBlankWidgetDeleteClick),this.listenTo(this.eventBus,"dashboardView:widgetStartedResize",this.onWidgetResizeStarted),this.listenTo(this.eventBus,"dashboardView:widgetFinishedResize",this.onWidgetResizeFinished),this.listenTo(this.eventBus,"dashboardView:widgetStartedDrag",this.onWidgetDragStarted),this.listenTo(this.eventBus,"dashboardView:widgetFinishedDrag",this.onWidgetDragFinished),this.listenTo(this.eventBus,"dashboardView:persistDefaultLayout",this._persistDefaultDashboard.bind(this)),this.listenTo(this.eventBus,"dashboardRouter:widgetRouteInvoked",this.beforeWidgetScroll),this.listenTo(this.eventBus,"dashboardRouter:changeAvatarRouteInvoked",this.onChangeAvatarRouteInvoked)},_onWidgetsChanged:function(){var e=this;this.widgets.each(function(t){e.addWidget(t)}),t.each(this.widgetControllers,function(i){t.defer(function(t){e._renderWidget(t.view)},i)}),this.options.canAddWidgets&&(this.addButtonWidgetModel=new s({ref:this.ref},{collection:this.widgets}),t.defer(this._renderAddWidgetButton)),f.markUserTime("widgets-done",!0)},_renderWidget:function(e){t.isFunction(e.beforeInitialRender)&&e.beforeInitialRender(),e.render(),e.place(),t.isFunction(e.afterInitialRender)&&e.afterInitialRender()},_renderAddWidgetButton:function(){t.isUndefined(this.addButtonWidgetModel)||(this.addButtonWidgetView=this.addWidget(this.addButtonWidgetModel),this._renderWidget(this.addButtonWidgetView))},_getNewWidgetCoordinates:function(e,t){var i=this.addWidgetController||this.findControllerByType("addWidget"),o=i.model.getX(),n=i.model.getY();return{rows:e,cols:t,x:o,y:n}},_addNewWidget:function(e,t){var i;return this.widgets.add(e),i=this.addWidget(e,t,{fresh:!0}),this._renderWidget(i),i},_widgetSupportsBlankSlate:function(e){return"calculation"===e},_bringWidgetViewToTop:function(e){var i=t.find(this.widgetControllers,function(t){return t.model.get("id")===e.get("id")});i.view.bringToTop()},_bringAllWidgetsToBottom:function(){this.view.bringAllWidgetsToBottom()},_getDeleteConfirmText:function(e){var i=t.escape(e.get("title"));return"home"===this.context?{title:o("Remove widget from home #dashboard"),body:o('Are you sure you want to remove "{0}" from home? #dashboard').format(i)}:"space"===this.context?{title:o("Remove widget from workspace #dashboard"),body:o('Are you sure you want to remove "{0}" from the workspace? It will remove it for all workspace users. #dashboard').format(i)}:"emp_network"===this.context?{title:o("Remove widget from employee network #dashboard"),body:o('Are you sure you want to remove "{0}" from the employee network? It will remove it for all users in the employee network. #dashboard').format(i)}:"app"===this.context?{title:o("Remove widget from an app #new_app_reporting"),body:o('Are you sure you want to remove "{0}" from your app? It will remove it for all app users. #new_app_reporting').format(i)}:void 0},controllerForWidget:function(e){return t.findWhere(this.widgetControllers,{model:e})},findControllerByType:function(e){return t.find(this.widgetControllers,function(t){return t.model.get("type")===e})},findControllerByWidgetId:function(e){return t.find(this.widgetControllers,function(t){return t.model.get("widget_id")===e})},createNewWidget:function(e,i,o,n){var s=this;t.extend(n||{},{supportsBlankSlate:this._widgetSupportsBlankSlate(e),data:this._getNewWidgetCoordinates(6,1),context:this.context}),this.previewWidgetModel=c.getWidgetModel(this.ref,e,i,n),this._widgetSupportsBlankSlate(e)?(this._addNewWidget(this.previewWidgetModel,o),this._bringWidgetViewToTop(this.previewWidgetModel)):this.previewWidgetModel.save({ref_type:this.ref.type,ref_id:this.ref.id}).done(function(e){e&&"ok"===e.status?(s._addNewWidget(s.previewWidgetModel,o),s._bringWidgetViewToTop(s.previewWidgetModel)):e&&"widgets.maximum"===e.error_code&&(s.view.removeWidgetView(s.lastWidgetView,{gridsterBlock:s.lastWidgetView.gridsterWidget}),s.addWidgetController.closeModal())})},onWidgetCloned:function(e){var t=this._addNewWidget(e);this.scrollToWidget(t,t.elm.scrollParent())},removeBlankWidget:function(e){var t=new i.Deferred,o=this.blankWidgetView.gridsterWidget;return this.disposeWidgetMVC(this.blankWidgetModel,this.blankWidgetView,null,e),delete this.blankWidgetModel,delete this.blankWidgetView,t.resolve({prevWidgetElm:o})},removePreviousWidget:function(e){var t,o,n,s={view:{keepGridsterWidget:!0}};return this.blankWidgetView?this.removeBlankWidget(s):(o=this._widgetSupportsBlankSlate(e),t=this._widgetSupportsBlankSlate(this.previewWidgetModel.get("type")),n={prevWidgetElm:this.lastWidgetView.gridsterWidget,prevWidgetId:t?null:this.previewWidgetModel.get("id")},o&&!t?this.removeWidget(this.previewWidgetModel,s).pipe(function(){return n}):(this.disposeWidgetByModel(this.previewWidgetModel,s),(new i.Deferred).resolve(n)))},onNewWidgetSelected:function(e,t){if("calculation"===e&&"app"===this.ref.type)return void(window.location=this.appModel.get("link")+"#/widgets/new/{0}/{1}".format(this.ref.type,this.ref.id));var o=this,n=this.setupDefaultDashboard(),s=this.removePreviousWidget(e);i.when(n,s).done(function(i,n){o.createNewWidget(e,n.prevWidgetId,n.prevWidgetElm,t)})},onAddNewWidgetTriggered:function(){var e,t=this.findControllerByType("addWidget"),i=new l({type:"blankWidget",rows:this.PREVIEW_WIDGET_ROWS,cols:this.PREVIEW_WIDGET_COLS}),o=new d({eventBus:this.eventBus,model:i});this.addWidgetController=t,this.blankWidgetView=o,this.blankWidgetModel=i,e=this.addButtonWidgetView.gridsterWidget,this.disposeWidgetByModel(this.addButtonWidgetModel,{view:{keepGridsterWidget:!0}}),delete this.addButtonWidgetView,this.view.addWidgetView(o,e),this.scrollToWidget(o),t.launchModal({positionTop:"1px",keepScrollPosition:!1,elmContainer:o.gridsterWidget,customOverlayClass:"dashboard-overlay"}),this.addWidgetModalIsOpen=!0},scrollToWidget:function(e,t){t=t||i(window),t.scrollTo(e.gridsterWidget.offset().top-this.PREVIEW_WIDGET_SCROLL_OFFSET,400)},onAddWidgetModalClosed:function(){this.blankWidgetView&&this.removeBlankWidget(),this._bringAllWidgetsToBottom(),this.addWidgetModalIsOpen=!1,this._renderAddWidgetButton()},onWidgetUpdated:function(e){var t=this;this.setupDefaultDashboard().then(function(){e.save({ref_type:t.ref.type,ref_id:t.ref.id})})},onWidgetDeleted:function(e){var t,i=this;this.addWidgetModalIsOpen?this.deleteWidgetAfterUserRequest(e):(t=this._getDeleteConfirmText(e),p.showConfirm(t.title,t.body,null,{},function(){i.deleteWidgetAfterUserRequest(e)}))},deleteWidgetAfterUserRequest:function(e){t.isNaN(parseInt(e.get("id"),10))?this.removeDefaultWidget(e):this.removeWidget(e),this.addWidgetController&&this.addWidgetController.closeModal()},onBlankWidgetDeleteClick:function(){this.addWidgetController.closeModal()},onWidgetResizeStarted:function(){this.addButtonWidgetView&&(this.disposeWidgetByModel(this.addButtonWidgetModel),delete this.addButtonWidgetView)},onWidgetResizeFinished:function(){this.addWidgetModalIsOpen||this._renderAddWidgetButton()},onWidgetDragStarted:function(){this.addButtonWidgetView&&(this.disposeWidgetByModel(this.addButtonWidgetModel),delete this.addButtonWidgetView)},onWidgetDragFinished:function(){this.addWidgetModalIsOpen||this._renderAddWidgetButton()},beforeWidgetScroll:function(e,t){var i=this;this.widgetsLoaded.done(function(){var o=i.findControllerByWidgetId(e);i.scrollToWidget(o.view,t)})},onChangeAvatarRouteInvoked:function(){var e=new m;e.render()},removeWidget:function(e,t){return e.destroy().then(this.disposeWidgetByModel.curry(e,t))},removeDefaultWidget:function(e){this.disposeWidgetByModel(e).then(this.setupDefaultDashboard)},disposeWidgetByModel:function(e,t){var i,o=this.controllerForWidget(e);return o&&(i=o.view),this.disposeWidgetMVC(e,i,o,t)},disposeWidgetMVC:function(e,t,i,o){return e&&this.widgets.remove(e),i&&(this.widgetControllers.remove(i),i&&"addWidget"!==e.get("type")&&i.dispose()),this.view.removeWidgetView(t,o?o.view:null)},addWidget:function(e,t,i){var o=k[e.get("type")];if(!o)return void g.log("Unknown widget type: `"+e.get("type")+"`");var n=new o({dashboardEventBus:this.eventBus,model:e,context:this.context,viewOptions:i});return this.view.addWidgetView(n.view,t,{rememberView:!0}),this.lastWidgetView=n.view,this.widgetControllers.push(n),n.view},setupDefaultDashboard:t.once(function(){return this.widgets.setupDefaultDashboard()}),_persistDefaultDashboard:function(){this.setupDefaultDashboard().done(function(){this.eventBus.trigger("dashboardView:defaultLayoutPersisted")}.bind(this))},destroy:function(){delete this.router,this.view.destroy(),t.invoke(this.widgetControllers,"dispose"),delete this.view,delete this.widgets,delete this.widgetControllers,this._super()}})}),define("bundles/home/dashboard",["require","bundles/common-ui","react","react-dom","jquery","lib/Podio.Utils","lib/Podio.Config","lib/Podio.Event","component!Promotions/TilePromotionComponent","controllers/promotion/Podio.Controllers.PromotionController","component!Pricing/PricingOrganizationPickerComponent","bundles/stream","lib/view_helpers/dashboard","root/home/Podio.UI.Home","controllers/dashboard/Podio.Controllers.Dashboard"],function(e){e("bundles/common-ui");var t=e("react"),i=e("react-dom"),o=e("jquery"),n=(e("lib/Podio.Utils"),e("lib/Podio.Config")),s=(e("lib/Podio.Event"),e("component!Promotions/TilePromotionComponent")),a=e("controllers/promotion/Podio.Controllers.PromotionController"),r=t.createFactory(e("component!Pricing/PricingOrganizationPickerComponent"));e("bundles/stream"),e("lib/view_helpers/dashboard"),e("root/home/Podio.UI.Home");var d=e("controllers/dashboard/Podio.Controllers.Dashboard");new d({ref:{type:"user",id:n.user.user_id},elmContainer:o(".dashboard"),context:"home",canAddWidgets:!0});var l=new a({useXHRLookup:!0,promotion:{context:"global_home_gridster"},promotions:[{display_type:"tile_banner",callback:function(e){i.render(t.createElement(s,{promotionData:e}),document.getElementById("tile-banner-container"))}}]});if(l.checkForPromotions(),window.location.href.indexOf("/home/upgrade")>0){var c,h=document.getElementById("modal-org-picker-placeholder");h||(h=document.createElement("div"),h.id="modal-org-picker-placeholder",document.body.appendChild(h)),c=i.render(r(),h),c.open()}});
//# sourceMappingURL=dashboard.js.map